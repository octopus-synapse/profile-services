name: CI

on:
  pull_request:
    branches: [main, dev]
  push:
    branches: [dev]

permissions:
  contents: read
  packages: read

jobs:
  ci:
    uses: octopus-synapse/octopus-workflows/.github/workflows/ci.yml@main
    with:
      node-version: "20"
      has-database: true
      has-redis: true
      has-smoke-tests: true
      build-output-dir: "dist"
      pre-test-script: "npm run db:setup"
    secrets:
      GITHUB_TOKEN: ${{ secrets.GH_PAT || secrets.GITHUB_TOKEN }}
