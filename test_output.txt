bun test v1.2.23 (cf136713)

src/app.controller.spec.ts:
(pass) AppController > root > should return "Hello World!" [18.96ms]
(pass) AppController > health > should return health status [2.25ms]
(pass) AppController > version > should return version information [2.77ms]
(pass) AppController > version > should use development environment when manifest not available [2.82ms]

src/resumes/resumes.service.spec.ts:
(pass) ResumesService > Resume Limit (Maximum 4) > should allow creating resume when under limit [3.20ms]
(pass) ResumesService > Resume Limit (Maximum 4) > should reject creating 5th resume with error [2.70ms]
(pass) ResumesService > Resume Limit (Maximum 4) > should show clear error message about 4 resume limit [1.86ms]
(pass) ResumesService > Resume Limit (Maximum 4) > should allow creating exactly 4 resumes [1.97ms]
(pass) ResumesService > Resume CRUD Operations > should return all resumes for a user [3.60ms]
(pass) ResumesService > Resume CRUD Operations > should return resume by id if owned by user [3.85ms]
(pass) ResumesService > Resume CRUD Operations > should throw NotFoundException for non-existent resume [1.74ms]
(pass) ResumesService > Resume CRUD Operations > should update resume if owned by user [1.75ms]
(pass) ResumesService > Resume CRUD Operations > should delete resume if owned by user [1.51ms]
(pass) ResumesService > Remaining Slots > should correctly calculate remaining slots [1.59ms]
(pass) ResumesService > Remaining Slots > should show 0 remaining when at limit [1.60ms]
(pass) Experience Order Uniqueness > should reject creating experience with duplicate order [0.23ms]
(pass) Experience Order Uniqueness > should allow creating experience with unique order [0.15ms]
(pass) Experience Order Uniqueness > should auto-assign next order when not specified [0.12ms]
(pass) isCurrent and endDate Validation > should accept isCurrent=true with endDate=null [0.10ms]
(pass) isCurrent and endDate Validation > should reject isCurrent=true with non-null endDate [0.06ms]
(pass) isCurrent and endDate Validation > should accept isCurrent=false with endDate set [0.03ms]
(pass) isCurrent and endDate Validation > should accept isCurrent=false with endDate=null (left position) [0.07ms]
(pass) Skills Reference Validation > should accept valid skill references [0.20ms]
(pass) Skills Reference Validation > should reject invalid skill references [0.08ms]
(pass) Skills Reference Validation > should accept empty skill references [0.04ms]

src/resumes/resumes.service.bug-detection.spec.ts:
(pass) ResumesService - Bug Detection > BUG #3: Resume limit should return HTTP 422 > should throw UnprocessableEntityException (422) when limit reached [2.23ms]
(pass) ResumesService - Bug Detection > BUG #3: Resume limit should return HTTP 422 > should NOT throw BadRequestException (400) for limit error [1.94ms]
(pass) ResumesService - Bug Detection > BUG #3: Resume limit should return HTTP 422 > should have exactly the message "O limite mÃ¡ximo de currÃ­culos Ã© 4" (pt-BR) [1.80ms]
(pass) ResumesService - Bug Detection > Resume limit boundary tests > should allow creating 4th resume (at limit) [1.04ms]
(pass) ResumesService - Bug Detection > Resume limit boundary tests > should reject at exactly 4 existing resumes [1.05ms]

src/resumes/resumes.repository.spec.ts:
(pass) ResumesRepository > findAll > should return empty array when user has no resumes [2.11ms]
(pass) ResumesRepository > findAll > should return all resumes for the user [1.25ms]
(pass) ResumesRepository > findOne > should return resume when it exists and belongs to user [1.04ms]
(pass) ResumesRepository > findOne > should return null when resume does not exist [0.96ms]
(pass) ResumesRepository > findOne > should return null when resume belongs to another user [0.90ms]
(pass) ResumesRepository > create > should create resume and return it with generated id [1.90ms]
(pass) ResumesRepository > create > should persist resume to storage [1.14ms]
(pass) ResumesRepository > update > should update resume when user owns it [1.69ms]
(pass) ResumesRepository > update > should throw ForbiddenException when resume does not exist [1.73ms]
(pass) ResumesRepository > update > should throw ForbiddenException when user does not own resume [2.06ms]
(pass) ResumesRepository > delete > should delete resume and return true when user owns it [1.80ms]
(pass) ResumesRepository > delete > should throw ForbiddenException when resume does not exist [0.99ms]
(pass) ResumesRepository > delete > should throw ForbiddenException when user does not own resume [1.23ms]
(pass) ResumesRepository > findByUserId > should return null when user has no resume [1.45ms]
(pass) ResumesRepository > findByUserId > should return first resume for user [1.28ms]

src/users/users.service.spec.ts:
(pass) UsersService (Facade) > getPublicProfileByUsername > should return public profile with user and resume data [3.14ms]
(pass) UsersService (Facade) > getProfile > should return user profile with expected fields [1.97ms]
(pass) UsersService (Facade) > updateProfile > should return success with updated profile data [1.92ms]
(pass) UsersService (Facade) > getPreferences > should return user preferences [2.73ms]
(pass) UsersService (Facade) > updatePreferences > should return success when preferences are updated [2.29ms]
(pass) UsersService (Facade) > getFullPreferences > should return complete preferences object [1.61ms]
(pass) UsersService (Facade) > updateFullPreferences > should return success when full preferences are updated [1.96ms]
(pass) UsersService (Facade) > updateUsername > should return success with new username [1.38ms]
(pass) UsersService (Facade) > checkUsernameAvailability > should return availability status [2.32ms]

src/upload/upload.service.spec.ts:
(pass) UploadService > uploadProfileImage > should upload valid profile image and return result [1.89ms]
(pass) UploadService > uploadProfileImage > should generate unique keys for multiple uploads [1.69ms]
(pass) UploadService > uploadProfileImage > should preserve file extension in uploaded key [1.81ms]
(pass) UploadService > uploadProfileImage > should throw BadRequestException when file size exceeds limit [2.28ms]
(pass) UploadService > uploadProfileImage > should throw BadRequestException for invalid MIME type [1.72ms]
(pass) UploadService > uploadProfileImage > should throw BadRequestException when S3 upload fails [1.11ms]
(pass) UploadService > uploadCompanyLogo > should upload valid company logo and return result [1.21ms]
(pass) UploadService > uploadCompanyLogo > should throw BadRequestException for oversized file [1.14ms]
(pass) UploadService > uploadCompanyLogo > should throw BadRequestException when S3 upload fails [1.16ms]
(pass) UploadService > deleteFile > should delete file successfully and log result [1.00ms]
(pass) UploadService > deleteFile > should return false when deletion fails without throwing [0.78ms]
(pass) UploadService > isServiceAvailable > should return true when S3 service is enabled [0.74ms]
(pass) UploadService > isServiceAvailable > should return false when S3 service is disabled [0.79ms]
(pass) UploadService > file validation > should accept all allowed MIME types [1.28ms]
(pass) UploadService > file validation > should handle files at exact size limit [2.39ms]
(pass) UploadService > file validation > should handle filenames with multiple dots correctly [2.63ms]
(pass) UploadService > file validation > should convert extension to lowercase [1.70ms]

src/upload/upload.service.security.spec.ts:
(pass) UploadService - SECURITY BUG DETECTION > BUG-024: SVG XSS Prevention > should REJECT SVG files with embedded scripts [5.93ms]
(pass) UploadService - SECURITY BUG DETECTION > BUG-024: SVG XSS Prevention > should REJECT SVG with event handlers [2.17ms]
101 |       };
102 | 
103 |       // BUG: This should detect it's not a real JPEG!
104 |       await expect(
105 |         service.uploadProfileImage('user-123', spoofedFile),
106 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:106:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:94:53)
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should REJECT file with spoofed MIME type [2.40ms]
115 |         size: 100,
116 |       };
117 | 
118 |       await expect(
119 |         service.uploadProfileImage('user-123', invalidJpeg),
120 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:120:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:109:53)
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate JPEG magic bytes (FFD8FF) [2.01ms]
128 |         size: 100,
129 |       };
130 | 
131 |       await expect(
132 |         service.uploadProfileImage('user-123', invalidPng),
133 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:133:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:123:54)
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate PNG magic bytes (89504E47) [1.11ms]
150 |       };
151 | 
152 |       // BUG: This extracts 'php' as extension but should reject!
153 |       await expect(
154 |         service.uploadProfileImage('user-123', doubleExtension),
155 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:155:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:144:65)
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT double extension attack (image.jpg.php) [0.97ms]
163 |         size: 100,
164 |       };
165 | 
166 |       await expect(
167 |         service.uploadProfileImage('user-123', nullByteAttack),
168 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:168:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:158:61)
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT null byte attack (image.php%00.jpg) [1.00ms]
176 |         size: 100,
177 |       };
178 | 
179 |       await expect(
180 |         service.uploadProfileImage('user-123', traversalAttack),
181 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:181:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:171:57)
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT directory traversal in filename [1.05ms]
(pass) UploadService - SECURITY BUG DETECTION > BUG-027: File Ownership Validation > should REJECT deleting another users file [0.99ms]

src/onboarding/onboarding.service.spec.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '@octopus-synapse/profile-contracts' from '/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/schemas/onboarding.schema.ts'
-------------------------------


src/auth/rate-limiting.bug.spec.ts:
34 |         }
35 |       }
36 | 
37 |       // BUG: No tracking of failed attempts!
38 |       // Should call incrementFailedAttempts on each failure
39 |       expect(mockLoginService.incrementFailedAttempts).toHaveBeenCalledTimes(5);
                                                            ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 5
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/rate-limiting.bug.spec.ts:39:56)
(fail) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should block IP after 5 failed login attempts [0.58ms]
(pass) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should track failed attempts per IP, not per email [0.03ms]
(pass) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should reset counter after successful login [0.02ms]
(pass) Rate Limiting - BUG DETECTION > BUG-032: Password Reset Email Bombing > should limit password reset requests per email [0.23ms]
(pass) Rate Limiting - BUG DETECTION > BUG-032: Password Reset Email Bombing > should not reveal if email exists [0.05ms]
(pass) Rate Limiting - BUG DETECTION > BUG-049: Verification Email Rate Limit > should limit verification emails per IP [0.01ms]
(pass) Rate Limiting - BUG DETECTION > BUG-049: Verification Email Rate Limit > should limit total emails sent per timeframe

src/auth/auth.service.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'JwtUserPayload' not found in './token.service'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/dsl/dsl-compiler.service.spec.ts:

# Unhandled error between tests
-------------------------------
error: Cannot find module '@octopus-synapse/profile-contracts' from '/home/ilelo/Documents/Projects/profile/profile-services/src/dsl/dsl-validator.service.ts'
-------------------------------


src/dsl/dsl-validator.service.spec.ts:

# Unhandled error between tests
-------------------------------
-------------------------------


src/dsl/dsl.repository.spec.ts:

# Unhandled error between tests
-------------------------------
-------------------------------


src/dsl/dsl-compiler.service.bug.spec.ts:

# Unhandled error between tests
-------------------------------
-------------------------------


src/dsl/dsl-compiler-data.spec.ts:

# Unhandled error between tests
-------------------------------
-------------------------------


src/health/health.controller.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'TranslationResult' not found in './types/translation.types'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/translation/translation.service.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'TranslationResult' not found in './types/translation.types'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/common/email/email.service.spec.ts:
(pass) EmailService (Adapter) > sendEmail > should complete successfully when sending raw email [2.41ms]
(pass) EmailService (Adapter) > sendEmail > should propagate error when sending fails [1.56ms]
(pass) EmailService (Adapter) > sendVerificationEmail > should complete successfully when sending verification email [1.30ms]
(pass) EmailService (Adapter) > sendVerificationEmail > should propagate error when sending fails [0.76ms]
(pass) EmailService (Adapter) > sendPasswordResetEmail > should complete successfully when sending password reset email [0.70ms]
(pass) EmailService (Adapter) > sendPasswordResetEmail > should propagate error when sending fails [0.61ms]
(pass) EmailService (Adapter) > sendWelcomeEmail > should complete successfully when sending welcome email [0.68ms]
(pass) EmailService (Adapter) > sendWelcomeEmail > should propagate error when sending fails [0.66ms]
(pass) EmailService (Adapter) > sendPasswordChangedEmail > should complete successfully when sending password changed email [0.67ms]
(pass) EmailService (Adapter) > sendPasswordChangedEmail > should propagate error when sending fails [0.67ms]

src/common/audit/audit-log.service.spec.ts:
(pass) AuditLogService > log > should create audit log entry [1.49ms]
(pass) AuditLogService > log > should extract request metadata when provided [0.84ms]
(pass) AuditLogService > log > should not throw on prisma errors [1.23ms]
(pass) AuditLogService > logUsernameChange > should log username change with before/after [1.47ms]
(pass) AuditLogService > logResumeDeletion > should log resume deletion with data snapshot [1.39ms]
(pass) AuditLogService > logVisibilityChange > should log visibility change [1.42ms]
(pass) AuditLogService > logUnauthorizedAccess > should log unauthorized access attempt [0.98ms]
(pass) AuditLogService > getUserLogs > should return logs for specific user [0.95ms]
(pass) AuditLogService > cleanupOldLogs > should delete old logs and return count [0.88ms]

src/common/cache/cache.service.spec.ts:
(pass) CacheService (Adapter) > when Redis is enabled > should report enabled status [2.59ms]
(pass) CacheService (Adapter) > when Redis is enabled > get/set operations > should return null for non-existent key [1.92ms]
(pass) CacheService (Adapter) > when Redis is enabled > get/set operations > should return stored value after set [2.10ms]
(pass) CacheService (Adapter) > when Redis is enabled > get/set operations > should return null after delete [2.20ms]
(pass) CacheService (Adapter) > when Redis is enabled > deletePattern > should delete all keys matching pattern [1.41ms]
(pass) CacheService (Adapter) > when Redis is enabled > flush > should clear all cached data [1.07ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should acquire lock when not locked [0.94ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should fail to acquire lock when already locked [0.82ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should allow acquire after release [0.92ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should report correct lock status [1.01ms]
(pass) CacheService (Adapter) > when Redis is enabled > getOrSet (cache-aside pattern) > should compute and cache value on cache miss [1.16ms]
(pass) CacheService (Adapter) > when Redis is enabled > getOrSet (cache-aside pattern) > should return cached value without computing on cache hit [1.18ms]
(pass) CacheService (Adapter) > when Redis is enabled > onModuleDestroy > should complete cleanup without error [1.13ms]
(pass) CacheService (Adapter) > when Redis is disabled > should report disabled status [2.85ms]
(pass) CacheService (Adapter) > when Redis is disabled > should return null for get operations [4.35ms]

src/common/cache/cache-lock.service.bug.spec.ts:
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:62:36)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:57:66)
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should NOT silently return true when Redis is disabled [1.98ms]
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:75:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:70:59)
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should log warning when operating without Redis [0.94ms]
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:86:36)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:81:52)
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should fail-safe for critical operations [0.92ms]
(pass) CacheLockService - BUG DETECTION > Lock Acquisition Behavior > should properly acquire lock when Redis is available [0.92ms]
(pass) CacheLockService - BUG DETECTION > Lock Acquisition Behavior > should return false when lock already held [0.84ms]
(pass) CacheLockService - BUG DETECTION > Lock Acquisition Behavior > should handle Redis errors gracefully [0.94ms]
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:145:37)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:140:64)
(fail) CacheLockService - BUG DETECTION > Alternative: In-Memory Fallback > should use in-memory fallback when Redis unavailable [1.58ms]

src/common/cache/cache-redis.bug.spec.ts:
63 | 
64 |       // BUG: Error might be silently swallowed!
65 |       const result = await cacheService.set('key', 'value');
66 | 
67 |       // Should indicate failure somehow
68 |       expect(result).toBe(false); // Or throw
                          ^
error: expect(received).toBe(expected)

Expected: false
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-redis.bug.spec.ts:68:22)
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should report when cache set fails [2.83ms]
74 |         .mockResolvedValueOnce('OK');
75 | 
76 |       await cacheService.set('key', 'value');
77 | 
78 |       // Should have retried
79 |       expect(mockRedis.client.set).toHaveBeenCalledTimes(2);
                                        ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 2
Received number of calls: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-redis.bug.spec.ts:79:36)
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should retry on transient failures [1.32ms]
(pass) Redis Cache - BUG DETECTION > BUG-050: Lock Not Released on Error > should release lock in finally block [1.10ms]
(pass) Redis Cache - BUG DETECTION > BUG-050: Lock Not Released on Error > should have auto-release mechanism for stuck locks [0.80ms]
(pass) Redis Cache - BUG DETECTION > BUG-050: Lock Not Released on Error > should provide withLock helper for safe usage [0.90ms]

src/common/pipes/parse-cuid.pipe.bug.spec.ts:
(pass) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should REJECT invalid CUID format [0.61ms]
45 |     it('should ACCEPT valid CUID format', () => {
46 |       // Valid CUIDs: start with 'c', 25 chars, lowercase alphanumeric
47 |       const validCuids = ['clh1234567890abcdefghij', 'cm3e7xyzabcdefghij12345'];
48 | 
49 |       for (const validId of validCuids) {
50 |         expect(() => pipe.transform(validId)).not.toThrow();
                                                       ^
error: expect(received).not.toThrow()

Error name: "BadRequestException"
Error message: "Invalid ID format. Expected CUID format (e.g., 'clx1abc2def3ghi4jkl5mno6p')"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/pipes/parse-cuid.pipe.bug.spec.ts:50:51)
(fail) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should ACCEPT valid CUID format [0.51ms]
(pass) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should throw on SQL injection attempts [0.17ms]
(pass) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should throw on path traversal attempts [0.14ms]
24 |     // BUG-036 FIX: Reject invalid CUID format immediately
25 |     // This prevents invalid IDs from reaching the database layer
26 |     if (!this.cuidRegex.test(value)) {
27 |       throw new BadRequestException(
28 |         `Invalid ID format. Expected CUID format (e.g., 'clx1abc2def3ghi4jkl5mno6p')`,
29 |       );
           ^
BadRequestException: Invalid ID format. Expected CUID format (e.g., 'clx1abc2def3ghi4jkl5mno6p')
      at transform (/home/ilelo/Documents/Projects/profile/profile-services/src/common/pipes/parse-cuid.pipe.ts:29:7)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/pipes/parse-cuid.pipe.bug.spec.ts:76:27)
(fail) ParseCuidPipe - BUG DETECTION > Current Buggy Behavior (documenting) > currently allows invalid IDs through (THIS IS A BUG) [0.30ms]

src/common/logger/logger.service.spec.ts:
(pass) AppLoggerService > log > should log info message without throwing [12.52ms]
(pass) AppLoggerService > log > should log with context [1.23ms]
(pass) AppLoggerService > log > should log with metadata [0.65ms]
2026-01-07 16:56:01 [Application] [31merror[39m: Error message
(pass) AppLoggerService > error > should log error message without throwing [1.15ms]
2026-01-07 16:56:01 [ErrorContext] [31merror[39m: Error message
Stack trace here
(pass) AppLoggerService > error > should log error with stack trace [0.62ms]
2026-01-07 16:56:01 [Context] [31merror[39m: Error message {"code":"E001"}
Stack
(pass) AppLoggerService > error > should log error with metadata [0.57ms]
(pass) AppLoggerService > warn > should log warning message without throwing [0.63ms]
(pass) AppLoggerService > warn > should log warning with context and metadata [0.48ms]
(pass) AppLoggerService > debug > should log debug message without throwing [0.55ms]
(pass) AppLoggerService > debug > should log debug with context and metadata [0.58ms]
(pass) AppLoggerService > verbose > should log verbose message without throwing [0.60ms]
(pass) AppLoggerService > verbose > should use default context when set [0.56ms]
(pass) AppLoggerService > setContext > should set context for subsequent logs [0.61ms]
2026-01-07 16:56:01 [ErrorService] [31merror[39m: Error occurred {"errorCode":"E500"}
(pass) AppLoggerService > errorWithMeta > should log error with metadata using default context [0.64ms]

src/common/guards/roles.guard.spec.ts:
(pass) RolesGuard > canActivate > should allow access when no roles are required [1.59ms]
(pass) RolesGuard > canActivate > should allow access when user has required role [0.84ms]
(pass) RolesGuard > canActivate > should deny access when user does not have required role [0.65ms]
(pass) RolesGuard > canActivate > should deny access when user is not authenticated [0.68ms]
(pass) RolesGuard > canActivate > should allow access when user has one of multiple allowed roles [0.72ms]
(pass) RolesGuard > canActivate > should deny access when user role is not in allowed roles list [0.70ms]
(pass) RolesGuard > canActivate > should check roles from handler metadata [0.76ms]
(pass) RolesGuard > canActivate > should allow any authenticated user when roles array is empty [0.76ms]
(pass) RolesGuard > canActivate > should handle null user in request [0.75ms]
(pass) RolesGuard > role hierarchy > should not implicitly grant higher privileges to admins [0.70ms]
(pass) RolesGuard > role hierarchy > should require exact role match [0.69ms]

src/resumes/services/experience.service.bug-detection.spec.ts:
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should REJECT isCurrent=true with endDate set [1.73ms]
 96 |         isCurrent: false,
 97 |       };
 98 | 
 99 |       await expect(
100 |         service.addToResume('resume-123', 'user-123', invalidDto as any),
101 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:101:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:89:71)
(fail) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should REJECT isCurrent=false with endDate=null (ambiguous) [1.15ms]
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should ACCEPT isCurrent=true with endDate=null [0.79ms]
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should ACCEPT isCurrent=false with valid endDate [0.85ms]
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should include "isCurrent" or "endDate" in error message [0.98ms]
(pass) ExperienceService - Bug Detection > Date range validation > should REJECT endDate before startDate [0.70ms]
(pass) ExperienceService - Bug Detection > Date range validation > should REJECT same startDate and endDate [0.74ms]
216 |         order: 0, // Duplicate order!
217 |       };
218 | 
219 |       await expect(
220 |         service.addToResume('resume-123', 'user-123', duplicateOrderDto as any),
221 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:221:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:202:66)
(fail) ExperienceService - Bug Detection > Order uniqueness validation > should REJECT creating experience with duplicate order [0.97ms]
(pass) ExperienceService - Bug Detection > Order uniqueness validation > should ACCEPT experience with unique order [1.04ms]

src/resumes/services/project.service.spec.ts:
(pass) ProjectService > listForResume > should return paginated projects for resume [1.80ms]
(pass) ProjectService > getById > should return single project [1.04ms]
(pass) ProjectService > getById > should throw NotFoundException when project not found [0.99ms]
(pass) ProjectService > addToResume > should create new project [0.71ms]
(pass) ProjectService > updateById > should update existing project [0.94ms]
(pass) ProjectService > updateById > should throw NotFoundException when project not found [0.74ms]
(pass) ProjectService > deleteById > should delete project successfully [0.87ms]
(pass) ProjectService > deleteById > should throw NotFoundException when project not found [0.87ms]

src/resumes/services/bug-bounty.service.spec.ts:
(pass) BugBountyService > should be defined [1.69ms]
(pass) BugBountyService > should have correct entity name [0.70ms]
(pass) BugBountyService > should have a logger instance [0.66ms]
(pass) BugBountyService > CRUD operations > should list bug bounties for resume [0.76ms]
(pass) BugBountyService > CRUD operations > should add bug bounty to resume [0.69ms]
(pass) BugBountyService > CRUD operations > should delete bug bounty [0.76ms]

src/resumes/services/education.service.bug.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the EducationService (?, ResumesRepository). Please make sure that the argument EducationRepository at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If EducationRepository is a provider, is it part of the current RootTestModule?
- If EducationRepository is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing EducationRepository */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "EducationService",
   context: {
  index: 0,
  dependencies: [
    [class EducationRepository], [class ResumesRepository]
  ],
  name: [class EducationRepository],
},
  metadata: {
  id: "2339b0af84e5f863d7373",
},
 moduleRef: {
  id: "0e8b7c9d9a2339b0af84e",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REJECT isCurrent=true with endDate set [3.99ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the EducationService (?, ResumesRepository). Please make sure that the argument EducationRepository at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If EducationRepository is a provider, is it part of the current RootTestModule?
- If EducationRepository is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing EducationRepository */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "EducationService",
   context: {
  index: 0,
  dependencies: [
    [class EducationRepository], [class ResumesRepository]
  ],
  name: [class EducationRepository],
},
  metadata: {
  id: "304452522d0d13002fdab",
},
 moduleRef: {
  id: "63d7373fc0304452522d0",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REJECT endDate before startDate [1.42ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the EducationService (?, ResumesRepository). Please make sure that the argument EducationRepository at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If EducationRepository is a provider, is it part of the current RootTestModule?
- If EducationRepository is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing EducationRepository */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "EducationService",
   context: {
  index: 0,
  dependencies: [
    [class EducationRepository], [class ResumesRepository]
  ],
  name: [class EducationRepository],
},
  metadata: {
  id: "1a7c6a5f61614eab6b637",
},
 moduleRef: {
  id: "002fdabd0f1a7c6a5f616",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REQUIRE endDate when isCurrent=false [1.21ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the EducationService (?, ResumesRepository). Please make sure that the argument EducationRepository at index [0] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If EducationRepository is a provider, is it part of the current RootTestModule?
- If EducationRepository is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing EducationRepository */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "EducationService",
   context: {
  index: 0,
  dependencies: [
    [class EducationRepository], [class ResumesRepository]
  ],
  name: [class EducationRepository],
},
  metadata: {
  id: "2db325bb0af0fb3c7257d",
},
 moduleRef: {
  id: "ab6b63774c2db325bb0af",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) EducationService - BUG DETECTION > BUG-052: Order Not Validated > should REJECT duplicate order values [0.81ms]

src/resumes/services/certification.service.spec.ts:
(pass) CertificationService > should be defined [1.04ms]
(pass) CertificationService > should have correct entity name [0.46ms]
(pass) CertificationService > should have a logger instance [0.46ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should list certifications for resume [0.63ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should get certification by id [0.56ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should add certification to resume [0.54ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should update certification [0.57ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should delete certification [0.51ms]

src/resumes/services/talk.service.spec.ts:
(pass) TalkService > should be defined [1.49ms]
(pass) TalkService > should have correct entity name [0.58ms]
(pass) TalkService > should have a logger instance [0.43ms]
(pass) TalkService > CRUD operations > should list talks for resume [0.64ms]
(pass) TalkService > CRUD operations > should add talk to resume [0.57ms]
(pass) TalkService > CRUD operations > should delete talk [0.64ms]

src/resumes/services/language.service.spec.ts:
(pass) LanguageService > should be defined [1.02ms]
(pass) LanguageService > should have correct entity name [0.53ms]
(pass) LanguageService > should have a logger instance [0.42ms]
(pass) LanguageService > CRUD operations (inherited from BaseSubResourceService) > should list languages for resume [0.58ms]
(pass) LanguageService > CRUD operations (inherited from BaseSubResourceService) > should add language to resume [0.57ms]
(pass) LanguageService > CRUD operations (inherited from BaseSubResourceService) > should delete language [0.51ms]

src/resumes/services/xss-sanitization.bug.spec.ts:
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 1 in summary [1.92ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 2 in summary [0.79ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 3 in summary [0.72ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 4 in summary [0.69ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 5 in summary [0.64ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 6 in summary [0.66ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 7 in summary [0.68ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 8 in summary [0.64ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 9 in summary [0.63ms]
72 | 
73 |         const createdResume = mockRepository.create.mock.results[0].value;
74 | 
75 |         // BUG: XSS payload stored as-is!
76 |         // Should be sanitized or escaped
77 |         expect(createdResume.summary).not.toContain('<script');
                                               ^
error: Received value must be an array type, or both received and expected values must be strings.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:77:43)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 10 in summary [0.57ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize HTML in experience description [0.57ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize HTML in project description [0.55ms]
(pass) XSS Sanitization - BUG DETECTION > URL Validation > should reject javascript: URLs in project links [0.53ms]
(pass) XSS Sanitization - BUG DETECTION > URL Validation > should reject data: URLs in image fields [0.57ms]

src/resumes/services/hackathon.service.spec.ts:
(pass) HackathonService > should be defined [0.82ms]
(pass) HackathonService > should have correct entity name [0.46ms]
(pass) HackathonService > should have a logger instance [0.41ms]
(pass) HackathonService > CRUD operations > should list hackathons for resume [0.53ms]
(pass) HackathonService > CRUD operations > should add hackathon to resume [0.52ms]
(pass) HackathonService > CRUD operations > should delete hackathon [0.49ms]

src/resumes/services/recommendation.service.spec.ts:
(pass) RecommendationService > should be defined [0.77ms]
(pass) RecommendationService > should have correct entity name [0.43ms]
(pass) RecommendationService > should have a logger instance [0.39ms]
(pass) RecommendationService > CRUD operations > should list recommendations for resume [0.49ms]
(pass) RecommendationService > CRUD operations > should add recommendation to resume [0.48ms]
(pass) RecommendationService > CRUD operations > should delete recommendation [0.46ms]

src/resumes/services/education.service.spec.ts:
(pass) EducationService > listForResume > should return paginated education entries [1.86ms]
(pass) EducationService > getById > should return single education entry [1.12ms]
(pass) EducationService > getById > should throw NotFoundException when not found [0.73ms]
(pass) EducationService > addToResume > should create new education entry [0.85ms]
(pass) EducationService > updateById > should update existing education entry [0.71ms]
(pass) EducationService > deleteById > should delete education entry successfully [0.48ms]
(pass) EducationService > reorder > should reorder education entries with custom message [0.55ms]

src/resumes/services/experience.service.spec.ts:
(pass) ExperienceService > listForResume > should return paginated experiences [0.76ms]
(pass) ExperienceService > getById > should return single experience [0.50ms]
(pass) ExperienceService > getById > should throw NotFoundException when not found [0.51ms]
(pass) ExperienceService > addToResume > should create new experience [0.51ms]
(pass) ExperienceService > updateById > should update existing experience [0.64ms]
(pass) ExperienceService > updateById > should throw NotFoundException when not found [0.47ms]
(pass) ExperienceService > deleteById > should delete experience successfully [0.50ms]
(pass) ExperienceService > deleteById > should throw NotFoundException when not found [0.46ms]

src/resumes/services/interest.service.spec.ts:
(pass) InterestService > should be defined [2.02ms]
(pass) InterestService > should have correct entity name [0.69ms]
(pass) InterestService > should have a logger instance [0.66ms]
(pass) InterestService > CRUD operations > should list interests for resume [0.72ms]
(pass) InterestService > CRUD operations > should add interest to resume [0.77ms]
(pass) InterestService > CRUD operations > should delete interest [0.70ms]

src/resumes/services/publication.service.spec.ts:
(pass) PublicationService > listForResume > should return paginated publications [1.31ms]
(pass) PublicationService > getById > should return single publication [0.79ms]
(pass) PublicationService > getById > should throw NotFoundException when not found [0.72ms]
(pass) PublicationService > addToResume > should create new publication [0.73ms]
(pass) PublicationService > updateById > should update existing publication [1.39ms]
(pass) PublicationService > deleteById > should delete publication successfully [1.65ms]

src/resumes/services/open-source.service.spec.ts:
(pass) OpenSourceService > should be defined [1.00ms]
(pass) OpenSourceService > should have correct entity name [0.64ms]
(pass) OpenSourceService > should have a logger instance [0.62ms]
(pass) OpenSourceService > CRUD operations > should list open source contributions for resume [0.85ms]
(pass) OpenSourceService > CRUD operations > should add open source contribution to resume [0.76ms]
(pass) OpenSourceService > CRUD operations > should delete open source contribution [0.78ms]

src/resumes/services/achievement.service.spec.ts:
(pass) AchievementService > findAll > should return paginated achievements for valid resume [2.19ms]
(pass) AchievementService > findAll > should throw ForbiddenException if resume not found [1.60ms]
(pass) AchievementService > findAll > should accept custom page and limit [0.95ms]
(pass) AchievementService > findOne > should return achievement for valid resume and id [0.78ms]
(pass) AchievementService > findOne > should throw NotFoundException if achievement not found [0.74ms]
(pass) AchievementService > findOne > should throw ForbiddenException if resume not owned by user [0.76ms]
(pass) AchievementService > create > should create achievement for valid resume [0.81ms]
(pass) AchievementService > create > should throw ForbiddenException if resume not owned by user [0.67ms]
(pass) AchievementService > update > should update achievement for valid resume and id [0.70ms]
(pass) AchievementService > update > should throw NotFoundException if achievement not found [0.64ms]
(pass) AchievementService > remove > should delete achievement for valid resume and id [0.67ms]
(pass) AchievementService > remove > should throw NotFoundException if achievement not found [0.63ms]
(pass) AchievementService > reorder > should reorder achievements for valid resume [0.88ms]
(pass) AchievementService > reorder > should throw ForbiddenException if resume not owned by user [0.72ms]

src/resumes/services/limits.bug.spec.ts:
(pass) Resource Limits - BUG DETECTION > BUG-061: No Skills Limit > should limit skills per resume [4.10ms]
(pass) Resource Limits - BUG DETECTION > BUG-062: No Experiences Limit > should limit experiences per resume [1.23ms]
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit education entries [0.04ms]
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit projects [0.02ms]
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit certifications [0.01ms]
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit total resume size [0.01ms]

src/export/services/resume-docx.service.spec.ts:
(pass) ResumeDOCXService > generate > should generate DOCX for complete resume [0.92ms]
(pass) ResumeDOCXService > generate > should throw NotFoundException when user not found [0.56ms]
(pass) ResumeDOCXService > generate > should throw NotFoundException when resume not found [0.52ms]
(pass) ResumeDOCXService > generate > should handle errors from builder service [0.42ms]

src/export/services/resume-pdf.service.spec.ts:
(pass) ResumePDFService > generate > should generate PDF for valid resume with default options [0.81ms]
(pass) ResumePDFService > generate > should use custom palette parameter [0.53ms]
(pass) ResumePDFService > generate > should use custom language parameter [0.45ms]
(pass) ResumePDFService > generate > should include bannerColor when provided [0.52ms]
(pass) ResumePDFService > generate > should include userId when provided [0.52ms]
(pass) ResumePDFService > generate > should pass through all options to generator [0.78ms]
(pass) ResumePDFService > generate > should handle errors from generator [1.08ms]

src/export/services/docx-builder.service.spec.ts:
(pass) DocxBuilderService > generate > should return DOCX buffer [40.83ms]
(pass) DocxBuilderService > generate > should throw NotFoundException when user not found [1.25ms]
(pass) DocxBuilderService > generate > should throw NotFoundException when resume not found [0.78ms]
(pass) DocxBuilderService > generate > should use sections service to create document structure [13.49ms]
(pass) DocxBuilderService > generate > should apply document styles [16.33ms]

src/export/services/browser-manager.service.spec.ts:

# Unhandled error between tests
-------------------------------
1 | import { Test, TestingModule } from '@nestjs/testing';
2 | import { BrowserManagerService } from './browser-manager.service';
3 | import puppeteer, { Browser } from 'puppeteer';
4 | 
5 | jest.mock('puppeteer');
         ^
TypeError: mock(module, fn) requires a function
      at /home/ilelo/Documents/Projects/profile/profile-services/src/export/services/browser-manager.service.spec.ts:5:6
      at loadAndEvaluateModule (2:1)
-------------------------------


src/export/services/banner-capture.service.spec.ts:
(pass) BannerCaptureService > capture > should capture banner screenshot with default parameters [2.13ms]
(pass) BannerCaptureService > capture > should capture banner screenshot with custom palette [1.39ms]
(pass) BannerCaptureService > capture > should include logo URL when provided [1.68ms]
(pass) BannerCaptureService > capture > should apply correct viewport dimensions [1.35ms]
(pass) BannerCaptureService > capture > should wait for code block rendering [1.08ms]
(pass) BannerCaptureService > capture > should apply quality styles (antialiasing) [0.96ms]
(pass) BannerCaptureService > capture > should close page on success [0.67ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerCaptureService] [39m[31m[BannerCapture] #banner not found![39m
(pass) BannerCaptureService > error handling > should handle #banner not found [1.51ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerPageSetup] [39m[31m[BannerCapture] Error during page.goto:[39m
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerPageSetup] [39mError: Navigation failed
    at <anonymous> [90m(/home/ilelo/Documents/Projects/profile/profile-services/[39msrc/export/services/banner-capture.service.spec.ts:169:47[90m)[39m
    at <anonymous> [90m(/home/ilelo/Documents/Projects/profile/profile-services/[39msrc/export/services/banner-capture.service.spec.ts:168:49[90m)[39m
(pass) BannerCaptureService > error handling > should close page on navigation error [2.64ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerReadyWaiter] [39m[31m[BannerCapture] <body> HTML snippet:[39m
<div id="banner"></div>
(pass) BannerCaptureService > error handling > should close page on selector timeout [0.96ms]
(pass) BannerCaptureService > error handling > should handle broken logo image (404) [0.85ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerPageSetup] [39m[31m[BannerCapture] Error during page.goto:[39m
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerPageSetup] [39mError: Navigation failed
    at <anonymous> [90m(/home/ilelo/Documents/Projects/profile/profile-services/[39msrc/export/services/banner-capture.service.spec.ts:207:47[90m)[39m
    at <anonymous> [90m(/home/ilelo/Documents/Projects/profile/profile-services/[39msrc/export/services/banner-capture.service.spec.ts:206:60[90m)[39m
(pass) BannerCaptureService > error handling > should take debug screenshot on navigation error [0.92ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:01 PM [31m  ERROR[39m [38;5;3m[BannerReadyWaiter] [39m[31m[BannerCapture] <body> HTML snippet:[39m
<div id="banner"></div>
(pass) BannerCaptureService > error handling > should take debug screenshot on selector wait error [0.75ms]
(pass) BannerCaptureService > URL building > should use configured host and port [0.81ms]
(pass) BannerCaptureService > URL building > should use default host when not configured [0.68ms]
(pass) BannerCaptureService > URL building > should properly encode palette parameter [0.89ms]
(pass) BannerCaptureService > URL building > should properly encode logo URL parameter [1.36ms]
(pass) BannerCaptureService > banner element capture > should capture #banner element as PNG [1.63ms]
(pass) BannerCaptureService > banner element capture > should return buffer from element screenshot [1.57ms]
(pass) BannerCaptureService > wait for rendering > should wait for fonts to load [1.14ms]
(pass) BannerCaptureService > wait for rendering > should wait for #banner selector [0.79ms]
(pass) BannerCaptureService > wait for rendering > should wait for #company-logo when logo URL provided [0.75ms]
(pass) BannerCaptureService > wait for rendering > should not wait for logo when no logo URL provided [0.76ms]

src/export/services/pdf-generator.service.spec.ts:
(pass) PdfGeneratorService > generate > should return PDF buffer [1.42ms]
(pass) PdfGeneratorService > generate > should setup page before navigation [0.69ms]
(pass) PdfGeneratorService > generate > should wait for resume to be ready [0.54ms]
(pass) PdfGeneratorService > generate > should extract and apply styles [0.56ms]
(pass) PdfGeneratorService > generate > should close page after generation [0.71ms]
(pass) PdfGeneratorService > generate > should close page even on error [0.93ms]
(pass) PdfGeneratorService > generate > should pass options to URL builder [1.46ms]

src/export/services/pdf-generator.service.bug.spec.ts:
(fail) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should have timeout on page operations [31003.26ms]
  ^ this test timed out after 5000ms.
(pass) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should cleanup page even on timeout [2.42ms]
(pass) PdfGeneratorService - BUG DETECTION > BUG: Resource Exhaustion > should limit concurrent PDF generations [4.76ms]

src/admin/services/skill-admin.service.bug.spec.ts:
66 |         name: 'TypeScript',
67 |         category: 'Programming',
68 |       });
69 | 
70 |       // BUG: Should use transaction to prevent race condition!
71 |       expect(mockPrisma.$transaction).toHaveBeenCalled();
                                           ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:71:39)
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should use transaction for order assignment [2.01ms]
 98 |         (results[0] as any).skill.order,
 99 |         (results[1] as any).skill.order,
100 |       ];
101 | 
102 |       // Should have unique orders
103 |       expect(new Set(orders).size).toBe(2);
                                         ^
error: expect(received).toBe(expected)

Expected: 2
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:103:36)
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should handle concurrent skill additions without duplicate orders [1.16ms]
120 |         name: 'TypeScript',
121 |         category: 'Programming',
122 |       });
123 | 
124 |       // BUG: No audit log created!
125 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /SKILL_CREATED|CREATE_SKILL/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:125:42)
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when adding skill [1.31ms]
136 |       mockPrisma.skill.delete.mockResolvedValue({ id: 'skill-1' });
137 | 
138 |       await service.delete('skill-1');
139 | 
140 |       // BUG: No audit log created!
141 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /SKILL_DELETED|DELETE_SKILL/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:141:42)
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when deleting skill [1.61ms]
(pass) SkillAdminService - BUG DETECTION > BUG-044: No Authorization Check on Delete > should check admin authorization before delete [1.78ms]

src/admin/services/user-admin-mutation.service.spec.ts:
(pass) UserAdminMutationService > create > should create user successfully [1.87ms]
(pass) UserAdminMutationService > create > should hash password before saving [1.01ms]
94 |         service.create({
95 |           email: 'user@example.com',
96 |           password: 'Password123!',
97 |           name: 'New User',
98 |         }),
99 |       ).rejects.toThrow(ConflictException);
                     ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:99:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:90:60)
(fail) UserAdminMutationService > create > should throw ConflictException when email exists [1.17ms]
(pass) UserAdminMutationService > create > should use default role USER if not specified [1.12ms]
(pass) UserAdminMutationService > update > should update user successfully [1.89ms]
(pass) UserAdminMutationService > update > should throw NotFoundException when user not found [2.58ms]
146 |         .mockResolvedValueOnce(mockUser) // findUserOrThrow
147 |         .mockResolvedValueOnce({ id: 'other-user' }); // email check
148 | 
149 |       await expect(
150 |         service.update('user-1', { email: 'taken@example.com' }),
151 |       ).rejects.toThrow(ConflictException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:151:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:144:68)
(fail) UserAdminMutationService > update > should throw ConflictException when email already in use [2.13ms]
(pass) UserAdminMutationService > delete > should delete user successfully [1.53ms]
(pass) UserAdminMutationService > delete > should throw NotFoundException when user not found [1.96ms]
(pass) UserAdminMutationService > delete > should prevent deleting last admin [1.20ms]
(pass) UserAdminMutationService > delete > should allow deleting admin if more than one exists [1.41ms]
(pass) UserAdminMutationService > resetPassword > should reset password successfully [1.59ms]
(pass) UserAdminMutationService > resetPassword > should throw NotFoundException when user not found [1.42ms]

src/admin/services/admin-stats.service.spec.ts:
(pass) AdminStatsService > getStats > should return correct statistics [1.76ms]
(pass) AdminStatsService > getStats > should filter admins correctly [0.76ms]

src/admin/services/user-admin-query.service.spec.ts:
(pass) UserAdminQueryService > getAll > should return paginated users list [1.14ms]
(pass) UserAdminQueryService > getAll > should filter by search term [0.66ms]
(pass) UserAdminQueryService > getAll > should filter by role [0.59ms]
(pass) UserAdminQueryService > getAll > should calculate correct pagination [0.71ms]
(pass) UserAdminQueryService > getById > should return user without password [1.19ms]
(pass) UserAdminQueryService > getById > should include resumes and preferences [1.10ms]
(pass) UserAdminQueryService > getById > should throw NotFoundException when user not found [1.05ms]

src/admin/services/csrf.bug.spec.ts:
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should require CSRF token for DELETE user [0.01ms]
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should require CSRF token for password change [0.01ms]
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should require CSRF token for email change
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should validate CSRF token origin
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should use SameSite=Strict for session cookies

src/admin/services/race-condition.spec.ts:
73 |       });
74 | 
75 |       await service.create(createDto);
76 | 
77 |       // BUG: The operation is NOT using a transaction!
78 |       expect(mockPrisma.$transaction).toHaveBeenCalled();
                                           ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:78:39)
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should use transaction to prevent race condition [1.35ms]
93 |         code: 'P2002', // Prisma unique constraint violation
94 |         meta: { target: ['email'] },
95 |       });
96 | 
97 |       // BUG: Should catch P2002 and throw ConflictException
98 |       await expect(service.create(createDto)).rejects.toThrow(
                                                           ^
error: expect(received).toThrow(expected)

Expected constructor: ConflictException
Received constructor: Object

Received value: {
  code: "P2002",
  meta: {
    target: [ "email" ],
  },
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:98:55)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:81:64)
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should handle unique constraint violation gracefully [0.99ms]
(pass) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should NOT use separate check and create operations [0.81ms]
147 |         code: 'P2002',
148 |         meta: { target: ['email'] },
149 |       });
150 | 
151 |       // And convert P2002 to ConflictException
152 |       await expect(service.create(createDto)).rejects.toThrow(
                                                            ^
error: expect(received).toThrow(expected)

Expected constructor: ConflictException
Received constructor: Object

Received value: {
  code: "P2002",
  meta: {
    target: [ "email" ],
  },
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:152:55)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:135:57)
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 1: Try create, catch unique violation [0.65ms]
160 |       mockPrisma.$transaction.mockImplementation(async (callback: any) => {
161 |         return callback(mockPrisma);
162 |       });
163 | 
164 |       // The transaction should be called with SERIALIZABLE isolation
165 |       expect(mockPrisma.$transaction).toHaveBeenCalledWith(
                                            ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  Any<Function>, ObjectContaining {
    isolationLevel: "Serializable",
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:165:39)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:157:62)
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 2: Transaction with serializable isolation [0.68ms]

src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should REJECT updating last admin role to USER [2.64ms]
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should REJECT updating last admin role to APPROVER [1.19ms]
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should ALLOW updating admin role if there are multiple admins [0.83ms]
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should include "last admin" in error message [0.98ms]
(pass) UserAdminMutationService - Bug Detection > Self-demotion protection > should REJECT last admin demoting themselves [0.83ms]
(pass) UserAdminMutationService - Bug Detection > Self-demotion protection > should REJECT last admin setting their role to null [0.76ms]
152 |       mockPrisma.auditLog = { create: jest.fn() };
153 | 
154 |       await service.update('user-456', { role: UserRole.ADMIN });
155 | 
156 |       // Check that audit log was created
157 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /ROLE_CHANGE|PROMOTION|ADMIN_GRANTED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:157:42)
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when promoting user to admin [0.94ms]
174 |       });
175 |       mockPrisma.auditLog = { create: jest.fn() };
176 | 
177 |       await service.update('admin-123', { role: UserRole.USER });
178 | 
179 |       expect(mockPrisma.auditLog.create).toHaveBeenCalled();
                                               ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:179:42)
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when demoting admin to user [0.94ms]
187 |     it('should REJECT weak passwords', async () => {
188 |       mockPrisma.user.findUnique.mockResolvedValue(regularUser);
189 | 
190 |       await expect(
191 |         service.resetPassword('user-456', { newPassword: '123' }), // Too weak
192 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:192:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:187:40)
(fail) UserAdminMutationService - Bug Detection > Password reset > should REJECT weak passwords [0.93ms]
196 |       mockPrisma.user.findUnique.mockResolvedValue(regularUser);
197 |       mockPrisma.auditLog = { create: jest.fn() };
198 | 
199 |       await service.resetPassword('user-456', { newPassword: 'StrongP@ss1!' });
200 | 
201 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /PASSWORD_RESET|ADMIN_RESET/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:201:42)
(fail) UserAdminMutationService - Bug Detection > Password reset > should create audit log for password reset [1.20ms]

src/mec-sync/parsers/entity.normalizer.spec.ts:
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should normalize a complete institution row [0.37ms]
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should uppercase UF [0.07ms]
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should handle missing optional fields [0.05ms]
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should normalize text with extra whitespace [0.04ms]
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when CO_IES is not a number [0.03ms]
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when CO_IES is empty [0.02ms]
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when NO_IES is empty [0.02ms]
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when SG_UF_IES is empty [0.02ms]
(pass) Entity Normalizer > normalizeInstitution > Organization and Category Mapping > should map organization type [0.05ms]
(pass) Entity Normalizer > normalizeInstitution > Organization and Category Mapping > should map category type [0.07ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should normalize a complete course row [0.18ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should handle missing optional fields [0.07ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should map degree type [0.07ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should map modality type [0.03ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should map course status [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when CO_CURSO is not a number [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when CO_CURSO is empty [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when CO_IES is not a number [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when NO_CURSO is empty [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Edge Cases > should handle zero as valid course code [0.03ms]
(pass) Entity Normalizer > normalizeCourse > Edge Cases > should handle floating point numbers (truncates) [0.03ms]
(pass) Entity Normalizer > normalizeCourse > Edge Cases > should normalize course name with special characters [0.07ms]

src/mec-sync/parsers/mec-row.mapper.spec.ts:
(pass) MEC Row Mapper > mapToMecRow > Standard Column Names > should map values with standard MEC column names [0.35ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CODIGO_IES as alternative to CO_IES [0.10ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle NOME_IES as alternative to NO_IES [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle ORGANIZACAO_ACADEMICA as alternative [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle TP_ORGANIZACAO_ACADEMICA as alternative [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CATEGORIA_ADMINISTRATIVA as alternative [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CODIGO_MUNICIPIO as alternative [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle MUNICIPIO as alternative to NO_MUNICIPIO_IES [0.06ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle UF as alternative to SG_UF_IES [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CODIGO_CURSO as alternative to CO_CURSO [0.07ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle NOME_CURSO as alternative to NO_CURSO [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle GRAU as alternative to TP_GRAU [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle MODALIDADE as alternative to TP_MODALIDADE [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle AREA_OCDE_CINE as alternative [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CARGA_HORARIA as alternative [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle SITUACAO_CURSO as alternative [0.05ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should return empty strings for missing columns [0.09ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should handle partial column maps [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should handle values with special characters [0.04ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should prefer first alternative when multiple exist [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Real-world MEC Data > should parse a typical federal university row [0.07ms]
(pass) MEC Row Mapper > mapToMecRow > Real-world MEC Data > should parse a private EaD institution row [0.06ms]

src/mec-sync/parsers/csv-line.parser.spec.ts:
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should parse a simple CSV line [0.30ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should handle empty values [0.05ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should handle trailing comma [0.05ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should handle leading comma [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should trim whitespace from values [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle quoted values [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle commas inside quotes [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle escaped quotes (double quotes) [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle multiple quoted fields [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle empty quoted value [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle empty string [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle single value [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle only commas [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle newlines inside quotes [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle unicode characters [0.07ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle special characters [0.05ms]
(pass) CSV Line Parser > parseCsvLine > MEC CSV Specific Cases > should handle typical MEC institution row [0.14ms]
(pass) CSV Line Parser > parseCsvLine > MEC CSV Specific Cases > should handle quoted institution names with commas [0.04ms]
(pass) CSV Line Parser > buildColumnMap > should build a map from header array [0.25ms]
(pass) CSV Line Parser > buildColumnMap > should normalize column names to uppercase [0.07ms]
(pass) CSV Line Parser > buildColumnMap > should trim whitespace from column names [0.05ms]
(pass) CSV Line Parser > buildColumnMap > should remove BOM from first column [0.05ms]
(pass) CSV Line Parser > buildColumnMap > should handle empty header array [0.03ms]
(pass) CSV Line Parser > buildColumnMap > should handle MEC-style headers [0.07ms]
(pass) CSV Line Parser > getColumnValue > should get value by first key match [0.11ms]
(pass) CSV Line Parser > getColumnValue > should try fallback keys in order [0.04ms]
(pass) CSV Line Parser > getColumnValue > should return empty string when no key matches [0.03ms]
(pass) CSV Line Parser > getColumnValue > should return empty string when index is out of bounds [0.08ms]
(pass) CSV Line Parser > getColumnValue > should handle empty values array [0.05ms]
(pass) CSV Line Parser > getColumnValue > should handle multiple fallback keys [0.04ms]
(pass) CSV Line Parser > getColumnValue > should prefer first matching key [0.03ms]

src/mec-sync/services/course-query.service.spec.ts:
(pass) CourseQueryService > listByInstitution > should return courses for institution [0.97ms]
(pass) CourseQueryService > listByInstitution > should cache results per institution [0.56ms]
(pass) CourseQueryService > getByCode > should return course when found [0.53ms]
(pass) CourseQueryService > getByCode > should return null when course not found [0.47ms]
(pass) CourseQueryService > search > should return matching courses [0.82ms]
(pass) CourseQueryService > search > should return empty array for short queries [0.51ms]
(pass) CourseQueryService > search > should cache search results [0.53ms]
(pass) CourseQueryService > getKnowledgeAreas > should return list of knowledge areas [0.50ms]

src/mec-sync/services/mec-stats.service.spec.ts:
(pass) MecStatsService > getStats > should return comprehensive statistics [1.63ms]
(pass) MecStatsService > getStats > should include all course degree types [0.91ms]
(pass) MecStatsService > getStats > should include institutions by state [0.79ms]
(pass) MecStatsService > getStats > should handle null degree gracefully [0.72ms]
(pass) MecStatsService > getStats > should fetch all data in parallel [0.67ms]

src/mec-sync/services/institution-query.service.spec.ts:
(pass) InstitutionQueryService > listAll > should return all institutions [3.07ms]
(pass) InstitutionQueryService > listAll > should cache results [1.08ms]
(pass) InstitutionQueryService > listByState > should return institutions filtered by state [0.90ms]
(pass) InstitutionQueryService > listByState > should normalize state to uppercase [0.74ms]
(pass) InstitutionQueryService > listByState > should cache results per state [0.64ms]
(pass) InstitutionQueryService > getByCode > should return institution with courses when found [0.74ms]
(pass) InstitutionQueryService > getByCode > should return null when institution not found [0.62ms]
(pass) InstitutionQueryService > search > should return matching institutions [0.76ms]
(pass) InstitutionQueryService > search > should return empty array for short queries [0.69ms]
(pass) InstitutionQueryService > search > should normalize query to lowercase [0.83ms]
(pass) InstitutionQueryService > getStateList > should return list of distinct UFs [0.75ms]

src/mec-sync/services/mec-data-injection.bug.spec.ts:
35 | 
36 |         const result = mockRowProcessor.processRow(maliciousRow);
37 | 
38 |         // BUG: Malicious content stored as-is!
39 |         // Should sanitize or reject
40 |         expect(result.nome).not.toContain('<script');
                                     ^
error: expect(received).not.toContain(expected)

Expected to not contain: "<script"
Received: "<script>alert(\"XSS\")</script>"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/mec-data-injection.bug.spec.ts:40:33)
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 1 [0.27ms]
36 |         const result = mockRowProcessor.processRow(maliciousRow);
37 | 
38 |         // BUG: Malicious content stored as-is!
39 |         // Should sanitize or reject
40 |         expect(result.nome).not.toContain('<script');
41 |         expect(result.nome).not.toContain('DROP TABLE');
                                     ^
error: expect(received).not.toContain(expected)

Expected to not contain: "DROP TABLE"
Received: "\"; DROP TABLE courses; --"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/mec-data-injection.bug.spec.ts:41:33)
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 2 [0.07ms]
37 | 
38 |         // BUG: Malicious content stored as-is!
39 |         // Should sanitize or reject
40 |         expect(result.nome).not.toContain('<script');
41 |         expect(result.nome).not.toContain('DROP TABLE');
42 |         expect(result.nome).not.toContain('process.env');
                                     ^
error: expect(received).not.toContain(expected)

Expected to not contain: "process.env"
Received: "${process.env.DATABASE_URL}"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/mec-data-injection.bug.spec.ts:42:33)
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 3 [0.05ms]
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 4 [0.01ms]
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 5
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should validate course code is numeric [0.04ms]
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should limit field lengths [0.34ms]

src/mec-sync/controllers/mec-course.controller.bug.spec.ts:
35 |     // BUG-035 FIX: Validate parseInt result
36 |     let parsedLimit = APP_CONSTANTS.DEFAULT_PAGE_SIZE;
37 |     if (limit) {
38 |       parsedLimit = parseInt(limit, 10);
39 |       if (isNaN(parsedLimit) || parsedLimit <= 0) {
40 |         throw new BadRequestException(
                   ^
BadRequestException: Invalid limit parameter. Must be a positive number.
 response: {
  message: "Invalid limit parameter. Must be a positive number.",
  error: "Bad Request",
  statusCode: 400,
},
   status: 400,
  options: {},

      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:40:15)
      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:32:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:39:24)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:37:51)
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should validate limit is a valid number [1.89ms]
35 |     // BUG-035 FIX: Validate parseInt result
36 |     let parsedLimit = APP_CONSTANTS.DEFAULT_PAGE_SIZE;
37 |     if (limit) {
38 |       parsedLimit = parseInt(limit, 10);
39 |       if (isNaN(parsedLimit) || parsedLimit <= 0) {
40 |         throw new BadRequestException(
                   ^
BadRequestException: Invalid limit parameter. Must be a positive number.
 response: {
  message: "Invalid limit parameter. Must be a positive number.",
  error: "Bad Request",
  statusCode: 400,
},
   status: 400,
  options: {},

      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:40:15)
      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:32:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:50:24)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:49:41)
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject negative limits [0.91ms]
63 |       const lastCall = mockCourseQuery.search.mock.calls[0];
64 |       const passedLimit = lastCall[1];
65 | 
66 |       // BUG: Huge limit was passed!
67 |       // Should cap at reasonable maximum (e.g., 100)
68 |       expect(passedLimit).toBeLessThanOrEqual(100);
                               ^
error: expect(received).toBeLessThanOrEqual(expected)

Expected: <= 100
Received: 999999999

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:68:27)
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject extremely large limits [0.70ms]
(pass) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should handle float strings [0.58ms]
(pass) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should handle empty string limit [0.57ms]

src/users/services/username.service.spec.ts:
(pass) UsernameService > updateUsername > User validation > should throw NotFoundException when user does not exist [2.12ms]
(pass) UsernameService > updateUsername > User validation > should return success when username is unchanged [1.09ms]
(pass) UsernameService > updateUsername > Username format validation > should reject uppercase letters [0.77ms]
(pass) UsernameService > updateUsername > Username format validation > should reject usernames starting with number [0.49ms]
(pass) UsernameService > updateUsername > Username format validation > should reject special characters [0.47ms]
(pass) UsernameService > updateUsername > Username format validation > should reject consecutive underscores [0.40ms]
(pass) UsernameService > updateUsername > Username format validation > should reject trailing underscore [0.40ms]
(pass) UsernameService > updateUsername > Username format validation > should accept valid lowercase username [0.59ms]
(pass) UsernameService > updateUsername > Username format validation > should accept username with numbers [0.44ms]
(pass) UsernameService > updateUsername > Username format validation > should accept username with single underscores [0.41ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "admin" [0.45ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "api" [0.45ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "www" [0.46ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "support" [0.52ms]
(pass) UsernameService > updateUsername > Cooldown validation > should allow when never changed before (null) [0.50ms]
(pass) UsernameService > updateUsername > Cooldown validation > should reject within 30 days of last change [0.53ms]
(pass) UsernameService > updateUsername > Cooldown validation > should allow after 30 days [0.57ms]
(pass) UsernameService > updateUsername > Cooldown validation > should show remaining days in error message [0.56ms]
(pass) UsernameService > updateUsername > Username availability > should reject already taken username [0.63ms]
(pass) UsernameService > updateUsername > Username availability > should accept available username [0.54ms]
(pass) UsernameService > updateUsername > Successful update > should call repository with correct parameters [0.46ms]
(pass) UsernameService > updateUsername > Successful update > should return updated username [0.49ms]
(pass) UsernameService > checkUsernameAvailability > should return available=true when not taken [0.57ms]
(pass) UsernameService > checkUsernameAvailability > should return available=false when taken [0.63ms]
(pass) UsernameService > checkUsernameAvailability > should normalize username to lowercase [0.63ms]

src/users/services/username.service.bug-detection.spec.ts:
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should REJECT username containing uppercase letters [0.90ms]
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should REJECT username with mixed case [0.50ms]
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should REJECT username with single uppercase letter [0.45ms]
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should ACCEPT only lowercase username [0.45ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "admin" [0.41ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "api" [0.36ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "www" [0.30ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "support" [0.26ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "help" [0.27ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "root" [0.31ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "system" [0.26ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "null" [0.25ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "undefined" [0.26ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should include "reserved" in error message [0.43ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username starting with number [0.38ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username with special characters [0.37ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username with spaces [0.40ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username with consecutive underscores [0.41ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username ending with underscore [0.46ms]
(pass) UsernameService - Bug Detection > Cooldown edge cases > should REJECT at exactly 29 days (boundary test) [0.49ms]
(pass) UsernameService - Bug Detection > Cooldown edge cases > should ACCEPT at exactly 30 days (boundary test) [0.46ms]
(pass) UsernameService - Bug Detection > Cooldown edge cases > should show correct remaining days in error message [0.50ms]

src/users/services/user-preferences.service.spec.ts:
(pass) UserPreferencesService > getPreferences > should return user preferences when they exist [1.52ms]
(pass) UserPreferencesService > getPreferences > should throw NotFoundException when preferences do not exist [0.64ms]
(pass) UserPreferencesService > getPreferences > should return empty preferences object when user exists but has no preferences [0.42ms]
(pass) UserPreferencesService > updatePreferences > should update user preferences successfully [0.52ms]
(pass) UserPreferencesService > updatePreferences > should throw NotFoundException when user does not exist [0.43ms]
(pass) UserPreferencesService > updatePreferences > should handle partial preference updates [0.39ms]
(pass) UserPreferencesService > updatePreferences > should handle all preference fields in update [0.41ms]
(pass) UserPreferencesService > getFullPreferences > should return full user preferences when they exist [0.44ms]
(pass) UserPreferencesService > getFullPreferences > should return empty object when full preferences do not exist [0.34ms]
(pass) UserPreferencesService > getFullPreferences > should return empty object when full preferences are undefined [0.34ms]
(pass) UserPreferencesService > updateFullPreferences > should update full user preferences successfully [0.60ms]
(pass) UserPreferencesService > updateFullPreferences > should throw NotFoundException when user does not exist [0.45ms]
(pass) UserPreferencesService > updateFullPreferences > should handle creation of new full preferences (upsert behavior) [0.38ms]
(pass) UserPreferencesService > updateFullPreferences > should handle complete preference set in update [0.39ms]

src/users/services/user-profile.service.spec.ts:
(pass) UserProfileService > getPublicProfileByUsername > should return public profile when user exists and profile is public [0.86ms]
(pass) UserProfileService > getPublicProfileByUsername > should throw NotFoundException when user does not exist [0.51ms]
(pass) UserProfileService > getPublicProfileByUsername > should throw NotFoundException when profile visibility is private [0.51ms]
(pass) UserProfileService > getPublicProfileByUsername > should throw NotFoundException when profile visibility is undefined [0.45ms]
(pass) UserProfileService > getPublicProfileByUsername > should return profile with null resume when user has no resume [0.45ms]
(pass) UserProfileService > getProfile > should return user profile for valid userId [0.73ms]
(pass) UserProfileService > getProfile > should throw NotFoundException when profile does not exist [1.01ms]
(pass) UserProfileService > updateProfile > should update user profile successfully [1.03ms]
(pass) UserProfileService > updateProfile > should throw NotFoundException when user does not exist [0.74ms]
(pass) UserProfileService > updateProfile > should handle partial profile updates [0.81ms]
(pass) UserProfileService > updateProfile > should handle all profile fields in update [0.84ms]

src/ats/parsers/cv-section.parser.redos.spec.ts:
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should not hang on repeated section headers [2.71ms]
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should not hang on nested special characters [1.08ms]
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should not hang on overlapping patterns [0.77ms]
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should limit input size [7.86ms]

src/ats/parsers/cv-section.parser.spec.ts:
(pass) CVSectionParser > parseCV > Basic Parsing > should parse a CV with all standard sections [0.53ms]
(pass) CVSectionParser > parseCV > Basic Parsing > should preserve section order in the order field [0.30ms]
(pass) CVSectionParser > parseCV > Basic Parsing > should capture multi-line content within sections [0.23ms]
(pass) CVSectionParser > parseCV > Basic Parsing > should track line numbers for sections [0.18ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle empty input [0.08ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle whitespace-only input [0.08ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle text with no detectable sections [0.14ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle very short lines (under 3 chars) as non-headers [0.20ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle lines with too many words as non-headers [0.14ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle section with no content after it [0.14ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Work Experience" as EXPERIENCE [0.10ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Professional Experience" as EXPERIENCE [0.09ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Contact Information" as PERSONAL_INFO [0.10ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Career Objective" as SUMMARY [0.10ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Technical Skills" as SKILLS [0.11ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Educational Background" as EDUCATION [0.09ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "ExperiÃªncia" as EXPERIENCE [0.14ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "FormaÃ§Ã£o AcadÃªmica" as EDUCATION [0.09ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "Habilidades" as SKILLS [0.10ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "Idiomas" as LANGUAGES [0.11ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Personal Info" as personal_info [0.11ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Summary" as summary [0.06ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Experience" as experience [0.05ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Education" as education [0.05ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Skills" as skills [0.06ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Certifications" as certifications [0.05ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Projects" as projects [0.05ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Awards" as awards [0.08ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Publications" as publications [0.05ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Languages" as languages [0.07ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Interests" as interests [0.07ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "References" as references [0.09ms]
(pass) CVSectionParser > parseCV > Unicode and Special Characters > should handle accented characters in section headers [0.24ms]
(pass) CVSectionParser > parseCV > Unicode and Special Characters > should handle special characters in content [0.19ms]
(pass) CVSectionParser > parseCV > Unicode and Special Characters > should handle emoji in content [0.17ms]
(pass) CVSectionParser > validateSections > Passing Validation > should pass when all mandatory sections are present with enough content [1.14ms]
(pass) CVSectionParser > validateSections > Passing Validation > should report detected sections correctly [0.51ms]
(pass) CVSectionParser > validateSections > Missing Sections > should fail when EXPERIENCE is missing [0.63ms]
(pass) CVSectionParser > validateSections > Missing Sections > should fail when EDUCATION is missing [0.39ms]
(pass) CVSectionParser > validateSections > Missing Sections > should fail when SKILLS is missing [0.36ms]
(pass) CVSectionParser > validateSections > Missing Sections > should report all missing mandatory sections [0.22ms]
(pass) CVSectionParser > validateSections > Empty Sections > should warn about sections with less than 10 characters [0.44ms]
(pass) CVSectionParser > validateSections > Duplicate Sections > should warn about duplicate sections [0.56ms]
(pass) CVSectionParser > validateSections > Duplicate Sections > should allow duplicates but warn (not fail) [0.42ms]
(pass) CVSectionParser > validateSections > No Sections Detected > should fail when no sections are detected [0.32ms]
(pass) CVSectionParser > validateSections > No Sections Detected > should provide helpful suggestion when no sections detected [0.22ms]
(pass) CVSectionParser > validateSections > Metadata > should report total and unique section counts [0.22ms]

src/ats/validators/layout-safety.validator.spec.ts:
(pass) LayoutSafetyValidator > validate > should pass validation for clean, ATS-friendly text [0.80ms]
(pass) LayoutSafetyValidator > validate > should detect unsafe bullet characters [0.34ms]
(pass) LayoutSafetyValidator > validate > should provide appropriate suggestion for unsafe bullets [0.13ms]
(pass) LayoutSafetyValidator > validate > should detect text inside shapes [0.18ms]
(pass) LayoutSafetyValidator > validate > should detect text inside double-box shapes [0.13ms]
(pass) LayoutSafetyValidator > validate > should detect text inside ASCII box shapes [0.12ms]
(pass) LayoutSafetyValidator > validate > should detect multi-column layout [0.15ms]
(pass) LayoutSafetyValidator > validate > should not detect multi-column for regular spacing [0.10ms]
(pass) LayoutSafetyValidator > validate > should detect excessive line breaks [0.16ms]
(pass) LayoutSafetyValidator > validate > should allow moderate blank lines (1-2) [0.07ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with dashes [0.12ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with equals signs [0.08ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with underscores [0.11ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with Unicode characters [0.08ms]
(pass) LayoutSafetyValidator > validate > should not detect short dash sequences as horizontal lines [0.09ms]
(pass) LayoutSafetyValidator > validate > should detect multiple ATS layout issues simultaneously [0.20ms]
(pass) LayoutSafetyValidator > validate > should never fail with ERROR severity (all issues are WARNING/INFO) [0.16ms]
(pass) LayoutSafetyValidator > validate > should provide metadata summary [0.13ms]
(pass) LayoutSafetyValidator > validate > should handle empty text gracefully [0.08ms]
(pass) LayoutSafetyValidator > validate > should handle text with only whitespace [0.07ms]
(pass) LayoutSafetyValidator > validate > should detect all defined unsafe bullet types [0.15ms]

src/ats/validators/grammar.validator.spec.ts:
(pass) GrammarValidator > validate > should return passed=true for clean text with no issues [1.33ms]
(pass) GrammarValidator > validate > should return passed=false when spelling errors exist [0.54ms]
(pass) GrammarValidator > validate > should provide metadata about total issues and categories [0.40ms]
(pass) GrammarValidator > spelling validation > should detect common spelling mistakes [0.42ms]
(pass) GrammarValidator > spelling validation > should suggest correct spelling for mistakes [0.40ms]
(pass) GrammarValidator > spelling validation > should not report duplicate spelling mistakes [0.47ms]
(pass) GrammarValidator > spelling validation > should be case-insensitive for spelling checks [0.36ms]
(pass) GrammarValidator > spelling validation > should detect multiple different spelling mistakes [0.40ms]
(pass) GrammarValidator > grammar patterns > should detect article errors (a before vowel) [0.48ms]
(pass) GrammarValidator > grammar patterns > should detect multiple consecutive spaces [0.36ms]
(pass) GrammarValidator > grammar patterns > should detect sentences not starting with capital letters [0.38ms]
(pass) GrammarValidator > grammar patterns > should flag commonly confused words [0.44ms]
(pass) GrammarValidator > structure validation > should flag very long sentences [0.48ms]
(pass) GrammarValidator > structure validation > should not flag reasonably sized sentences [0.48ms]
(pass) GrammarValidator > structure validation > should warn about documents with too few sentences [0.74ms]
(pass) GrammarValidator > structure validation > should accept documents with adequate number of sentences [0.56ms]
(pass) GrammarValidator > repeated words detection > should detect consecutive repeated words [0.59ms]
(pass) GrammarValidator > repeated words detection > should not flag intentionally repeated words in different contexts [0.45ms]
(pass) GrammarValidator > repeated words detection > should count multiple instances of repeated words [0.49ms]
(pass) GrammarValidator > comprehensive validation > should handle empty text gracefully [0.55ms]
(pass) GrammarValidator > comprehensive validation > should handle text with mixed issues [0.62ms]
(pass) GrammarValidator > comprehensive validation > should categorize issues by severity correctly [0.63ms]

src/ats/services/text-extraction.service.spec.ts:
62 |           buffer: Buffer.from('valid pdf content'),
63 |         } as Express.Multer.File;
64 | 
65 |         const result = await service.extractText(file);
66 | 
67 |         expect(result.passed).toBe(true);
                                   ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/text-extraction.service.spec.ts:67:31)
(fail) TextExtractionService > extractText > PDF files > should extract text from valid PDF [1.56ms]
76 |           buffer: Buffer.from('image based pdf'),
77 |         } as Express.Multer.File;
78 | 
79 |         const result = await service.extractText(file);
80 | 
81 |         expect(result.isImageBased).toBe(true);
                                         ^
error: expect(received).toBe(expected)

Expected: true
Received: false

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/text-extraction.service.spec.ts:81:37)
(fail) TextExtractionService > extractText > PDF files > should detect image-based PDFs [0.73ms]
(pass) TextExtractionService > extractText > PDF files > should handle PDF parse errors [0.48ms]
(pass) TextExtractionService > extractText > DOCX files > should extract text from valid DOCX [0.63ms]
(pass) TextExtractionService > extractText > DOCX files > should handle DOCX parse errors [0.61ms]
(pass) TextExtractionService > extractText > unsupported formats > should reject unsupported file formats [0.44ms]
(pass) TextExtractionService > extractText > validation > should include word count in result [0.40ms]
(pass) TextExtractionService > extractText > validation > should indicate if text is empty [0.44ms]

src/ats/services/ats.service.spec.ts:
(pass) ATSService > validateCV > should return successful validation for valid CV [13.30ms]
(pass) ATSService > validateCV > should stop validation early when file integrity fails [1.43ms]
(pass) ATSService > validateCV > should stop validation early when text extraction fails [0.80ms]
(pass) ATSService > validateCV > should skip section checks when checkSections is false [0.68ms]
(pass) ATSService > validateCV > should skip format validation when checkFormat is false [0.59ms]
(pass) ATSService > validateCV > should skip layout check when checkLayout is false [0.52ms]
(pass) ATSService > validateCV > should skip grammar check by default [0.52ms]
(pass) ATSService > validateCV > should include grammar check when checkGrammar is true [0.63ms]
(pass) ATSService > validateCV > should skip section order check when checkOrder is false [0.83ms]
(pass) ATSService > validateCV > should log validation progress [0.99ms]
(pass) ATSService > validateCV > should log warning when file integrity fails [1.10ms]
(pass) ATSService > validateCV > should normalize text encoding before validation [1.00ms]
(pass) ATSService > validateCV > should pass normalized text to section parser [1.25ms]
(pass) ATSService > validateCV > should include all enabled validation results in response [1.15ms]
(pass) ATSService > validation pipeline behavior > should aggregate issues from all validators [1.07ms]
(pass) ATSService > validation pipeline behavior > should handle file with all validation issues [0.85ms]

src/themes/utils/deep-merge.util.spec.ts:
(pass) deepMerge > basic merging > should merge flat objects [0.14ms]
(pass) deepMerge > basic merging > should not mutate original objects [0.03ms]
(pass) deepMerge > basic merging > should return base when overrides is empty [0.02ms]
(pass) deepMerge > nested objects > should merge nested objects recursively [0.07ms]
(pass) deepMerge > nested objects > should handle deeply nested objects [0.04ms]
(pass) deepMerge > null values > should handle null values correctly - override replaces [0.04ms]
(pass) deepMerge > null values > should handle null in base object [0.04ms]
(pass) deepMerge > array handling > should replace arrays instead of merging [0.03ms]
(pass) deepMerge > array handling > should not deep merge array contents [0.03ms]
(pass) deepMerge > undefined handling > should skip undefined values in overrides [0.02ms]
(pass) deepMerge > type coercion edge cases > should handle primitive override over object [0.02ms]
(pass) deepMerge > type coercion edge cases > should handle object override over primitive [0.02ms]
(pass) deepMerge > type coercion edge cases > should handle boolean values [0.02ms]
(pass) deepMerge > type coercion edge cases > should handle string values [0.02ms]
(pass) deepMerge > real-world theme config scenarios > should merge theme styleConfig correctly [0.07ms]

src/themes/utils/ordering.util.spec.ts:
(pass) sortByOrder > should sort items by order property ascending [0.14ms]
(pass) sortByOrder > should not mutate original array [0.06ms]
(pass) sortByOrder > should handle empty array [0.03ms]
(pass) sortByOrder > should handle single item [0.03ms]
(pass) sortByOrder > should handle items with same order [0.05ms]
(pass) normalizeOrders > should normalize orders to sequential values (0, 1, 2...) [0.09ms]
(pass) normalizeOrders > should not mutate original items [0.10ms]
(pass) normalizeOrders > should handle empty array [0.03ms]
(pass) normalizeOrders > should handle already normalized orders [0.05ms]
(pass) moveItem > should attempt to move item but normalizeOrders sorts by original order [0.17ms]
(pass) moveItem > should handle moving to same position [0.09ms]
(pass) moveItem > should not mutate original array [0.09ms]
(pass) moveItem > should normalize orders after operation [0.15ms]
(pass) moveItem > should handle single item array [0.06ms]
(pass) applyItemOverrides > should add visible and order when no overrides [0.16ms]
(pass) applyItemOverrides > should add visible and order when overrides is empty array [0.08ms]
(pass) applyItemOverrides > should apply visibility overrides [0.12ms]
(pass) applyItemOverrides > should apply order overrides [0.06ms]
(pass) applyItemOverrides > should handle items without matching overrides [0.07ms]
(pass) applyItemOverrides > should preserve original item properties [0.06ms]

src/themes/services/section-visibility.service.spec.ts:
(pass) SectionVisibilityService > toggleSection > should hide a visible section [1.51ms]
(pass) SectionVisibilityService > toggleSection > should show a hidden section [0.78ms]
(pass) SectionVisibilityService > toggleSection > should not modify other sections [0.47ms]
(pass) SectionVisibilityService > toggleSection > should not modify section if id not found [0.43ms]
(pass) SectionVisibilityService > toggleItem > should hide a visible item [0.84ms]
(pass) SectionVisibilityService > toggleItem > should show a hidden item [0.73ms]
(pass) SectionVisibilityService > toggleItem > should add new item override if not exists [0.60ms]
(pass) SectionVisibilityService > toggleItem > should preserve order when toggling visibility [0.52ms]
(pass) SectionVisibilityService > toggleItem > should not modify other items in the same section [0.43ms]
(pass) SectionVisibilityService > toggleItem > should create section override array if not exists [0.45ms]

src/themes/services/theme-crud.service.bug-detection.spec.ts:
(pass) ThemeCrudService - Bug Detection > Theme limit per user > should REJECT creating 6th theme [5.39ms]
(pass) ThemeCrudService - Bug Detection > Theme limit per user > should ACCEPT creating 5th theme (at limit) [1.72ms]
(pass) ThemeCrudService - Bug Detection > Theme limit per user > should include "5" in the limit error message [0.81ms]
(pass) ThemeCrudService - Bug Detection > Theme approval flow > should have submitForApproval method [0.45ms]
130 |         status: 'PENDING',
131 |       });
132 | 
133 |       await (service as any).submitForApproval('user-123', 'theme-1');
134 | 
135 |       expect(mockPrisma.resumeTheme.update).toHaveBeenCalledWith(
                                                  ^
error: expect(received).toHaveBeenCalledWith(...expected)

  [
-   ObjectContaining {
-     "data": ObjectContaining {
-       "status": "PENDING",
+   {
+     "data": {
+       "rejectionReason": null,
+       "status": "PENDING_APPROVAL",
+     },
+     "where": {
+       "id": "theme-1",
      },
    },
  ]

- Expected  - 3
+ Received  + 7

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:135:45)
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should change status from PRIVATE to PENDING on submit [2.20ms]
145 |         status: 'PENDING',
146 |       });
147 | 
148 |       await expect(
149 |         (service as any).submitForApproval('user-123', 'theme-1'),
150 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: ForbiddenException

Received message: "Theme must be private or rejected"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:150:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:142:58)
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already PENDING theme [0.65ms]
156 |         status: ThemeStatus.PUBLISHED,
157 |       });
158 | 
159 |       await expect(
160 |         (service as any).submitForApproval('user-123', 'theme-1'),
161 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: ForbiddenException

Received message: "Theme must be private or rejected"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:161:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:153:59)
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already APPROVED theme [0.65ms]
178 |         rejectionCount: 2, // Already rejected twice
179 |       });
180 | 
181 |       await expect(
182 |         (service as any).submitForApproval('user-123', 'theme-1'),
183 |       ).rejects.toThrow(ForbiddenException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:183:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:174:57)
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should REJECT resubmitting after 2 rejections [0.69ms]
(pass) ThemeCrudService - Bug Detection > Resubmission limit > should ACCEPT resubmitting after first rejection [0.59ms]
165 |   }
166 | 
167 |   private async assertIsAdmin(userId: string) {
168 |     const user = await this.prisma.user.findUnique({ where: { id: userId } });
169 |     if (!user || user.role !== UserRole.ADMIN) {
170 |       throw new ForbiddenException(ERROR_MESSAGES.ONLY_ADMINS_CAN_DO_THIS);
                  ^
ForbiddenException: Only administrators can perform this action
 response: {
  message: "Only administrators can perform this action",
  error: "Forbidden",
  statusCode: 403,
},
   status: 403,
  options: {},

      at assertIsAdmin (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.ts:170:13)
      at async rejectTheme (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.ts:125:16)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:212:30)
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should increment rejectionCount when theme is rejected [0.97ms]
(pass) ThemeCrudService - Bug Detection > Admin theme creation > should create theme as APPROVED when admin creates [0.71ms]
(pass) ThemeCrudService - Bug Detection > Admin theme creation > should REJECT createAsAdmin for non-admin users [0.53ms]
(pass) ThemeCrudService - Bug Detection > Theme inheritance > should NOT merge parent config, child overrides completely [0.65ms]

src/themes/services/theme-approval.service.limit.spec.ts:
68 |       mockCrud.findOrFail.mockResolvedValue(twiceRejectedTheme);
69 | 
70 |       // BUG: This should throw but doesn't!
71 |       await expect(
72 |         service.submitForApproval('user-123', 'theme-1'),
73 |       ).rejects.toThrow(BadRequestException);
                     ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: UnprocessableEntityException

Received message: "Theme has been rejected too many times. Maximum 2 resubmissions allowed."

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.limit.spec.ts:73:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.limit.spec.ts:60:61)
(fail) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should REJECT 3rd resubmission after 2 rejections [1.71ms]
(pass) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should ALLOW 1st resubmission after rejection [1.34ms]
(pass) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should ALLOW 2nd resubmission after rejection [1.32ms]
(pass) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should increment rejectionCount when theme is rejected [2.06ms]

src/themes/services/theme-application.service.spec.ts:
(pass) ThemeApplicationService > applyToResume > should apply theme to resume successfully [1.79ms]
(pass) ThemeApplicationService > applyToResume > should apply theme with customizations [1.11ms]
(pass) ThemeApplicationService > applyToResume > should throw ForbiddenException if resume not found [1.28ms]
(pass) ThemeApplicationService > applyToResume > should throw ForbiddenException if resume belongs to another user [1.54ms]
(pass) ThemeApplicationService > applyToResume > should throw NotFoundException if theme not found [1.75ms]
(pass) ThemeApplicationService > fork > should fork a published theme [2.08ms]
(pass) ThemeApplicationService > fork > should fork own private theme [1.59ms]
(pass) ThemeApplicationService > fork > should reject forking private theme of another user [0.87ms]
(pass) ThemeApplicationService > fork > should reject forking pending approval theme of another user [0.64ms]
(pass) ThemeApplicationService > getResolvedConfig > should return base config when no customizations [0.90ms]
(pass) ThemeApplicationService > getResolvedConfig > should merge customizations with base config [0.82ms]
(pass) ThemeApplicationService > getResolvedConfig > should return null if no active theme [0.66ms]
(pass) ThemeApplicationService > getResolvedConfig > should throw ForbiddenException if resume not found [0.60ms]
(pass) ThemeApplicationService > getResolvedConfig > should throw ForbiddenException for another user resume [0.57ms]

src/themes/services/theme-crud.service.limit.spec.ts:
(pass) ThemeCrudService - LIMIT BUG DETECTION > BUG-006: Theme Limit Enforcement > should REJECT creating 6th theme when user already has 5 [1.58ms]
(pass) ThemeCrudService - LIMIT BUG DETECTION > BUG-006: Theme Limit Enforcement > should ALLOW creating theme when user has less than 5 [0.99ms]
(pass) ThemeCrudService - LIMIT BUG DETECTION > BUG-006: Theme Limit Enforcement > should check theme count before creating [0.93ms]
129 |         ...mockThemeDto,
130 |         preApproved: true,
131 |       } as any);
132 | 
133 |       // Should be created as PUBLISHED, not PRIVATE
134 |       expect(mockPrisma.resumeTheme.create).toHaveBeenCalledWith(
                                                  ^
error: expect(received).toHaveBeenCalledWith(...expected)

  [
-   ObjectContaining {
-     "data": ObjectContaining {
-       "status": StringMatching /PUBLISHED|APPROVED/,
+   {
+     "data": {
+       "authorId": "admin-123",
+       "category": "PROFESSIONAL",
+       "description": "A new theme",
+       "name": "New Theme",
+       "parentThemeId": undefined,
+       "status": "PRIVATE",
+       "styleConfig": {
+         "colors": {
+           "primary": "#000000",
+         },
+       },
+       "tags": [],
      },
    },
  ]

- Expected  - 3
+ Received  + 14

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.limit.spec.ts:134:45)
(fail) ThemeCrudService - LIMIT BUG DETECTION > BUG-013: Admin Pre-Approval > should allow admin to create pre-approved theme [2.16ms]

src/themes/services/theme-crud.service.spec.ts:
(pass) ThemeCrudService > create > should create theme successfully [1.02ms]
(pass) ThemeCrudService > create > should validate layout config if provided [0.59ms]
(pass) ThemeCrudService > update > should update theme owned by user [0.75ms]
(pass) ThemeCrudService > update > should reject updating theme owned by different user [0.63ms]
(pass) ThemeCrudService > update > should allow admin to update system theme [0.73ms]
(pass) ThemeCrudService > update > should reject non-admin updating system theme [0.75ms]
(pass) ThemeCrudService > update > should throw NotFoundException for non-existent theme [0.83ms]
(pass) ThemeCrudService > delete > should delete theme owned by user [0.68ms]
(pass) ThemeCrudService > delete > should reject deleting theme owned by different user [0.51ms]
(pass) ThemeCrudService > delete > should reject deleting system theme [0.79ms]
(pass) ThemeCrudService > delete > should throw NotFoundException for non-existent theme [0.85ms]
(pass) ThemeCrudService > findOrFail > should return theme when found [0.67ms]
(pass) ThemeCrudService > findOrFail > should throw NotFoundException when not found [0.74ms]

src/themes/services/theme-approval.service.bug-detection.spec.ts:
79 |         authorId: 'user-123',
80 |       });
81 | 
82 |       await expect(
83 |         service.submitForApproval('user-123', 'theme-1'),
84 |       ).rejects.toThrow(ForbiddenException);
                     ^
error: expect(received).toThrow(expected)

Expected constructor: ForbiddenException
Received constructor: UnprocessableEntityException

Received message: "Theme has been rejected too many times. Maximum 2 resubmissions allowed."

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:84:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:74:68)
(fail) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should REJECT resubmitting theme that was rejected twice [1.18ms]
(pass) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should include "maximum resubmissions" in error message [0.85ms]
(pass) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should ACCEPT resubmitting after first rejection [0.61ms]
(pass) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should ACCEPT first submission (rejectionCount = 0) [0.61ms]
(pass) ThemeApprovalService - Bug Detection > BUG: rejectionCount tracking > should INCREMENT rejectionCount when theme is rejected [0.70ms]
(pass) ThemeApprovalService - Bug Detection > BUG: rejectionCount tracking > should NOT increment rejectionCount when theme is approved [0.74ms]
(pass) ThemeApprovalService - Bug Detection > Status transitions > should only allow PRIVATE â PENDING transition [0.60ms]
(pass) ThemeApprovalService - Bug Detection > Status transitions > should only allow REJECTED â PENDING transition (resubmission) [0.49ms]
(pass) ThemeApprovalService - Bug Detection > Status transitions > should REJECT submitting from PUBLISHED status [0.60ms]
253 |         authorId: 'user-123',
254 |       });
255 | 
256 |       await service.submitForApproval('user-123', 'theme-1');
257 | 
258 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /SUBMIT|THEME_SUBMITTED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:258:42)
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is submitted [1.00ms]
274 |       await service.review('approver-1', {
275 |         themeId: 'theme-1',
276 |         approved: true,
277 |       });
278 | 
279 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /APPROVE|THEME_APPROVED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:279:42)
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is approved [1.51ms]
296 |         themeId: 'theme-1',
297 |         approved: false,
298 |         rejectionReason: 'Needs work',
299 |       });
300 | 
301 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /REJECT|THEME_REJECTED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:301:42)
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is rejected [1.24ms]

src/themes/services/theme-approval.service.spec.ts:
(pass) ThemeApprovalService > submitForApproval > should submit PRIVATE theme â PENDING_APPROVAL [1.20ms]
(pass) ThemeApprovalService > submitForApproval > should submit REJECTED theme â PENDING_APPROVAL (resubmit) [0.63ms]
(pass) ThemeApprovalService > submitForApproval > should reject submission if not theme owner [0.59ms]
(pass) ThemeApprovalService > submitForApproval > should reject submission of already published theme [0.62ms]
(pass) ThemeApprovalService > submitForApproval > should reject submission of pending theme [0.57ms]
(pass) ThemeApprovalService > review - approve > should approve: PENDING_APPROVAL â PUBLISHED [0.65ms]
(pass) ThemeApprovalService > review - approve > should allow admin to approve themes [0.51ms]
(pass) ThemeApprovalService > review - reject > should reject: PENDING_APPROVAL â REJECTED [0.52ms]
(pass) ThemeApprovalService > review - reject > should require rejection reason when rejecting [0.54ms]
(pass) ThemeApprovalService > review - access control > should reject non-admin/non-approver approval attempts [0.51ms]
(pass) ThemeApprovalService > review - access control > should reject self-approval [0.54ms]
(pass) ThemeApprovalService > review - access control > should reject approval of non-pending themes [0.51ms]
(pass) ThemeApprovalService > review - access control > should reject approval of already published themes [0.45ms]
(pass) ThemeApprovalService > getPendingApprovals > should return pending themes for approver [0.64ms]
(pass) ThemeApprovalService > getPendingApprovals > should reject non-approver access [0.67ms]
(pass) ThemeApprovalService > getPendingApprovals > should allow admin access [1.01ms]
(pass) ThemeApprovalService > workflow: full approval cycle > should complete: PRIVATE â submit â PENDING â approve â PUBLISHED [1.17ms]
(pass) ThemeApprovalService > workflow: full approval cycle > should complete: PRIVATE â submit â PENDING â reject â REJECTED â resubmit â PENDING [1.41ms]

src/themes/services/section-ordering.service.spec.ts:
(pass) SectionOrderingService > reorderSection > should reorder a section to a new position [1.53ms]
(pass) SectionOrderingService > reorderSection > should throw BadRequestException if section not found [0.71ms]
(pass) SectionOrderingService > reorderSection > should call moveItem with correct indices [0.72ms]
(pass) SectionOrderingService > reorderSection > should save updated config [0.61ms]
(pass) SectionOrderingService > reorderItem > should update existing item order [0.80ms]
(pass) SectionOrderingService > reorderItem > should add new item override if item not found [0.61ms]
(pass) SectionOrderingService > reorderItem > should preserve visibility when updating order [0.95ms]
(pass) SectionOrderingService > reorderItem > should create section array if not exists [0.92ms]
(pass) SectionOrderingService > batchUpdate > should update multiple sections at once [1.27ms]
(pass) SectionOrderingService > batchUpdate > should update visibility in batch [1.08ms]
(pass) SectionOrderingService > batchUpdate > should update column assignment in batch [0.93ms]
(pass) SectionOrderingService > batchUpdate > should normalize orders after batch update [1.06ms]
(pass) SectionOrderingService > batchUpdate > should ignore updates for non-existent sections [0.71ms]

src/themes/services/theme-query.service.bug.spec.ts:
44 |       );
45 | 
46 |       // BUG: No limit enforced!
47 |       await (service as any).search?.('test', 10000);
48 | 
49 |       const findManyCall = mockPrisma.resumeTheme.findMany.mock.calls[0][0];
                                                                           ^
TypeError: undefined is not an object (evaluating 'mockPrisma.resumeTheme.findMany.mock.calls[0][0]')
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-query.service.bug.spec.ts:49:71)
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should enforce maximum limit on search [1.97ms]
58 |       await (service as any).search?.('test');
59 | 
60 |       const findManyCall = mockPrisma.resumeTheme.findMany.mock.calls[0]?.[0];
61 | 
62 |       // Should have a default limit
63 |       expect(findManyCall?.take).toBeDefined();
                                      ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-query.service.bug.spec.ts:63:34)
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should have default limit when none provided [2.02ms]
(pass) ThemeQueryService - BUG DETECTION > BUG-059: Style Config Size Not Validated > should reject excessively large styleConfig [41.55ms]
(pass) ThemeQueryService - BUG DETECTION > BUG-059: Style Config Size Not Validated > should reject deeply nested styleConfig [0.96ms]

src/onboarding/services/skills-onboarding.service.spec.ts:
(pass) SkillsOnboardingService > saveSkills > should save skills with correct order [2.94ms]
(pass) SkillsOnboardingService > saveSkills > should use empty string for missing category [1.52ms]
(pass) SkillsOnboardingService > saveSkills > should not save skills when noSkills is true [1.35ms]
(pass) SkillsOnboardingService > saveSkills > should not save skills when skills array is empty [0.85ms]
(pass) SkillsOnboardingService > saveSkills > should replace existing skills [0.85ms]
(pass) SkillsOnboardingService > saveSkills > should set level to null for all skills [0.76ms]

src/onboarding/services/education-onboarding.service.spec.ts:
(pass) EducationOnboardingService > saveEducation > should save education with all fields [2.67ms]
(pass) EducationOnboardingService > saveEducation > should save current education with null endDate [1.68ms]
(pass) EducationOnboardingService > saveEducation > should skip education with invalid startDate [1.74ms]
(pass) EducationOnboardingService > saveEducation > should skip education with endDate before startDate [1.99ms]
(pass) EducationOnboardingService > saveEducation > should not save education when noEducation is true [1.88ms]
(pass) EducationOnboardingService > saveEducation > should not save education when array is empty [1.71ms]
(pass) EducationOnboardingService > saveEducation > should allow empty field [1.02ms]
(pass) EducationOnboardingService > saveEducation > should replace existing education [1.24ms]

src/onboarding/services/experience-onboarding.service.spec.ts:
(pass) ExperienceOnboardingService > saveExperiences > should save experience with all fields [3.88ms]
(pass) ExperienceOnboardingService > saveExperiences > should save current experience with null endDate [1.29ms]
(pass) ExperienceOnboardingService > saveExperiences > should skip experience with invalid startDate [1.34ms]
(pass) ExperienceOnboardingService > saveExperiences > should skip experience with endDate before startDate [0.90ms]
(pass) ExperienceOnboardingService > saveExperiences > should not save experiences when noExperience is true [0.73ms]
(pass) ExperienceOnboardingService > saveExperiences > should not save experiences when array is empty [0.75ms]
(pass) ExperienceOnboardingService > saveExperiences > should use empty string for missing description [0.81ms]
(pass) ExperienceOnboardingService > saveExperiences > should replace existing experiences [0.94ms]

src/onboarding/services/onboarding-progress.bug-detection.spec.ts:
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should REJECT noExperience=true with non-empty experiences array [2.62ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should REJECT noEducation=true with non-empty education array [1.05ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should REJECT noSkills=true with non-empty skills array [1.11ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should include "cannot" or "forbidden" in error message [1.25ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should ACCEPT noExperience=true with empty experiences array [1.07ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should return INITIAL progress if existing progress is older than 36 hours [1.33ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should DELETE expired progress automatically [1.69ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should KEEP progress if less than 36 hours old [1.50ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should check expiration at exactly 36 hours (boundary) [1.62ms]
241 |       await expect(
242 |         service.saveProgress('user-123', {
243 |           currentStep: 'skills',
244 |           completedSteps: ['welcome'], // Missing personal-info, professional-profile, etc.
245 |         }),
246 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: TypeError

Received message: "undefined is not an object (evaluating 'progress.currentStep')"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:246:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:240:57)
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT skipping from welcome to skills [2.00ms]
251 |         service.saveProgress('user-123', {
252 |           currentStep: 'education',
253 |           completedSteps: ['welcome', 'personal-info', 'professional-profile'],
254 |           // Missing 'experience' in completedSteps
255 |         }),
256 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: TypeError

Received message: "undefined is not an object (evaluating 'progress.currentStep')"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:256:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:249:79)
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT going to education without completing experience step [1.65ms]
(pass) OnboardingProgressService - Bug Detection > Sequential step validation > should ACCEPT valid sequential progress [1.19ms]

src/onboarding/services/resume-onboarding.service.spec.ts:
(pass) ResumeOnboardingService > upsertResume > should create new resume with all personal info fields [3.82ms]
(pass) ResumeOnboardingService > upsertResume > should create resume with professional profile links [2.30ms]
(pass) ResumeOnboardingService > upsertResume > should set primary resume when creating first resume for user [1.83ms]
(pass) ResumeOnboardingService > upsertResume > should not change primary resume when updating existing resume [1.39ms]
(pass) ResumeOnboardingService > upsertResume > should update existing resume instead of creating new one [1.17ms]
(pass) ResumeOnboardingService > upsertResume > should handle different template selections [1.10ms]

src/onboarding/services/onboarding-progress.service.spec.ts:
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should reject noExperience=true with non-empty experiences [2.63ms]
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should reject noEducation=true with non-empty education [1.87ms]
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should reject noSkills=true with non-empty skills [1.56ms]
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should accept noExperience=true with empty experiences [0.90ms]
(pass) OnboardingProgressService > saveProgress > Username Validation > should reject if username is taken by another user [1.22ms]
(pass) OnboardingProgressService > saveProgress > Username Validation > should accept if username belongs to same user [0.96ms]
(pass) OnboardingProgressService > saveProgress > Username Validation > should accept if username is available [0.92ms]
(pass) OnboardingProgressService > saveProgress > Successful Save > should call prisma upsert with correct data [0.80ms]
(pass) OnboardingProgressService > saveProgress > Successful Save > should return success with current step [0.72ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should return initial progress if no saved progress [0.68ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should return saved progress if fresh [0.89ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should return initial progress and delete if expired (>36h) [0.88ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should keep progress at exactly 35 hours [0.90ms]
(pass) OnboardingProgressService > deleteProgress > should delete progress for user [0.71ms]

src/onboarding/services/languages-onboarding.service.spec.ts:
(pass) LanguagesOnboardingService > saveLanguages > should save languages with correct order [1.87ms]
(pass) LanguagesOnboardingService > saveLanguages > should not save languages when array is empty [1.51ms]
(pass) LanguagesOnboardingService > saveLanguages > should replace existing languages [1.02ms]
(pass) LanguagesOnboardingService > saveLanguages > should map name field to name in storage [0.59ms]
(pass) LanguagesOnboardingService > saveLanguages > should map level field to level in storage [0.52ms]
(pass) LanguagesOnboardingService > saveLanguages > should handle single language [0.46ms]

src/tech-skills/services/tech-skills-query.service.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'TechSkillDto' not found in '../dtos'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/tech-skills/services/niche-query.service.spec.ts:
(pass) TechNicheQueryService > getAllNiches > should return all niches with area information [3.03ms]
(pass) TechNicheQueryService > getAllNiches > should cache results [1.01ms]
(pass) TechNicheQueryService > getNichesByArea > should return niches filtered by area type [1.34ms]

src/tech-skills/services/language-query.service.spec.ts:
(pass) LanguageQueryService > getAllLanguages > should return all programming languages [1.33ms]
(pass) LanguageQueryService > getAllLanguages > should cache results [0.59ms]
(pass) LanguageQueryService > searchLanguages > should return languages matching query [0.92ms]
(pass) LanguageQueryService > searchLanguages > should return empty array for empty query [0.58ms]
(pass) LanguageQueryService > searchLanguages > should respect limit parameter [0.50ms]

src/tech-skills/services/area-query.service.spec.ts:
(pass) TechAreaQueryService > getAllAreas > should return all active tech areas [3.25ms]
(pass) TechAreaQueryService > getAllAreas > should include all area fields [1.64ms]
(pass) TechAreaQueryService > getAllAreas > should return cached results on second call [0.85ms]
(pass) TechAreaQueryService > getAllAreas > should store results in cache after first query [0.84ms]
123 |     });
124 | 
125 |     it('should return results sorted by order', async () => {
126 |       const result = await service.getAllAreas();
127 | 
128 |       expect(result[0].order).toBeLessThan(result[1].order);
                                    ^
error: Expected and actual values must be numbers or bigints
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/area-query.service.spec.ts:128:31)
(fail) TechAreaQueryService > getAllAreas > should return results sorted by order [1.07ms]

src/tech-skills/services/skill-search.service.spec.ts:
(pass) SkillSearchService > searchSkills > should return skills matching query [3.66ms]
(pass) SkillSearchService > searchSkills > should return empty array for empty query [1.35ms]
(pass) SkillSearchService > searchSkills > should return empty array for whitespace query [0.97ms]
(pass) SkillSearchService > searchSkills > should normalize query to lowercase [0.92ms]
(pass) SkillSearchService > searchSkills > should return consistent results on multiple calls [0.67ms]
(pass) SkillSearchService > searchSkills > should respect limit parameter [0.61ms]
(pass) SkillSearchService > searchSkills > should include niche information in results [0.70ms]

src/tech-skills/services/skill-query.service.spec.ts:
(pass) SkillQueryService > getAllSkills > should return all skills with niche information [2.30ms]
(pass) SkillQueryService > getAllSkills > should cache results [1.32ms]
(pass) SkillQueryService > getSkillsByNiche > should return skills filtered by niche slug [2.17ms]
(pass) SkillQueryService > getSkillsByType > should return skills filtered by type [2.47ms]
(pass) SkillQueryService > getSkillsByType > should respect limit parameter [1.25ms]

src/spoken-languages/services/spoken-languages.service.spec.ts:
(pass) SpokenLanguagesService > getAll > should return all active languages ordered by order field [1.47ms]
(pass) SpokenLanguagesService > getAll > should filter out inactive languages [1.25ms]
(pass) SpokenLanguagesService > getAll > should return empty array when no languages found [1.65ms]
(pass) SpokenLanguagesService > getAll > should handle null nativeName correctly [1.52ms]
(pass) SpokenLanguagesService > search > should search languages by English name case-insensitively [1.65ms]
(pass) SpokenLanguagesService > search > should search languages by Portuguese name [1.03ms]
(pass) SpokenLanguagesService > search > should search languages by Spanish name [0.85ms]
(pass) SpokenLanguagesService > search > should search languages by native name [0.66ms]
(pass) SpokenLanguagesService > search > should apply default limit when not specified [0.63ms]
(pass) SpokenLanguagesService > search > should respect custom limit parameter [0.64ms]
(pass) SpokenLanguagesService > search > should order search results by order field [0.77ms]
(pass) SpokenLanguagesService > search > should only search active languages [0.84ms]
(pass) SpokenLanguagesService > search > should return empty array when no matches found [0.71ms]
(pass) SpokenLanguagesService > getByCode > should return language by code [1.00ms]
(pass) SpokenLanguagesService > getByCode > should return null when language not found [0.75ms]
(pass) SpokenLanguagesService > getByCode > should handle language with null native name [0.72ms]
(pass) SpokenLanguagesService > getByCode > should query by exact code [0.75ms]

src/auth/strategies/jwt.strategy.spec.ts:
59 |     }
60 | 
61 |     // BUG-023/055/056/057 FIX: Enforce token revocation after security events
62 |     // passport-jwt includes standard claims like iat (seconds since epoch)
63 |     const issuedAtMs = (payload.iat ?? 0) * 1000;
64 |     const isRevoked = await this.tokenBlacklist.isTokenRevokedForUser(
                                                     ^
TypeError: this.tokenBlacklist.isTokenRevokedForUser is not a function. (In 'this.tokenBlacklist.isTokenRevokedForUser(user.id, issuedAtMs)', 'this.tokenBlacklist.isTokenRevokedForUser' is undefined)
      at validate (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.ts:64:49)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:72:37)
(fail) JwtStrategy > validate > should return user payload when user exists [2.27ms]
(pass) JwtStrategy > validate > should throw UnauthorizedException when user does not exist [1.09ms]
59 |     }
60 | 
61 |     // BUG-023/055/056/057 FIX: Enforce token revocation after security events
62 |     // passport-jwt includes standard claims like iat (seconds since epoch)
63 |     const issuedAtMs = (payload.iat ?? 0) * 1000;
64 |     const isRevoked = await this.tokenBlacklist.isTokenRevokedForUser(
                                                     ^
TypeError: this.tokenBlacklist.isTokenRevokedForUser is not a function. (In 'this.tokenBlacklist.isTokenRevokedForUser(user.id, issuedAtMs)', 'this.tokenBlacklist.isTokenRevokedForUser' is undefined)
      at validate (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.ts:64:49)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:108:37)
(fail) JwtStrategy > validate > should return correct onboarding status [1.01ms]
59 |     }
60 | 
61 |     // BUG-023/055/056/057 FIX: Enforce token revocation after security events
62 |     // passport-jwt includes standard claims like iat (seconds since epoch)
63 |     const issuedAtMs = (payload.iat ?? 0) * 1000;
64 |     const isRevoked = await this.tokenBlacklist.isTokenRevokedForUser(
                                                     ^
TypeError: this.tokenBlacklist.isTokenRevokedForUser is not a function. (In 'this.tokenBlacklist.isTokenRevokedForUser(user.id, issuedAtMs)', 'this.tokenBlacklist.isTokenRevokedForUser' is undefined)
      at validate (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.ts:64:49)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:126:37)
(fail) JwtStrategy > validate > should return admin role when user is admin [1.05ms]
141 |             JwtStrategy,
142 |             { provide: PrismaService, useValue: prisma },
143 |             { provide: ConfigService, useValue: mockConfigService },
144 |           ],
145 |         }).compile(),
146 |       ).rejects.toThrow('JWT_SECRET environment variable is required');
                      ^
error: expect(received).toThrow(expected)

Expected substring: "JWT_SECRET environment variable is required"
Received message: "Nest can't resolve dependencies of the JwtStrategy (ConfigService, PrismaService, ?). Please make sure that the argument TokenBlacklistService at index [2] is available in the RootTestModule context.\n\nPotential solutions:\n- Is RootTestModule a valid NestJS module?\n- If TokenBlacklistService is a provider, is it part of the current RootTestModule?\n- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?\n  @Module({\n    imports: [ /* the Module containing TokenBlacklistService */ ]\n  })\n\nFor more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:146:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:133:64)
(fail) JwtStrategy > constructor > should throw error when JWT_SECRET is not configured [3.88ms]

src/auth/strategies/jwt.strategy.bug-detection.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the JwtStrategy (ConfigService, PrismaService, ?). Please make sure that the argument TokenBlacklistService at index [2] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "JwtStrategy",
   context: {
  index: 2,
  dependencies: [
    [class ConfigService], [class PrismaService extends r], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "566e247308dbb01e60088",
},
 moduleRef: {
  id: "a529cb8358566e247308d",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should REJECT user with unverified email (emailVerified = null) [1.53ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the JwtStrategy (ConfigService, PrismaService, ?). Please make sure that the argument TokenBlacklistService at index [2] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "JwtStrategy",
   context: {
  index: 2,
  dependencies: [
    [class ConfigService], [class PrismaService extends r], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "0937b1e1f61f21fccc26c",
},
 moduleRef: {
  id: "01e60088d20937b1e1f61",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should ALLOW user with verified email [0.92ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the JwtStrategy (ConfigService, PrismaService, ?). Please make sure that the argument TokenBlacklistService at index [2] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "JwtStrategy",
   context: {
  index: 2,
  dependencies: [
    [class ConfigService], [class PrismaService extends r], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "eead6eeadee96a92548e2",
},
 moduleRef: {
  id: "1fccc26cf9eead6eeadee",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should include emailVerified in query select [0.91ms]

src/auth/strategies/local.strategy.spec.ts:

# Unhandled error between tests
-------------------------------
SyntaxError: export 'JwtUserPayload' not found in './token.service'
      at link (unknown:1:11)
      at link (unknown:1:11)
      at link (unknown:1:11)
      at linkAndEvaluateModule (unknown:1:11)
      at loadAndEvaluateModule (unknown:2:1)
      at processTicksAndRejections (unknown:7:39)
-------------------------------


src/auth/services/token-revocation.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "aec16763a03660b0bdb26",
},
 moduleRef: {
  id: "a92548e221abcc228f477",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to revoke/blacklist a token [1.93ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "9eb4506828feeea8fd011",
},
 moduleRef: {
  id: "0bdb2633c369eb4506828",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to logout all sessions [1.14ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "89fc04795b38cf29402fe",
},
 moduleRef: {
  id: "8fd01116c7c89fc04795b",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should check token blacklist during validation [0.96ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "915f4747336c4ef8e937b",
},
 moduleRef: {
  id: "9402fe4f50e915f474733",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should track active sessions for logout all functionality [1.19ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "1232d541220731ac22e0b",
},
 moduleRef: {
  id: "8e937b4e6c11232d54122",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > revoked token should be rejected on refresh [1.54ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "7fb7fbc56610d12a3a31c",
},
 moduleRef: {
  id: "c22e0bd47237fb7fbc566",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > Session Management > should store session when logging in [1.59ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "fe908c5d37679d194f574",
},
 moduleRef: {
  id: "a3a31cc16aefe908c5d37",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) Token Revocation - BUG DETECTION > Session Management > should enforce session limit of 5 [1.45ms]

src/auth/services/account-management.service.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "d0005d84b98cf00521f30",
},
 moduleRef: {
  id: "94f57435a2d0005d84b98",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > changeEmail > should change email successfully when all validations pass [1.50ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "2745fec6a3dbfbef679a7",
},
 moduleRef: {
  id: "0521f30ac82745fec6a3d",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > changeEmail > should throw UnauthorizedException when user has no password [0.90ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "4e077ccbb7df692fbbf61",
},
 moduleRef: {
  id: "ef679a7c474e077ccbb7d",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > changeEmail > should throw UnauthorizedException when password is incorrect [0.84ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "643fd6a6be1300d1e2f7d",
},
 moduleRef: {
  id: "2fbbf614b9643fd6a6be1",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > changeEmail > should throw ConflictException when new email is already taken [0.86ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "7b1651add8a331e3bc676",
},
 moduleRef: {
  id: "d1e2f7db177b1651add8a",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > changeEmail > should reset emailVerified to null when changing email [0.89ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "f7f271f880c963eb7ae4b",
},
 moduleRef: {
  id: "e3bc676a97f7f271f880c",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > deleteAccount > should delete account successfully for non-admin user [0.81ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "8abc1ca3b42ed95cdc4a3",
},
 moduleRef: {
  id: "eb7ae4bdd18abc1ca3b42",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > deleteAccount > should delete admin account when there are multiple admins [1.50ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "f130052f36669622c24a6",
},
 moduleRef: {
  id: "5cdc4a3433f130052f366",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > deleteAccount > should throw BadRequestException when deleting last admin [1.64ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "55d1f64be9202aece09e5",
},
 moduleRef: {
  id: "22c24a655855d1f64be92",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > deleteAccount > should throw UnauthorizedException when user has no password [1.36ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "961a0ae606172a17f1f52",
},
 moduleRef: {
  id: "ece09e5c3a961a0ae6061",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > deleteAccount > should throw UnauthorizedException when password is incorrect [1.34ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "d8de843cabf9a4b9287d4",
},
 moduleRef: {
  id: "17f1f52342d8de843cabf",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > deleteAccount > should not check admin count for non-admin users [1.39ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "de729614b6ea29928e1fa",
},
 moduleRef: {
  id: "b9287d4c6fde729614b6e",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > error handling > should handle user not found in changeEmail [0.87ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "ff8d8127481c9fa043cb3",
},
 moduleRef: {
  id: "928e1fa107ff8d8127481",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService > error handling > should handle user not found in deleteAccount [0.86ms]

src/auth/services/token-refresh.service.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "4b298f37bff1b9aea3800",
},
 moduleRef: {
  id: "32bc4323bf4b298f37bff",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshToken > should generate new tokens for valid user [1.68ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "3d8ca0017fce2a9d8600d",
},
 moduleRef: {
  id: "aea38002a53d8ca0017fc",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshToken > should throw UnauthorizedException when user not found [0.96ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "86d409f5fd990dd473109",
},
 moduleRef: {
  id: "9d8600d93686d409f5fd9",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshToken > should throw UnauthorizedException when user email is null [1.44ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "8f96c3bafb947b56fdf95",
},
 moduleRef: {
  id: "d47310958a8f96c3bafb9",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshToken > should generate tokens with correct payload [1.32ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "43caf017d30d8cee196de",
},
 moduleRef: {
  id: "56fdf955f443caf017d30",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshWithToken > should refresh tokens using valid refresh token [1.14ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "c7d77acef4ad915ddca30",
},
 moduleRef: {
  id: "ee196de931c7d77acef4a",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshWithToken > should throw UnauthorizedException for invalid refresh token [1.32ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "cfdbb2faa00508533486b",
},
 moduleRef: {
  id: "5ddca3015dcfdbb2faa00",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshWithToken > should throw UnauthorizedException when decoded user not found [1.01ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "2565487ce3510aa0709f0",
},
 moduleRef: {
  id: "533486b4122565487ce35",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > refreshWithToken > should handle token verification errors gracefully [0.81ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "03bbe3ef2be5facf4a6a4",
},
 moduleRef: {
  id: "a0709f028103bbe3ef2be",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > getCurrentUser > should return current user data [0.68ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "6491347417b62c5b43510",
},
 moduleRef: {
  id: "cf4a6a4a226491347417b",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > getCurrentUser > should throw UnauthorizedException when user not found [0.63ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "eea5bbdf5e575b65de394",
},
 moduleRef: {
  id: "5b43510758eea5bbdf5e5",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > getCurrentUser > should return user with null fields correctly [0.67ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the TokenRefreshService (PrismaService, AppLoggerService, TokenService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "TokenRefreshService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class TokenService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "a3dd432cef4798ae3b24a",
},
 moduleRef: {
  id: "65de39435aa3dd432cef4",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) TokenRefreshService > getCurrentUser > should return admin user data correctly [0.73ms]

src/auth/services/account-management.service.bug.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "27f8d9eba1b322ac0bef4",
},
 moduleRef: {
  id: "ae3b24a80627f8d9eba1b",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should use transaction to prevent race condition [1.26ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "1e4416147c3ef16ae5e4d",
},
 moduleRef: {
  id: "ac0bef47fd1e4416147c3",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should handle unique constraint violation on email change [1.02ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "abd043af1d68d5225e480",
},
 moduleRef: {
  id: "6ae5e4d102abd043af1d6",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should revoke all tokens when account is deleted [0.89ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "443a85f7f55fd62ed8174",
},
 moduleRef: {
  id: "225e4803c3443a85f7f55",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should add current token to blacklist on deletion [1.39ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the AccountManagementService (PrismaService, AppLoggerService, PasswordService, ?). Please make sure that the argument TokenBlacklistService at index [3] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "AccountManagementService",
   context: {
  index: 3,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class PasswordService], [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "4488394a7385217d37834",
},
 moduleRef: {
  id: "2ed8174dc64488394a738",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) AccountManagementService - BUG DETECTION > BUG-057: Email Change Session Invalidation > should invalidate all sessions when email changes [1.45ms]

src/auth/services/auth-core.service.spec.ts:
(pass) AuthCoreService > signup > should create new user and return auth response [1.56ms]
(pass) AuthCoreService > signup > should use email prefix as name when name not provided [0.80ms]
(pass) AuthCoreService > signup > should throw ConflictException when email already exists [0.99ms]
(pass) AuthCoreService > signup > should throw when user email is null after creation [0.72ms]
(pass) AuthCoreService > signup > should log successful signup [0.71ms]
(pass) AuthCoreService > validateUser > should return user without password when credentials valid [0.82ms]
(pass) AuthCoreService > validateUser > should return null when user not found [0.68ms]
(pass) AuthCoreService > validateUser > should return null when user has no password [0.65ms]
(pass) AuthCoreService > validateUser > should return null when password invalid [0.66ms]
(pass) AuthCoreService > login > should return auth response when credentials valid [0.93ms]
(pass) AuthCoreService > login > should throw UnauthorizedException when user not found [1.32ms]
(pass) AuthCoreService > login > should throw UnauthorizedException when password invalid [1.59ms]
(pass) AuthCoreService > login > should throw when validated user has null email [1.01ms]
(pass) AuthCoreService > login > should log successful login [0.77ms]
(pass) AuthCoreService > login > should generate correct token payload [0.74ms]
(pass) AuthCoreService > login > should include all user fields in response [0.67ms]

src/auth/services/email-verification.service.spec.ts:
(pass) EmailVerificationService > requestVerification > should create token and send email when user exists and is not verified [1.25ms]
(pass) EmailVerificationService > requestVerification > should return success without sending email when user does not exist [0.65ms]
(pass) EmailVerificationService > requestVerification > should return success when email is already verified [0.55ms]
134 |       emailService.sendVerificationEmail.mockRejectedValue(
135 |         new Error('SMTP error'),
136 |       );
137 | 
138 |       // Should not throw despite email failure
139 |       await expect(service.requestVerification(dto)).resolves.not.toThrow();
                                                                        ^
error: expect(received).not.toThrow()

Thrown value: {
  success: true,
  message: "Verification email sent",
  token: "verification-token-123",
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/email-verification.service.spec.ts:139:67)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/email-verification.service.spec.ts:121:55)
(fail) EmailVerificationService > requestVerification > should handle email send failure gracefully [0.70ms]
(pass) EmailVerificationService > requestVerification > should include token in non-production mode [0.59ms]
(pass) EmailVerificationService > requestVerification > should use default name when user name is null [0.49ms]
(pass) EmailVerificationService > verifyEmail > should verify email and send welcome email successfully [0.75ms]
(pass) EmailVerificationService > verifyEmail > should handle welcome email send failure gracefully [0.61ms]
(pass) EmailVerificationService > verifyEmail > should handle missing user during welcome email gracefully [0.47ms]
(pass) EmailVerificationService > verifyEmail > should use default name for welcome email when user name is null [0.49ms]

src/auth/services/session.service.spec.ts:
(pass) TokenService > Token Generation > should generate token with correct payload [0.98ms]
(pass) TokenService > Token Generation > should throw error if email is missing [0.53ms]
(pass) TokenService > Token Verification > should verify valid token [0.46ms]
(pass) TokenService > Token Verification > should throw on invalid token [0.45ms]
(pass) TokenService > Token Decode > should decode token without verification [0.45ms]
(pass) Session Management (Business Rules) > should allow creating session when under limit [0.14ms]
(pass) Session Management (Business Rules) > should remove oldest session when at limit [0.12ms]
(pass) Session Management (Business Rules) > should maintain exactly 5 sessions after cleanup [0.15ms]
(pass) Rate Limiting (Login) > should allow login after 4 failed attempts [0.16ms]
(pass) Rate Limiting (Login) > should block IP after 5 failed attempts [0.04ms]
(pass) Rate Limiting (Login) > should NOT block different IP for same email (IP-based, not email-based) [0.04ms]
(pass) Rate Limiting (Login) > should clear attempts on successful login [0.05ms]
(pass) Rate Limiting (Login) > should track attempt count correctly [0.03ms]

src/auth/services/verification-token.service.spec.ts:
(pass) VerificationTokenService > createEmailVerificationToken > should create email verification token [1.01ms]
(pass) VerificationTokenService > createEmailVerificationToken > should set expiry time correctly for email verification [0.54ms]
(pass) VerificationTokenService > createEmailVerificationToken > should upsert token to handle existing tokens [0.51ms]
(pass) VerificationTokenService > createPasswordResetToken > should create password reset token with prefix [0.58ms]
(pass) VerificationTokenService > createPasswordResetToken > should set shorter expiry for password reset tokens [0.54ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should validate and delete valid email verification token [0.77ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should throw BadRequestException for non-existent token [0.58ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should throw BadRequestException for expired token [1.04ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should handle cleanup failure for expired tokens gracefully [0.96ms]
(pass) VerificationTokenService > validatePasswordResetToken > should validate and return email from reset token [0.92ms]
(pass) VerificationTokenService > validatePasswordResetToken > should throw BadRequestException for email verification token [0.65ms]
(pass) VerificationTokenService > validatePasswordResetToken > should throw BadRequestException for null token [0.69ms]
(pass) VerificationTokenService > validatePasswordResetToken > should throw BadRequestException for expired reset token [0.75ms]
(pass) VerificationTokenService > validatePasswordResetToken > should extract email correctly from prefixed identifier [0.75ms]
(pass) VerificationTokenService > token generation > should generate different tokens on subsequent calls [0.56ms]
(pass) VerificationTokenService > token generation > should generate hex string tokens [0.47ms]

src/auth/services/password-change.bug.spec.ts:
48 |         password: 'newHashedPassword',
49 |       });
50 | 
51 |       // After password change, sessions should be cleared
52 |       // BUG: This is NOT being called!
53 |       expect(mockPrisma.session.deleteMany).toHaveBeenCalledWith({
                                                 ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  {
    where: {
      userId: "user-123",
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/password-change.bug.spec.ts:53:45)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/password-change.bug.spec.ts:42:64)
(fail) Password Change - BUG DETECTION > BUG-056: Sessions Not Invalidated After Password Change > should invalidate all sessions when password changes [0.27ms]
(pass) Password Change - BUG DETECTION > BUG-056: Sessions Not Invalidated After Password Change > should blacklist all active tokens when password changes [0.03ms]

src/auth/services/password.service.spec.ts:
(pass) PasswordService > hash > should hash a password [112.07ms]
(pass) PasswordService > hash > should generate different hashes for the same password [184.51ms]
(pass) PasswordService > compare > should return true for matching password and hash [183.43ms]
(pass) PasswordService > compare > should return false for non-matching password [182.78ms]

src/auth/services/password-reset.service.spec.ts:
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "70f1ed76199b7f87f6887",
},
 moduleRef: {
  id: "d35f07806670f1ed76199",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > forgotPassword > should create token and send email when user exists [1.62ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "12043d367957a0f767252",
},
 moduleRef: {
  id: "f68873c01112043d36795",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > forgotPassword > should return success without sending email when user does not exist [0.92ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "6d97d8fcdd31364c22a3d",
},
 moduleRef: {
  id: "672523ca256d97d8fcdd3",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > forgotPassword > should handle email send failure gracefully [0.93ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "cab9f683c22d3893492ab",
},
 moduleRef: {
  id: "22a3dc4922cab9f683c22",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > forgotPassword > should include token in non-production mode when email sent [1.44ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "2893ce351dd11f61de423",
},
 moduleRef: {
  id: "492ab08bf22893ce351dd",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > forgotPassword > should include token in non-production mode when email fails [1.88ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "206a2fb4c6cf4d4f0d9c9",
},
 moduleRef: {
  id: "de4238e2dd206a2fb4c6c",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > resetPassword > should reset password successfully with valid token [1.38ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "38e0932307df8e946afe2",
},
 moduleRef: {
  id: "0d9c9d74b938e0932307d",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > resetPassword > should throw error when token is invalid [1.18ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "1c95c336729ce2b62e467",
},
 moduleRef: {
  id: "6afe28153a1c95c336729",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > changePassword > should change password successfully when current password is correct [0.85ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "91f40a40adbac258581b6",
},
 moduleRef: {
  id: "2e467480dc91f40a40adb",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > changePassword > should throw NotFoundException when user does not exist [0.75ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "449ef2f2d8bd2269e662e",
},
 moduleRef: {
  id: "581b6e3428449ef2f2d8b",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > changePassword > should throw NotFoundException when user has no password [0.88ms]
281 |         return this.lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId, inquirer, keyOrIndex);
282 |     }
283 |     async lookupComponentInParentModules(dependencyContext, moduleRef, wrapper, contextId = constants_2.STATIC_CONTEXT, inquirer, keyOrIndex) {
284 |         const instanceWrapper = await this.lookupComponentInImports(moduleRef, dependencyContext.name, wrapper, [], contextId, inquirer, keyOrIndex);
285 |         if ((0, shared_utils_1.isNil)(instanceWrapper)) {
286 |             throw new unknown_dependencies_exception_1.UnknownDependenciesException(wrapper.name, dependencyContext, moduleRef, { id: wrapper.id });
                        ^
error: Nest can't resolve dependencies of the PasswordResetService (PrismaService, AppLoggerService, EmailService, PasswordService, VerificationTokenService, ?). Please make sure that the argument TokenBlacklistService at index [5] is available in the RootTestModule context.

Potential solutions:
- Is RootTestModule a valid NestJS module?
- If TokenBlacklistService is a provider, is it part of the current RootTestModule?
- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?
  @Module({
    imports: [ /* the Module containing TokenBlacklistService */ ]
  })

For more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors
      type: "PasswordResetService",
   context: {
  index: 5,
  dependencies: [
    [class PrismaService extends r], [class AppLoggerService], [class EmailService], [class PasswordService], [class VerificationTokenService],
    [class TokenBlacklistService]
  ],
  name: [class TokenBlacklistService],
},
  metadata: {
  id: "f8ca4559ebd645e550e5c",
},
 moduleRef: {
  id: "e662edd909f8ca4559ebd",
},

      at lookupComponentInParentModules (/home/ilelo/Documents/Projects/profile/profile-services/node_modules/@nestjs/core/injector/injector.js:286:19)
(fail) PasswordResetService > changePassword > should throw UnauthorizedException when current password is incorrect [0.76ms]

src/auth/services/token.service.spec.ts:
(pass) TokenService > generateToken > should generate a JWT token with correct payload [1.07ms]
(pass) TokenService > generateToken > should include hasCompletedOnboarding false when user has not completed [0.72ms]
(pass) TokenService > verifyToken > should verify and return decoded token [0.71ms]
(pass) TokenService > verifyToken > should throw when token is invalid [1.03ms]
(pass) TokenService > decodeToken > should decode token without verification [1.29ms]
(pass) TokenService > decodeToken > should return null for invalid token [1.15ms]

src/dsl/migrators/dsl-migration.service.spec.ts:
(pass) DslMigrationService > registerMigrators > should register migrators [1.03ms]
(pass) DslMigrationService > migrate > should return same DSL if already at target version [0.76ms]
(pass) DslMigrationService > migrate > should migrate to next version [0.63ms]
(pass) DslMigrationService > migrate > should throw if no migrator found [0.66ms]
(pass) DslMigrationService > migrate > should apply migration chain [0.67ms]
(pass) DslMigrationService > migrate > should detect circular migration [0.63ms]
(pass) DslMigrationService > migrate > should throw if migration result has wrong version [0.63ms]
(pass) DslMigrationService > canMigrate > should return true for same version [0.54ms]
(pass) DslMigrationService > canMigrate > should return true if migration path exists [0.64ms]
(pass) DslMigrationService > canMigrate > should return false if no migration path exists [0.62ms]
(pass) DslMigrationService > getMigrationPath > should return single version for same version [1.52ms]
(pass) DslMigrationService > getMigrationPath > should return migration path [0.97ms]
(pass) DslMigrationService > getMigrationPath > should throw if no path exists [0.92ms]

src/integrations/github/github.service.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'GitHubUser' not found in '../types/github.types'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/translation/services/translation-core.service.spec.ts:
(pass) TranslationCoreService > Fallback Behavior > should return original text when service is unavailable [1.86ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:35 PM [31m  ERROR[39m [38;5;3m[TranslationCoreService] [39m[31mTranslation failed: Connection refused[39m
(pass) TranslationCoreService > Fallback Behavior > should return original text on HTTP error [6.55ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:35 PM [31m  ERROR[39m [38;5;3m[TranslationCoreService] [39m[31mTranslation failed: Timeout[39m
(pass) TranslationCoreService > Fallback Behavior > should return original text on timeout [1.37ms]
[31m[Nest] 171558  - [39m01/07/2026, 4:56:35 PM [31m  ERROR[39m [38;5;3m[TranslationCoreService] [39m[31mTranslation failed: Service error[39m
(pass) TranslationCoreService > Fallback Behavior > should continue main flow on translation failure [1.13ms]
(pass) TranslationCoreService > Successful Translation > should translate PT to EN [1.28ms]
(pass) TranslationCoreService > Successful Translation > should translate EN to PT [0.99ms]
(pass) TranslationCoreService > Supported Languages (PT-BR and EN only) > should support pt as source language [0.94ms]
(pass) TranslationCoreService > Supported Languages (PT-BR and EN only) > should support en as source language [0.81ms]
(pass) TranslationCoreService > Empty/Null Text Handling > should return empty string for empty input [0.67ms]
(pass) TranslationCoreService > Empty/Null Text Handling > should return whitespace string as-is [0.69ms]
(pass) TranslationCoreService > Service Availability > should check service health on init [0.99ms]
(pass) TranslationCoreService > Service Availability > should mark service unavailable on health check failure [1.16ms]
(pass) TranslationCoreService > Service Availability > should report availability status [1.26ms]

src/common/cache/services/cache-core.service.spec.ts:
(pass) CacheCoreService > get > should return parsed value on success [1.50ms]
(pass) CacheCoreService > get > should return null on cache miss [0.77ms]
(pass) CacheCoreService > get > should return null and log error on Redis failure [0.87ms]
(pass) CacheCoreService > get > should return null when cache is disabled [0.71ms]
(pass) CacheCoreService > get > should return null when client is null [0.64ms]
(pass) CacheCoreService > set > should set value without TTL [0.64ms]
(pass) CacheCoreService > set > should set value with TTL [0.62ms]
(pass) CacheCoreService > set > should log error on Redis failure [0.67ms]
(pass) CacheCoreService > set > should do nothing when cache is disabled [0.63ms]
(pass) CacheCoreService > delete > should delete key [0.76ms]
(pass) CacheCoreService > delete > should log error on Redis failure [0.99ms]
(pass) CacheCoreService > delete > should do nothing when cache is disabled [1.08ms]
(pass) CacheCoreService > deletePattern > should delete all matching keys [1.39ms]
(pass) CacheCoreService > deletePattern > should not call del when no keys match [0.88ms]
(pass) CacheCoreService > deletePattern > should log error on Redis failure [0.79ms]
(pass) CacheCoreService > deletePattern > should do nothing when cache is disabled [0.94ms]
(pass) CacheCoreService > flush > should flush database and log success [1.10ms]
(pass) CacheCoreService > flush > should log error on Redis failure [0.85ms]
(pass) CacheCoreService > flush > should do nothing when cache is disabled [0.80ms]
(pass) CacheCoreService > isEnabled > should return true when Redis is enabled and client exists [0.67ms]
(pass) CacheCoreService > isEnabled > should return false when Redis is disabled [0.57ms]
(pass) CacheCoreService > isEnabled > should return false when client is null [0.67ms]

src/resumes/services/base/base-sub-resource.service.spec.ts:
93 |       mockResumesRepository.findOne.mockResolvedValue(mockResume as any);
94 | 
95 |       // Access private method through public methods
96 |       await expect(
97 |         service.listForResume(mockResumeId, mockUserId),
98 |       ).resolves.not.toThrow();
                          ^
error: expect(received).not.toThrow()

Thrown value: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/base/base-sub-resource.service.spec.ts:98:22)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/base/base-sub-resource.service.spec.ts:92:60)
(fail) BaseSubResourceService > validateResumeOwnership > should pass validation when user owns the resume [2.64ms]
(pass) BaseSubResourceService > validateResumeOwnership > should throw ForbiddenException when resume not found [1.39ms]
(pass) BaseSubResourceService > validateResumeOwnership > should throw ForbiddenException when user does not own resume [1.00ms]
(pass) BaseSubResourceService > listForResume > should return paginated results for valid owner [0.70ms]
(pass) BaseSubResourceService > listForResume > should pass custom pagination parameters [0.67ms]
(pass) BaseSubResourceService > listForResume > should use default pagination when not provided [0.55ms]
(pass) BaseSubResourceService > findOne > should return entity when found [0.60ms]
(pass) BaseSubResourceService > findOne > should throw NotFoundException when entity not found [0.66ms]
(pass) BaseSubResourceService > findOne > should validate resume ownership before finding entity [0.56ms]
(pass) BaseSubResourceService > create > should create entity for valid owner [0.67ms]
(pass) BaseSubResourceService > create > should validate resume ownership before creating [0.66ms]
(pass) BaseSubResourceService > update > should update entity for valid owner [0.63ms]
(pass) BaseSubResourceService > update > should throw NotFoundException when entity not found [0.60ms]
(pass) BaseSubResourceService > update > should validate resume ownership before updating [0.64ms]
(pass) BaseSubResourceService > remove > should delete entity for valid owner [0.69ms]
(pass) BaseSubResourceService > remove > should throw NotFoundException when entity not found [0.89ms]
(pass) BaseSubResourceService > remove > should validate resume ownership before deleting [0.95ms]
(pass) BaseSubResourceService > reorder > should reorder entities for valid owner [1.00ms]
(pass) BaseSubResourceService > reorder > should validate resume ownership before reordering [1.35ms]

src/integrations/github/services/github-sync.service.limit.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'GitHubUser' not found in '../types/github.types'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/integrations/github/services/github-api.service.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'GitHubUser' not found in '../types/github.types'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


src/integrations/github/services/github-api.service.bug.spec.ts:

# Unhandled error between tests
-------------------------------
1 | (function (entry, fetcher)
              ^
SyntaxError: export 'GitHubUser' not found in '../types/github.types'
      at loadAndEvaluateModule (1:11)
      at link (1:11)
      at link (1:11)
      at link (1:11)
      at linkAndEvaluateModule (1:11)
      at loadAndEvaluateModule (2:1)
      at processTicksAndRejections (7:39)
-------------------------------


144 tests failed:
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should REJECT file with spoofed MIME type [2.40ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate JPEG magic bytes (FFD8FF) [2.01ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate PNG magic bytes (89504E47) [1.11ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT double extension attack (image.jpg.php) [0.97ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT null byte attack (image.php%00.jpg) [1.00ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT directory traversal in filename [1.05ms]
(fail) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should block IP after 5 failed login attempts [0.58ms]
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should NOT silently return true when Redis is disabled [1.98ms]
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should log warning when operating without Redis [0.94ms]
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should fail-safe for critical operations [0.92ms]
(fail) CacheLockService - BUG DETECTION > Alternative: In-Memory Fallback > should use in-memory fallback when Redis unavailable [1.58ms]
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should report when cache set fails [2.83ms]
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should retry on transient failures [1.32ms]
(fail) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should ACCEPT valid CUID format [0.51ms]
(fail) ParseCuidPipe - BUG DETECTION > Current Buggy Behavior (documenting) > currently allows invalid IDs through (THIS IS A BUG) [0.30ms]
(fail) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should REJECT isCurrent=false with endDate=null (ambiguous) [1.15ms]
(fail) ExperienceService - Bug Detection > Order uniqueness validation > should REJECT creating experience with duplicate order [0.97ms]
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REJECT isCurrent=true with endDate set [3.99ms]
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REJECT endDate before startDate [1.42ms]
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REQUIRE endDate when isCurrent=false [1.21ms]
(fail) EducationService - BUG DETECTION > BUG-052: Order Not Validated > should REJECT duplicate order values [0.81ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 1 in summary [1.92ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 2 in summary [0.79ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 3 in summary [0.72ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 4 in summary [0.69ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 5 in summary [0.64ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 6 in summary [0.66ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 7 in summary [0.68ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 8 in summary [0.64ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 9 in summary [0.63ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 10 in summary [0.57ms]
(fail) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should have timeout on page operations [31003.26ms]
  ^ this test timed out after 5000ms.
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should use transaction for order assignment [2.01ms]
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should handle concurrent skill additions without duplicate orders [1.16ms]
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when adding skill [1.31ms]
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when deleting skill [1.61ms]
(fail) UserAdminMutationService > create > should throw ConflictException when email exists [1.17ms]
(fail) UserAdminMutationService > update > should throw ConflictException when email already in use [2.13ms]
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should use transaction to prevent race condition [1.35ms]
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should handle unique constraint violation gracefully [0.99ms]
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 1: Try create, catch unique violation [0.65ms]
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 2: Transaction with serializable isolation [0.68ms]
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when promoting user to admin [0.94ms]
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when demoting admin to user [0.94ms]
(fail) UserAdminMutationService - Bug Detection > Password reset > should REJECT weak passwords [0.93ms]
(fail) UserAdminMutationService - Bug Detection > Password reset > should create audit log for password reset [1.20ms]
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 1 [0.27ms]
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 2 [0.07ms]
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 3 [0.05ms]
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should validate limit is a valid number [1.89ms]
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject negative limits [0.91ms]
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject extremely large limits [0.70ms]
(fail) TextExtractionService > extractText > PDF files > should extract text from valid PDF [1.56ms]
(fail) TextExtractionService > extractText > PDF files > should detect image-based PDFs [0.73ms]
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should change status from PRIVATE to PENDING on submit [2.20ms]
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already PENDING theme [0.65ms]
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already APPROVED theme [0.65ms]
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should REJECT resubmitting after 2 rejections [0.69ms]
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should increment rejectionCount when theme is rejected [0.97ms]
(fail) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should REJECT 3rd resubmission after 2 rejections [1.71ms]
(fail) ThemeCrudService - LIMIT BUG DETECTION > BUG-013: Admin Pre-Approval > should allow admin to create pre-approved theme [2.16ms]
(fail) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should REJECT resubmitting theme that was rejected twice [1.18ms]
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is submitted [1.00ms]
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is approved [1.51ms]
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is rejected [1.24ms]
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should enforce maximum limit on search [1.97ms]
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should have default limit when none provided [2.02ms]
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT skipping from welcome to skills [2.00ms]
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT going to education without completing experience step [1.65ms]
(fail) TechAreaQueryService > getAllAreas > should return results sorted by order [1.07ms]
(fail) JwtStrategy > validate > should return user payload when user exists [2.27ms]
(fail) JwtStrategy > validate > should return correct onboarding status [1.01ms]
(fail) JwtStrategy > validate > should return admin role when user is admin [1.05ms]
(fail) JwtStrategy > constructor > should throw error when JWT_SECRET is not configured [3.88ms]
(fail) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should REJECT user with unverified email (emailVerified = null) [1.53ms]
(fail) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should ALLOW user with verified email [0.92ms]
(fail) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should include emailVerified in query select [0.91ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to revoke/blacklist a token [1.93ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to logout all sessions [1.14ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should check token blacklist during validation [0.96ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should track active sessions for logout all functionality [1.19ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > revoked token should be rejected on refresh [1.54ms]
(fail) Token Revocation - BUG DETECTION > Session Management > should store session when logging in [1.59ms]
(fail) Token Revocation - BUG DETECTION > Session Management > should enforce session limit of 5 [1.45ms]
(fail) AccountManagementService > changeEmail > should change email successfully when all validations pass [1.50ms]
(fail) AccountManagementService > changeEmail > should throw UnauthorizedException when user has no password [0.90ms]
(fail) AccountManagementService > changeEmail > should throw UnauthorizedException when password is incorrect [0.84ms]
(fail) AccountManagementService > changeEmail > should throw ConflictException when new email is already taken [0.86ms]
(fail) AccountManagementService > changeEmail > should reset emailVerified to null when changing email [0.89ms]
(fail) AccountManagementService > deleteAccount > should delete account successfully for non-admin user [0.81ms]
(fail) AccountManagementService > deleteAccount > should delete admin account when there are multiple admins [1.50ms]
(fail) AccountManagementService > deleteAccount > should throw BadRequestException when deleting last admin [1.64ms]
(fail) AccountManagementService > deleteAccount > should throw UnauthorizedException when user has no password [1.36ms]
(fail) AccountManagementService > deleteAccount > should throw UnauthorizedException when password is incorrect [1.34ms]
(fail) AccountManagementService > deleteAccount > should not check admin count for non-admin users [1.39ms]
(fail) AccountManagementService > error handling > should handle user not found in changeEmail [0.87ms]
(fail) AccountManagementService > error handling > should handle user not found in deleteAccount [0.86ms]
(fail) TokenRefreshService > refreshToken > should generate new tokens for valid user [1.68ms]
(fail) TokenRefreshService > refreshToken > should throw UnauthorizedException when user not found [0.96ms]
(fail) TokenRefreshService > refreshToken > should throw UnauthorizedException when user email is null [1.44ms]
(fail) TokenRefreshService > refreshToken > should generate tokens with correct payload [1.32ms]
(fail) TokenRefreshService > refreshWithToken > should refresh tokens using valid refresh token [1.14ms]
(fail) TokenRefreshService > refreshWithToken > should throw UnauthorizedException for invalid refresh token [1.32ms]
(fail) TokenRefreshService > refreshWithToken > should throw UnauthorizedException when decoded user not found [1.01ms]
(fail) TokenRefreshService > refreshWithToken > should handle token verification errors gracefully [0.81ms]
(fail) TokenRefreshService > getCurrentUser > should return current user data [0.68ms]
(fail) TokenRefreshService > getCurrentUser > should throw UnauthorizedException when user not found [0.63ms]
(fail) TokenRefreshService > getCurrentUser > should return user with null fields correctly [0.67ms]
(fail) TokenRefreshService > getCurrentUser > should return admin user data correctly [0.73ms]
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should use transaction to prevent race condition [1.26ms]
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should handle unique constraint violation on email change [1.02ms]
(fail) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should revoke all tokens when account is deleted [0.89ms]
(fail) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should add current token to blacklist on deletion [1.39ms]
(fail) AccountManagementService - BUG DETECTION > BUG-057: Email Change Session Invalidation > should invalidate all sessions when email changes [1.45ms]
(fail) EmailVerificationService > requestVerification > should handle email send failure gracefully [0.70ms]
(fail) Password Change - BUG DETECTION > BUG-056: Sessions Not Invalidated After Password Change > should invalidate all sessions when password changes [0.27ms]
(fail) PasswordResetService > forgotPassword > should create token and send email when user exists [1.62ms]
(fail) PasswordResetService > forgotPassword > should return success without sending email when user does not exist [0.92ms]
(fail) PasswordResetService > forgotPassword > should handle email send failure gracefully [0.93ms]
(fail) PasswordResetService > forgotPassword > should include token in non-production mode when email sent [1.44ms]
(fail) PasswordResetService > forgotPassword > should include token in non-production mode when email fails [1.88ms]
(fail) PasswordResetService > resetPassword > should reset password successfully with valid token [1.38ms]
(fail) PasswordResetService > resetPassword > should throw error when token is invalid [1.18ms]
(fail) PasswordResetService > changePassword > should change password successfully when current password is correct [0.85ms]
(fail) PasswordResetService > changePassword > should throw NotFoundException when user does not exist [0.75ms]
(fail) PasswordResetService > changePassword > should throw NotFoundException when user has no password [0.88ms]
(fail) PasswordResetService > changePassword > should throw UnauthorizedException when current password is incorrect [0.76ms]
(fail) BaseSubResourceService > validateResumeOwnership > should pass validation when user owns the resume [2.64ms]

 990 pass
 144 fail
 16 errors
 1546 expect() calls
Ran 1134 tests across 123 files. [35.40s]
