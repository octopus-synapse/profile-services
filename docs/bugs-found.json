{
  "metadata": {
    "auditor": "Uncle Bob (sem café E sem almoço - FURIOSO)",
    "date": "2026-01-07",
    "severity_levels": ["CRITICAL", "HIGH", "MEDIUM", "LOW"],
    "status_options": ["OPEN", "IN_PROGRESS", "FIXED", "WONT_FIX"],
    "total_bugs": 64
  },
  "bugs": [
    {
      "id": "BUG-001",
      "title": "Race Condition: Email uniqueness check (TOCTOU)",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": [
        "src/admin/services/user-admin-mutation.service.ts",
        "src/auth/services/auth-core.service.ts"
      ],
      "description": "Classic Time-Of-Check-To-Time-Of-Use vulnerability. The `ensureEmailNotExists` method checks if email exists, then creates user. Between check and create, another request could register the same email."
    },
    {
      "id": "BUG-002",
      "title": "Race Condition: Username uniqueness check (TOCTOU)",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": [
        "src/admin/services/user-admin-mutation.service.ts",
        "src/users/services/username.service.ts"
      ],
      "description": "Same TOCTOU vulnerability for username uniqueness. Between `isUsernameTaken` check and update, another user could claim the same username."
    },
    {
      "id": "BUG-003",
      "title": "Race Condition: Resume limit check",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/resumes/resumes.service.ts"],
      "description": "The `create` method checks resume count with `findAll`, then creates. Two concurrent requests could both see 3 resumes and both create, resulting in 5 resumes."
    },
    {
      "id": "BUG-004",
      "title": "Distributed Lock Disabled Silently",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": ["src/common/cache/cache-lock.service.ts"],
      "description": "When Redis is disabled, `acquireLock` returns `true` instead of throwing an error. All race condition protections are silently disabled."
    },
    {
      "id": "BUG-005",
      "title": "No Session Limit Enforcement (5 devices max)",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/auth/services/auth-core.service.ts", "src/auth/services/token.service.ts"],
      "description": "Business rule states max 5 active sessions per user. But NO session counting or invalidation logic exists."
    },
    {
      "id": "BUG-006",
      "title": "No Theme Limit Enforcement (5 themes max)",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/themes/services/theme-crud.service.ts"],
      "description": "Business rule states max 5 themes per user. But `ThemeCrudService.create` doesn't check theme count before creating."
    },
    {
      "id": "BUG-007",
      "title": "No Theme Resubmission Limit (max 2)",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/themes/services/theme-approval.service.ts"],
      "description": "Business rule states rejected themes can be resubmitted maximum 2 times. But `submitForApproval` doesn't check rejection count."
    },
    {
      "id": "BUG-008",
      "title": "No GitHub Sync Daily Limit (10 per day)",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/integrations/github/services/github-sync.service.ts"],
      "description": "Business rule states 10 syncs per day per user. But GitHubSyncService has no rate limiting."
    },
    {
      "id": "BUG-009",
      "title": "No Email Verification Check in JWT Validation",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": ["src/auth/strategies/jwt.strategy.ts"],
      "description": "Business rule states user must verify email to use the system. But JwtStrategy.validate() doesn't check `emailVerified`."
    },
    {
      "id": "BUG-010",
      "title": "No Login Rate Limiting by IP (5 attempts = block)",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/auth/controllers/auth-core.controller.ts", "src/auth/services/auth-core.service.ts"],
      "description": "Business rule: after 5 failed login attempts, block IP for 30-60 minutes. Current @Throttle is per-request, not tracking failed attempts."
    },
    {
      "id": "BUG-011",
      "title": "Experience Order Uniqueness Not Enforced",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/resumes/services/experience.service.ts"],
      "description": "Business rule: two items cannot have the same `order` value in a section. But order uniqueness is not validated."
    },
    {
      "id": "BUG-012",
      "title": "No Audit Log for Critical Admin Actions",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/admin/services/user-admin-mutation.service.ts", "src/themes/services/theme-approval.service.ts"],
      "description": "Business rules require audit trail for admin actions, but services don't create audit log entries."
    },
    {
      "id": "BUG-013",
      "title": "Admin Cannot Create Pre-Approved Themes",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/themes/services/theme-crud.service.ts"],
      "description": "Business rule: admins can create themes directly approved. But ThemeCrudService.create always sets status to PRIVATE."
    },
    {
      "id": "BUG-014",
      "title": "Silently Ignoring Token Deletion Errors",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/auth/services/verification-token.service.ts"],
      "description": "Token deletion errors are caught with `.catch(() => {})`. Failed cleanup leads to token accumulation."
    },
    {
      "id": "BUG-015",
      "title": "Pagination Fetches All Records Then Slices",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/resumes/resumes.service.ts"],
      "description": "In `findAll`, pagination fetches ALL records then slices in memory. Defeats pagination purpose."
    },
    {
      "id": "BUG-016",
      "title": "Missing Password Strength Validation in Service",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/auth/services/password.service.ts"],
      "description": "PasswordService.hash accepts ANY string without validation. Internal calls bypassing DTOs could create weak passwords."
    },
    {
      "id": "BUG-017",
      "title": "TODO: DSL Version Migration Not Implemented",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/dsl/dsl-validator.service.ts"],
      "description": "Line 69 has 'TODO: Implement version migration logic'. DSL documents cannot be migrated when schema evolves."
    },
    {
      "id": "BUG-018",
      "title": "No GitHub Account Uniqueness Check",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/integrations/github/services/github-sync.service.ts"],
      "description": "Business rule: each GitHub account can only be linked to one user. But no uniqueness check exists."
    },
    {
      "id": "BUG-019",
      "title": "Education Service Missing Date Validation",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/resumes/services/education.service.ts"],
      "description": "ExperienceService validates dates, but EducationService has no such validation. Inconsistent."
    },
    {
      "id": "BUG-020",
      "title": "Onboarding Progress Orphan Records",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/onboarding/services/onboarding-progress.service.ts"],
      "description": "When progress expires, old records may not always be deleted. Need scheduled cleanup."
    },
    {
      "id": "BUG-021",
      "title": "Onboarding Transaction Atomicity Unclear",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/onboarding/onboarding.service.ts"],
      "description": "While there IS a transaction, the catch block transforms errors. Need to verify all steps are truly atomic."
    },
    {
      "id": "BUG-022",
      "title": "236 'as any' Casts in Codebase",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["Multiple files across src/"],
      "description": "236 instances of 'as any' bypass TypeScript's type safety. Should audit production code casts."
    },
    {
      "id": "BUG-023",
      "title": "No Token Revocation/Blacklist - Cannot Logout",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": ["src/auth/services/token.service.ts", "src/auth/services/token-refresh.service.ts"],
      "description": "JWT tokens have no blacklist mechanism. Once issued, tokens are valid until expiry. Compromised tokens CANNOT be invalidated."
    },
    {
      "id": "BUG-024",
      "title": "SVG Upload Allows XSS Attacks",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/upload/upload.service.ts", "src/common/constants/validation/file-validation.const.ts"],
      "description": "SVG files in allowed MIME types. SVG can contain embedded JavaScript for XSS attacks."
    },
    {
      "id": "BUG-025",
      "title": "No Magic Bytes Validation for Uploads",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/upload/upload.service.ts"],
      "description": "File validation only checks MIME type header, which can be spoofed. Should validate magic bytes."
    },
    {
      "id": "BUG-026",
      "title": "File Extension Not Sanitized",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/upload/upload.service.ts"],
      "description": "getFileExtension just splits on '.'. Filenames like 'image.jpg.php' could bypass security."
    },
    {
      "id": "BUG-027",
      "title": "No File Ownership Check on Delete",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/upload/upload.service.ts"],
      "description": "deleteFile accepts any key without ownership check. User could delete another user's files."
    },
    {
      "id": "BUG-028",
      "title": "Same Secret for Access and Refresh Tokens",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/auth/services/token.service.ts", "src/auth/services/token-refresh.service.ts"],
      "description": "Both token types use JWT_SECRET. Best practice is different secrets for different token types."
    },
    {
      "id": "BUG-029",
      "title": "No User Deletion Cascade Handling",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/admin/services/user-admin-mutation.service.ts"],
      "description": "User deletion just calls prisma.user.delete. No explicit handling of related data."
    },
    {
      "id": "BUG-030",
      "title": "All Uploads Are Public",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/common/services/s3-upload.service.ts"],
      "description": "All files use ACL: 'public-read'. No option for private uploads with signed URLs."
    },
    {
      "id": "BUG-031",
      "title": "GitHub URL Extraction Not Robust",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/integrations/github/services/github-sync.service.ts"],
      "description": "extractUsername uses simple string replace. Fails with query strings, fragments, or variations."
    },
    {
      "id": "BUG-032",
      "title": "No Rate Limit on Password Reset",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/auth/controllers/auth-password.controller.ts"],
      "description": "forgotPassword endpoint can be abused for email bombing. No rate limiting per email."
    },
    {
      "id": "BUG-033",
      "title": "Race Condition: AccountManagement Email Change (TOCTOU)",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": ["src/auth/services/account-management.service.ts"],
      "description": "Same TOCTOU as signup: ensureEmailNotTaken checks, then updateEmail. Another user could claim email between."
    },
    {
      "id": "BUG-034",
      "title": "Race Condition: Skill Order Assignment",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/admin/services/skill-admin.service.ts"],
      "description": "getNextOrder gets max order, then creates with order+1. Two concurrent requests could get same order."
    },
    {
      "id": "BUG-035",
      "title": "parseInt Without NaN Validation",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": [
        "src/mec-sync/controllers/mec-course.controller.ts",
        "src/spoken-languages/spoken-languages.controller.ts",
        "src/tech-skills/controllers/tech-skills-query.controller.ts"
      ],
      "description": "parseInt(limit, 10) can return NaN if limit is non-numeric. NaN passed to service without validation."
    },
    {
      "id": "BUG-036",
      "title": "ParseCuidPipe Allows Invalid IDs Through",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/common/pipes/parse-cuid.pipe.ts"],
      "description": "When CUID regex doesn't match, the pipe returns the value anyway instead of throwing. Invalid IDs reach services."
    },
    {
      "id": "BUG-037",
      "title": "PDF Generator No Timeout Protection",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/export/services/pdf-generator.service.ts"],
      "description": "No timeout on Puppeteer operations. Malformed pages could cause infinite hangs, blocking workers."
    },
    {
      "id": "BUG-038",
      "title": "Banner Capture logoUrl Not Validated (SSRF)",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/export/services/banner-capture.service.ts"],
      "description": "logoUrl parameter passed directly to Puppeteer navigation. Attacker could use internal URLs for SSRF."
    },
    {
      "id": "BUG-039",
      "title": "Email Service Silently Skips When Not Configured",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/common/email/services/email-sender.service.ts"],
      "description": "sendEmail silently returns without error when not configured. Critical emails may never be sent without warning."
    },
    {
      "id": "BUG-040",
      "title": "HTML Strip Regex Can Be Bypassed",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/common/email/services/email-sender.service.ts"],
      "description": "stripHtml uses basic regex. Malformed HTML like `<script >` or `<scr ipt>` may bypass removal."
    },
    {
      "id": "BUG-041",
      "title": "No Audit Log for Skill Admin Operations",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/admin/services/skill-admin.service.ts"],
      "description": "Admin operations on skills (add, update, delete) have no audit trail."
    },
    {
      "id": "BUG-042",
      "title": "No Audit Log for Resume Admin Operations",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/admin/services/resume-admin.service.ts"],
      "description": "Admin operations on resumes (delete) have no audit trail."
    },
    {
      "id": "BUG-043",
      "title": "ResumeAdmin Delete Has No Authorization Check",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/admin/services/resume-admin.service.ts"],
      "description": "delete method only checks resume exists, not if admin has permission for this specific resume."
    },
    {
      "id": "BUG-044",
      "title": "SkillAdmin Delete Has No Authorization Check",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/admin/services/skill-admin.service.ts"],
      "description": "delete method only checks skill exists, not if admin has permission for this specific skill."
    },
    {
      "id": "BUG-045",
      "title": "No CSRF Protection on State-Changing Endpoints",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/main.ts", "src/auth/controllers/"],
      "description": "No CSRF token validation on POST/PUT/DELETE endpoints. Could be vulnerable to cross-site request forgery."
    },
    {
      "id": "BUG-046",
      "title": "Translation Service Health Check in onModuleInit",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/translation/translation.service.ts"],
      "description": "Health check runs in onModuleInit. If service is down, app initialization may fail or timeout."
    },
    {
      "id": "BUG-047",
      "title": "DSL Compiler No Input Size Limit",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/dsl/dsl-compiler.service.ts"],
      "description": "compileFromRaw accepts any input size. Extremely large DSL documents could cause DoS."
    },
    {
      "id": "BUG-048",
      "title": "GitHub API Token Exposed in Logs",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/integrations/github/services/github-api.service.ts"],
      "description": "Error logging might include request headers with Authorization token. Sensitive data could leak to logs."
    },
    {
      "id": "BUG-049",
      "title": "No Rate Limit on Email Verification Request",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/auth/controllers/auth-verification.controller.ts"],
      "description": "While @Throttle exists (3/min), it's global not per-email. Attacker could spam different emails."
    },
    {
      "id": "BUG-050",
      "title": "MEC Sync Lock Not Releasing on Error",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/mec-sync/services/mec-sync.service.ts"],
      "description": "If sync fails between acquireLock and releaseLock, lock may remain until TTL expires, blocking syncs."
    },
    {
      "id": "BUG-051",
      "title": "Theme Query Search Has No Pagination Limit",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/themes/services/theme-query.service.ts"],
      "description": "Search could return thousands of themes without limit. Memory exhaustion risk."
    },
    {
      "id": "BUG-052",
      "title": "Project/Publication/Talk Order Not Validated",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/resumes/services/project.service.ts", "src/resumes/services/publication.service.ts", "src/resumes/services/talk.service.ts"],
      "description": "Like Experience, these entities have order field but no uniqueness validation."
    },
    {
      "id": "BUG-053",
      "title": "Spoken Language Search No Minimum Query Length",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/spoken-languages/services/spoken-languages.service.ts"],
      "description": "Empty or single char query accepted. Could return too many results."
    },
    {
      "id": "BUG-054",
      "title": "Cache Set Without Error Handling",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/common/cache/services/cache-core.service.ts"],
      "description": "Redis set operations may silently fail. Critical cached data might not be stored."
    },
    {
      "id": "BUG-055",
      "title": "Account Deletion Doesn't Revoke Active Tokens",
      "severity": "CRITICAL",
      "status": "OPEN",
      "files_related": ["src/auth/services/account-management.service.ts"],
      "description": "When user deletes account, active tokens remain valid. Deleted user could still access system until token expires."
    },
    {
      "id": "BUG-056",
      "title": "Password Change Doesn't Invalidate Sessions",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/auth/controllers/auth-password.controller.ts"],
      "description": "After password change, old sessions remain valid. Attacker who knew old password keeps access."
    },
    {
      "id": "BUG-057",
      "title": "Email Change Doesn't Invalidate Sessions",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/auth/services/account-management.service.ts"],
      "description": "After email change, sessions with old email in token remain valid. Token claims become stale."
    },
    {
      "id": "BUG-058",
      "title": "No Concurrent Request Protection on User Profile Update",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/users/services/user-profile.service.ts"],
      "description": "Two simultaneous profile updates could result in lost updates (last write wins without conflict detection)."
    },
    {
      "id": "BUG-059",
      "title": "Theme Style Config Not Validated for Size",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/themes/services/theme-crud.service.ts"],
      "description": "styleConfig is JSON stored without size limit. Extremely large configs could cause storage/performance issues."
    },
    {
      "id": "BUG-060",
      "title": "Resume Summary/Description Not Sanitized for XSS",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/resumes/resumes.service.ts", "src/resumes/services/experience.service.ts"],
      "description": "Text fields stored directly without HTML sanitization. If rendered unsafely in frontend, XSS possible."
    },
    {
      "id": "BUG-061",
      "title": "No Maximum Skills Per Resume Limit",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/resumes/services/skill.service.ts"],
      "description": "User can add unlimited skills to resume. Could cause performance issues or abuse."
    },
    {
      "id": "BUG-062",
      "title": "No Maximum Experiences Per Resume Limit",
      "severity": "LOW",
      "status": "OPEN",
      "files_related": ["src/resumes/services/experience.service.ts"],
      "description": "User can add unlimited experiences. Could cause performance issues rendering resume."
    },
    {
      "id": "BUG-063",
      "title": "MEC Data Not Validated for Malicious Content",
      "severity": "MEDIUM",
      "status": "OPEN",
      "files_related": ["src/mec-sync/services/csv-row-processor.service.ts"],
      "description": "CSV data from MEC ingested without content sanitization. Malicious course/institution names stored directly."
    },
    {
      "id": "BUG-064",
      "title": "ATS Parser ReDoS Vulnerability",
      "severity": "HIGH",
      "status": "OPEN",
      "files_related": ["src/ats/parsers/cv-section.parser.ts"],
      "description": "Regex patterns used for CV parsing could be vulnerable to Regular Expression Denial of Service with crafted input."
    }
  ]
}
