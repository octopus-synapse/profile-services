bun test v1.2.23 (cf136713)

src/app.controller.spec.ts:
(pass) AppController > root > should return "Hello World!" [7.14ms]
(pass) AppController > health > should return health status [1.59ms]
(pass) AppController > version > should return version information [1.91ms]
(pass) AppController > version > should use development environment when manifest not available [1.16ms]

src/resumes/resumes.service.spec.ts:
(pass) ResumesService > Resume Limit (Maximum 4) > should allow creating resume when under limit [1.29ms]
(pass) ResumesService > Resume Limit (Maximum 4) > should reject creating 5th resume with error [1.03ms]
(pass) ResumesService > Resume Limit (Maximum 4) > should show clear error message about 4 resume limit [0.94ms]
(pass) ResumesService > Resume Limit (Maximum 4) > should allow creating exactly 4 resumes [0.91ms]
(pass) ResumesService > Resume CRUD Operations > should return all resumes for a user [0.97ms]
(pass) ResumesService > Resume CRUD Operations > should return resume by id if owned by user [1.03ms]
(pass) ResumesService > Resume CRUD Operations > should throw NotFoundException for non-existent resume [1.39ms]
(pass) ResumesService > Resume CRUD Operations > should update resume if owned by user [1.23ms]
(pass) ResumesService > Resume CRUD Operations > should delete resume if owned by user [0.81ms]
(pass) ResumesService > Remaining Slots > should correctly calculate remaining slots [1.01ms]
(pass) ResumesService > Remaining Slots > should show 0 remaining when at limit [0.67ms]
(pass) Experience Order Uniqueness > should reject creating experience with duplicate order [0.07ms]
(pass) Experience Order Uniqueness > should allow creating experience with unique order [0.03ms]
(pass) Experience Order Uniqueness > should auto-assign next order when not specified [0.03ms]
(pass) isCurrent and endDate Validation > should accept isCurrent=true with endDate=null [0.03ms]
(pass) isCurrent and endDate Validation > should reject isCurrent=true with non-null endDate [0.02ms]
(pass) isCurrent and endDate Validation > should accept isCurrent=false with endDate set [0.02ms]
(pass) isCurrent and endDate Validation > should accept isCurrent=false with endDate=null (left position)
(pass) Skills Reference Validation > should accept valid skill references [0.08ms]
(pass) Skills Reference Validation > should reject invalid skill references [0.02ms]
(pass) Skills Reference Validation > should accept empty skill references [0.03ms]

src/resumes/resumes.service.bug-detection.spec.ts:
(pass) ResumesService - Bug Detection > BUG #3: Resume limit should return HTTP 422 > should throw UnprocessableEntityException (422) when limit reached [0.99ms]
(pass) ResumesService - Bug Detection > BUG #3: Resume limit should return HTTP 422 > should NOT throw BadRequestException (400) for limit error [0.74ms]
(pass) ResumesService - Bug Detection > BUG #3: Resume limit should return HTTP 422 > should have exactly the message "O limite mÃ¡ximo de currÃ­culos Ã© 4" (pt-BR) [0.86ms]
(pass) ResumesService - Bug Detection > Resume limit boundary tests > should allow creating 4th resume (at limit) [0.60ms]
(pass) ResumesService - Bug Detection > Resume limit boundary tests > should reject at exactly 4 existing resumes [0.47ms]

src/resumes/resumes.repository.spec.ts:
(pass) ResumesRepository > findAll > should return empty array when user has no resumes [1.30ms]
(pass) ResumesRepository > findAll > should return all resumes for the user [0.98ms]
(pass) ResumesRepository > findOne > should return resume when it exists and belongs to user [1.42ms]
(pass) ResumesRepository > findOne > should return null when resume does not exist [0.98ms]
(pass) ResumesRepository > findOne > should return null when resume belongs to another user [0.83ms]
(pass) ResumesRepository > create > should create resume and return it with generated id [1.27ms]
(pass) ResumesRepository > create > should persist resume to storage [0.75ms]
(pass) ResumesRepository > update > should update resume when user owns it [0.61ms]
(pass) ResumesRepository > update > should throw ForbiddenException when resume does not exist [0.56ms]
(pass) ResumesRepository > update > should throw ForbiddenException when user does not own resume [0.48ms]
(pass) ResumesRepository > delete > should delete resume and return true when user owns it [0.54ms]
(pass) ResumesRepository > delete > should throw ForbiddenException when resume does not exist [0.45ms]
(pass) ResumesRepository > delete > should throw ForbiddenException when user does not own resume [0.52ms]
(pass) ResumesRepository > findByUserId > should return null when user has no resume [0.57ms]
(pass) ResumesRepository > findByUserId > should return first resume for user [0.61ms]

src/users/users.service.spec.ts:
(pass) UsersService (Facade) > getPublicProfileByUsername > should return public profile with user and resume data [1.46ms]
(pass) UsersService (Facade) > getProfile > should return user profile with expected fields [0.80ms]
(pass) UsersService (Facade) > updateProfile > should return success with updated profile data [0.70ms]
(pass) UsersService (Facade) > getPreferences > should return user preferences [0.56ms]
(pass) UsersService (Facade) > updatePreferences > should return success when preferences are updated [0.56ms]
(pass) UsersService (Facade) > getFullPreferences > should return complete preferences object [0.60ms]
(pass) UsersService (Facade) > updateFullPreferences > should return success when full preferences are updated [0.69ms]
(pass) UsersService (Facade) > updateUsername > should return success with new username [0.97ms]
(pass) UsersService (Facade) > checkUsernameAvailability > should return availability status [0.90ms]

src/upload/upload.service.spec.ts:
(pass) UploadService > uploadProfileImage > should upload valid profile image and return result [1.66ms]
(pass) UploadService > uploadProfileImage > should generate unique keys for multiple uploads [0.94ms]
(pass) UploadService > uploadProfileImage > should preserve file extension in uploaded key [0.80ms]
(pass) UploadService > uploadProfileImage > should throw BadRequestException when file size exceeds limit [0.84ms]
(pass) UploadService > uploadProfileImage > should throw BadRequestException for invalid MIME type [0.60ms]
(pass) UploadService > uploadProfileImage > should throw BadRequestException when S3 upload fails [0.80ms]
(pass) UploadService > uploadCompanyLogo > should upload valid company logo and return result [0.67ms]
(pass) UploadService > uploadCompanyLogo > should throw BadRequestException for oversized file [0.53ms]
(pass) UploadService > uploadCompanyLogo > should throw BadRequestException when S3 upload fails [0.52ms]
(pass) UploadService > deleteFile > should delete file successfully and log result [0.72ms]
(pass) UploadService > deleteFile > should return false when deletion fails without throwing [0.50ms]
(pass) UploadService > isServiceAvailable > should return true when S3 service is enabled [0.39ms]
(pass) UploadService > isServiceAvailable > should return false when S3 service is disabled [0.37ms]
(pass) UploadService > file validation > should accept all allowed MIME types [0.47ms]
(pass) UploadService > file validation > should handle files at exact size limit [0.43ms]
(pass) UploadService > file validation > should handle filenames with multiple dots correctly [0.43ms]
(pass) UploadService > file validation > should convert extension to lowercase [0.44ms]

src/upload/upload.service.security.spec.ts:
(pass) UploadService - SECURITY BUG DETECTION > BUG-024: SVG XSS Prevention > should REJECT SVG files with embedded scripts [2.01ms]
(pass) UploadService - SECURITY BUG DETECTION > BUG-024: SVG XSS Prevention > should REJECT SVG with event handlers [0.95ms]
102 |       };
103 | 
104 |       // BUG: This should detect it's not a real JPEG!
105 |       await expect(
106 |         service.uploadProfileImage('user-123', spoofedFile),
107 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:107:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:95:53)
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should REJECT file with spoofed MIME type [0.80ms]
116 |         size: 100,
117 |       };
118 | 
119 |       await expect(
120 |         service.uploadProfileImage('user-123', invalidJpeg),
121 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:121:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:110:53)
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate JPEG magic bytes (FFD8FF) [0.72ms]
129 |         size: 100,
130 |       };
131 | 
132 |       await expect(
133 |         service.uploadProfileImage('user-123', invalidPng),
134 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:134:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:124:54)
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate PNG magic bytes (89504E47) [0.62ms]
151 |       };
152 | 
153 |       // BUG: This extracts 'php' as extension but should reject!
154 |       await expect(
155 |         service.uploadProfileImage('user-123', doubleExtension),
156 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:156:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:145:65)
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT double extension attack (image.jpg.php) [0.59ms]
164 |         size: 100,
165 |       };
166 | 
167 |       await expect(
168 |         service.uploadProfileImage('user-123', nullByteAttack),
169 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:169:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:159:61)
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT null byte attack (image.php%00.jpg) [0.61ms]
177 |         size: 100,
178 |       };
179 | 
180 |       await expect(
181 |         service.uploadProfileImage('user-123', traversalAttack),
182 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:182:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/upload/upload.service.security.spec.ts:172:57)
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT directory traversal in filename [0.68ms]
(pass) UploadService - SECURITY BUG DETECTION > BUG-027: File Ownership Validation > should REJECT deleting another users file [0.62ms]

src/onboarding/onboarding.service.spec.ts:
40 |         return {
41 |             success: false,
42 |             get error() {
43 |                 if (this._error)
44 |                     return this._error;
45 |                 const error = new ZodError_js_1.ZodError(ctx.common.issues);
                                   ^
ZodError: [
  {
    "code": "invalid_type",
    "expected": "string",
    "received": "undefined",
    "path": [
      "languages",
      0,
      "name"
    ],
    "message": "Required"
  },
  {
    "expected": "'BASIC' | 'INTERMEDIATE' | 'ADVANCED' | 'FLUENT' | 'NATIVE'",
    "received": "undefined",
    "code": "invalid_type",
    "path": [
      "languages",
      0,
      "level"
    ],
    "message": "Required"
  },
  {
    "code": "invalid_type",
    "expected": "string",
    "received": "undefined",
    "path": [
      "languages",
      1,
      "name"
    ],
    "message": "Required"
  },
  {
    "expected": "'BASIC' | 'INTERMEDIATE' | 'ADVANCED' | 'FLUENT' | 'NATIVE'",
    "received": "undefined",
    "code": "invalid_type",
    "path": [
      "languages",
      1,
      "level"
    ],
    "message": "Required"
  }
]
    issues: [
  [Object ...], [Object ...], [Object ...], [Object ...]
],
  addIssue: [Function],
 addIssues: [Function],

      at error (/home/ilelo/Documents/Projects/profile/profile-contracts/node_modules/zod/v3/types.cjs:45:31)
      at parse (/home/ilelo/Documents/Projects/profile/profile-contracts/node_modules/zod/v3/types.cjs:120:15)
      at completeOnboarding (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/onboarding.service.ts:42:48)
      at completeOnboarding (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/onboarding.service.ts:37:28)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/onboarding.service.spec.ts:215:36)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/onboarding.service.spec.ts:125:51)
(fail) OnboardingService > completeOnboarding > should successfully complete onboarding [4.69ms]
(pass) OnboardingService > completeOnboarding > should throw NotFoundException if user does not exist [1.16ms]
(pass) OnboardingService > completeOnboarding > should throw error if data validation fails [0.61ms]
(pass) OnboardingService > getOnboardingStatus > should successfully get onboarding status [0.49ms]
(pass) OnboardingService > getOnboardingStatus > should return incomplete status for user who has not completed onboarding [0.40ms]
(pass) OnboardingService > getOnboardingStatus > should throw NotFoundException if user does not exist [0.45ms]

src/auth/rate-limiting.bug.spec.ts:
35 |         }
36 |       }
37 | 
38 |       // BUG: No tracking of failed attempts!
39 |       // Should call incrementFailedAttempts on each failure
40 |       expect(mockLoginService.incrementFailedAttempts).toHaveBeenCalledTimes(5);
                                                            ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 5
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/rate-limiting.bug.spec.ts:40:56)
(fail) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should block IP after 5 failed login attempts [0.28ms]
(pass) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should track failed attempts per IP, not per email
(pass) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should reset counter after successful login
(pass) Rate Limiting - BUG DETECTION > BUG-032: Password Reset Email Bombing > should limit password reset requests per email [0.07ms]
(pass) Rate Limiting - BUG DETECTION > BUG-032: Password Reset Email Bombing > should not reveal if email exists [0.01ms]
(pass) Rate Limiting - BUG DETECTION > BUG-049: Verification Email Rate Limit > should limit verification emails per IP [0.01ms]
(pass) Rate Limiting - BUG DETECTION > BUG-049: Verification Email Rate Limit > should limit total emails sent per timeframe

src/auth/auth.service.spec.ts:
(pass) AuthService (Facade) > signup > should return auth response with token and user on successful signup [0.89ms]
(pass) AuthService (Facade) > login > should return auth response with token on successful login [0.56ms]
(pass) AuthService (Facade) > validateUser > should return user without password when credentials are valid [0.57ms]
(pass) AuthService (Facade) > refreshToken > should return new token on successful refresh [0.55ms]
(pass) AuthService (Facade) > refreshTokenWithToken > should return new token when given valid refresh token [0.57ms]
(pass) AuthService (Facade) > getCurrentUser > should return current user data [0.71ms]
(pass) AuthService (Facade) > requestEmailVerification > should return success when verification email is sent [0.75ms]
(pass) AuthService (Facade) > verifyEmail > should return success when email is verified [0.52ms]
(pass) AuthService (Facade) > forgotPassword > should return success when reset email is sent [0.40ms]
(pass) AuthService (Facade) > resetPassword > should return success when password is reset [0.50ms]
(pass) AuthService (Facade) > changePassword > should return success when password is changed [0.60ms]
(pass) AuthService (Facade) > changeEmail > should return success when email is changed [0.43ms]
(pass) AuthService (Facade) > deleteAccount > should return success when account is deleted [0.46ms]

src/dsl/dsl-compiler.service.spec.ts:
(pass) DslCompilerService > should be defined [0.83ms]
(pass) DslCompilerService > compileForHtml > should compile valid DSL to AST [1.42ms]
(pass) DslCompilerService > compileForHtml > should resolve page dimensions for A4 [0.70ms]
(pass) DslCompilerService > compileForHtml > should create two columns for two-column layout [0.54ms]
(pass) DslCompilerService > compileForHtml > should place sections in correct columns [0.47ms]
(pass) DslCompilerService > compileForHtml > should resolve typography tokens to concrete values [0.55ms]
(pass) DslCompilerService > compileForHtml > should resolve spacing tokens with density factor [0.47ms]
(pass) DslCompilerService > compileForHtml > should filter out hidden sections [0.80ms]
(pass) DslCompilerService > compileForHtml > should sort sections by order [0.67ms]
(pass) DslCompilerService > single-column layout > should create single column [0.57ms]
(pass) DslCompilerService > compact density > should apply density factor to spacing [0.52ms]
(pass) DslCompilerService > heading styles > should resolve underline heading style [1.04ms]
(pass) DslCompilerService > heading styles > should resolve uppercase heading style [0.57ms]

src/dsl/dsl.repository.spec.ts:
(pass) DslRepository > preview > should compile DSL for preview [0.88ms]
(pass) DslRepository > validate > should validate DSL [0.41ms]
(pass) DslRepository > render > should render resume AST [0.64ms]
(pass) DslRepository > render > should throw if resume not found [0.50ms]
(pass) DslRepository > renderPublic > should render public resume AST [0.48ms]
(pass) DslRepository > renderPublic > should throw if public resume not found [0.38ms]
(pass) DslRepository > mergeDsl > should deep merge DSL objects [0.41ms]

src/dsl/dsl-compiler.service.bug.spec.ts:
82 | 
83 |       // BUG: No migration happens!
84 |       // Old DSL should be automatically migrated to current version
85 |       const result = service.compile(oldDsl as any);
86 | 
87 |       expect(result.meta.version).toBe('2.0'); // Should be migrated
                                       ^
error: expect(received).toBe(expected)

Expected: "2.0"
Received: "1.0"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/dsl/dsl-compiler.service.bug.spec.ts:87:35)
(fail) DslCompilerService - BUG DETECTION > BUG-017: Version Migration Not Implemented > should migrate DSL from v1 to v2 [1.33ms]
(pass) DslCompilerService - BUG DETECTION > BUG-017: Version Migration Not Implemented > should handle version "1.0" documents [0.57ms]
(pass) DslCompilerService - BUG DETECTION > BUG-047: No Input Size Limit > should reject excessively large DSL [0.76ms]
(pass) DslCompilerService - BUG DETECTION > BUG-047: No Input Size Limit > should limit number of sections [0.50ms]
(pass) DslCompilerService - BUG DETECTION > DSL Compilation Security > should not allow script injection in tokens [0.39ms]

src/dsl/dsl-compiler-data.spec.ts:
(pass) DslCompilerService - Data Mapping > should compile section data correctly [1.17ms]
(pass) DslCompilerService - Data Mapping > should use placeholder data when resume is not provided [0.64ms]

src/health/health.controller.spec.ts:
(pass) HealthController > check (all services) > should check all health indicators [1.00ms]
(pass) HealthController > check (all services) > should invoke all health indicators when called [0.55ms]
(pass) HealthController > checkDatabase > should check only database health [0.41ms]
(pass) HealthController > checkDatabase > should invoke database health indicator when called [0.41ms]
(pass) HealthController > checkRedis > should check only redis health [0.36ms]
(pass) HealthController > checkRedis > should invoke redis health indicator when called [0.38ms]
(pass) HealthController > checkStorage > should check only storage health [0.33ms]
(pass) HealthController > checkStorage > should invoke storage health indicator when called [0.36ms]
(pass) HealthController > checkTranslate > should check only translate service health [0.35ms]
(pass) HealthController > checkTranslate > should invoke translate health indicator when called [0.37ms]
(pass) HealthController > error handling > should handle health check failures for all services [0.34ms]
(pass) HealthController > error handling > should handle database health check failure [0.31ms]

src/translation/translation.service.spec.ts:
(pass) TranslationService > onModuleInit > should check service health on initialization [0.63ms]
(pass) TranslationService > checkServiceHealth > should delegate health check to core service [0.33ms]
(pass) TranslationService > checkServiceHealth > should return false when service is unavailable [0.27ms]
(pass) TranslationService > translatePtToEn > should translate Portuguese text to English [0.31ms]
(pass) TranslationService > translateEnToPt > should translate English text to Portuguese [0.30ms]
(pass) TranslationService > translate > should translate text with Portuguese to English [0.31ms]
(pass) TranslationService > translate > should handle English to Portuguese translation [0.33ms]
(pass) TranslationService > translateBatch > should translate multiple texts at once [0.45ms]
(pass) TranslationService > translateBatch > should handle empty batch gracefully [0.52ms]
(pass) TranslationService > translateResumeToEnglish > should translate resume data to English [1.22ms]
(pass) TranslationService > translateResumeToEnglish > should handle complex resume structure [1.57ms]
(pass) TranslationService > translateResumeToPortuguese > should translate resume data to Portuguese [1.18ms]
(pass) TranslationService > isAvailable > should return true when service is available [0.85ms]
(pass) TranslationService > isAvailable > should return false when service is unavailable [0.62ms]
(pass) TranslationService > service availability delegation > should consistently reflect core service availability state [0.72ms]

src/common/email/email.service.spec.ts:
(pass) EmailService (Adapter) > sendEmail > should complete successfully when sending raw email [0.77ms]
(pass) EmailService (Adapter) > sendEmail > should propagate error when sending fails [0.50ms]
(pass) EmailService (Adapter) > sendVerificationEmail > should complete successfully when sending verification email [0.35ms]
(pass) EmailService (Adapter) > sendVerificationEmail > should propagate error when sending fails [0.28ms]
(pass) EmailService (Adapter) > sendPasswordResetEmail > should complete successfully when sending password reset email [0.30ms]
(pass) EmailService (Adapter) > sendPasswordResetEmail > should propagate error when sending fails [0.27ms]
(pass) EmailService (Adapter) > sendWelcomeEmail > should complete successfully when sending welcome email [0.29ms]
(pass) EmailService (Adapter) > sendWelcomeEmail > should propagate error when sending fails [0.26ms]
(pass) EmailService (Adapter) > sendPasswordChangedEmail > should complete successfully when sending password changed email [0.26ms]
(pass) EmailService (Adapter) > sendPasswordChangedEmail > should propagate error when sending fails [0.25ms]

src/common/audit/audit-log.service.spec.ts:
(pass) AuditLogService > log > should create audit log entry [0.75ms]
(pass) AuditLogService > log > should extract request metadata when provided [0.40ms]
(pass) AuditLogService > log > should not throw on prisma errors [0.42ms]
(pass) AuditLogService > logUsernameChange > should log username change with before/after [0.46ms]
(pass) AuditLogService > logResumeDeletion > should log resume deletion with data snapshot [0.52ms]
(pass) AuditLogService > logVisibilityChange > should log visibility change [0.62ms]
(pass) AuditLogService > logUnauthorizedAccess > should log unauthorized access attempt [0.47ms]
(pass) AuditLogService > getUserLogs > should return logs for specific user [0.55ms]
(pass) AuditLogService > cleanupOldLogs > should delete old logs and return count [0.45ms]

src/common/cache/cache.service.spec.ts:
(pass) CacheService (Adapter) > when Redis is enabled > should report enabled status [0.96ms]
(pass) CacheService (Adapter) > when Redis is enabled > get/set operations > should return null for non-existent key [0.47ms]
(pass) CacheService (Adapter) > when Redis is enabled > get/set operations > should return stored value after set [0.42ms]
(pass) CacheService (Adapter) > when Redis is enabled > get/set operations > should return null after delete [0.48ms]
(pass) CacheService (Adapter) > when Redis is enabled > deletePattern > should delete all keys matching pattern [0.44ms]
(pass) CacheService (Adapter) > when Redis is enabled > flush > should clear all cached data [0.41ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should acquire lock when not locked [0.33ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should fail to acquire lock when already locked [0.35ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should allow acquire after release [0.30ms]
(pass) CacheService (Adapter) > when Redis is enabled > lock operations > should report correct lock status [0.33ms]
(pass) CacheService (Adapter) > when Redis is enabled > getOrSet (cache-aside pattern) > should compute and cache value on cache miss [0.39ms]
(pass) CacheService (Adapter) > when Redis is enabled > getOrSet (cache-aside pattern) > should return cached value without computing on cache hit [0.29ms]
(pass) CacheService (Adapter) > when Redis is enabled > onModuleDestroy > should complete cleanup without error [0.29ms]
(pass) CacheService (Adapter) > when Redis is disabled > should report disabled status [0.54ms]
(pass) CacheService (Adapter) > when Redis is disabled > should return null for get operations [0.43ms]

src/common/cache/cache-lock.service.bug.spec.ts:
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:63:36)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:58:66)
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should NOT silently return true when Redis is disabled [1.26ms]
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:76:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:71:59)
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should log warning when operating without Redis [0.37ms]
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:87:36)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:82:52)
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should fail-safe for critical operations [0.33ms]
(pass) CacheLockService - BUG DETECTION > Lock Acquisition Behavior > should properly acquire lock when Redis is available [0.33ms]
(pass) CacheLockService - BUG DETECTION > Lock Acquisition Behavior > should return false when lock already held [0.26ms]
(pass) CacheLockService - BUG DETECTION > Lock Acquisition Behavior > should handle Redis errors gracefully [0.34ms]
53 |       this.logger.error(
54 |         `Attempted to acquire lock without Redis: ${key}`,
55 |         undefined,
56 |         'CacheLockService',
57 |       );
58 |       throw new ServiceUnavailableException(
                 ^
ServiceUnavailableException: Distributed locking is unavailable. Critical operations cannot proceed.
 response: {
  message: "Distributed locking is unavailable. Critical operations cannot proceed.",
  error: "Service Unavailable",
  statusCode: 503,
},
   status: 503,
  options: {},

      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:58:13)
      at acquireLock (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.ts:38:5)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:146:37)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-lock.service.bug.spec.ts:141:64)
(fail) CacheLockService - BUG DETECTION > Alternative: In-Memory Fallback > should use in-memory fallback when Redis unavailable [0.42ms]

src/common/cache/cache-redis.bug.spec.ts:
64 | 
65 |       // BUG: Error might be silently swallowed!
66 |       const result = await cacheService.set('key', 'value');
67 | 
68 |       // Should indicate failure somehow
69 |       expect(result).toBe(false); // Or throw
                          ^
error: expect(received).toBe(expected)

Expected: false
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-redis.bug.spec.ts:69:22)
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should report when cache set fails [1.35ms]
75 |         .mockResolvedValueOnce('OK');
76 | 
77 |       await cacheService.set('key', 'value');
78 | 
79 |       // Should have retried
80 |       expect(mockRedis.client.set).toHaveBeenCalledTimes(2);
                                        ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 2
Received number of calls: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/cache/cache-redis.bug.spec.ts:80:36)
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should retry on transient failures [0.53ms]
(pass) Redis Cache - BUG DETECTION > BUG-050: Lock Not Released on Error > should release lock in finally block [0.46ms]
(pass) Redis Cache - BUG DETECTION > BUG-050: Lock Not Released on Error > should have auto-release mechanism for stuck locks [0.35ms]
(pass) Redis Cache - BUG DETECTION > BUG-050: Lock Not Released on Error > should provide withLock helper for safe usage [0.27ms]

src/common/pipes/parse-cuid.pipe.bug.spec.ts:
(pass) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should REJECT invalid CUID format [0.21ms]
46 |     it('should ACCEPT valid CUID format', () => {
47 |       // Valid CUIDs: start with 'c', 25 chars, lowercase alphanumeric
48 |       const validCuids = ['clh1234567890abcdefghij', 'cm3e7xyzabcdefghij12345'];
49 | 
50 |       for (const validId of validCuids) {
51 |         expect(() => pipe.transform(validId)).not.toThrow();
                                                       ^
error: expect(received).not.toThrow()

Error name: "BadRequestException"
Error message: "Invalid ID format. Expected CUID format (e.g., 'clx1abc2def3ghi4jkl5mno6p')"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/pipes/parse-cuid.pipe.bug.spec.ts:51:51)
(fail) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should ACCEPT valid CUID format [0.16ms]
(pass) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should throw on SQL injection attempts [0.05ms]
(pass) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should throw on path traversal attempts [0.02ms]
24 |     // BUG-036 FIX: Reject invalid CUID format immediately
25 |     // This prevents invalid IDs from reaching the database layer
26 |     if (!this.cuidRegex.test(value)) {
27 |       throw new BadRequestException(
28 |         `Invalid ID format. Expected CUID format (e.g., 'clx1abc2def3ghi4jkl5mno6p')`,
29 |       );
           ^
BadRequestException: Invalid ID format. Expected CUID format (e.g., 'clx1abc2def3ghi4jkl5mno6p')
      at transform (/home/ilelo/Documents/Projects/profile/profile-services/src/common/pipes/parse-cuid.pipe.ts:29:7)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/common/pipes/parse-cuid.pipe.bug.spec.ts:77:27)
(fail) ParseCuidPipe - BUG DETECTION > Current Buggy Behavior (documenting) > currently allows invalid IDs through (THIS IS A BUG) [0.04ms]

src/common/logger/logger.service.spec.ts:
(pass) AppLoggerService > log > should log info message without throwing [4.18ms]
(pass) AppLoggerService > log > should log with context [0.30ms]
(pass) AppLoggerService > log > should log with metadata [0.20ms]
2026-01-07 19:05:12 [Application] [31merror[39m: Error message
(pass) AppLoggerService > error > should log error message without throwing [0.53ms]
2026-01-07 19:05:12 [ErrorContext] [31merror[39m: Error message
Stack trace here
(pass) AppLoggerService > error > should log error with stack trace [0.29ms]
2026-01-07 19:05:12 [Context] [31merror[39m: Error message {"code":"E001"}
Stack
(pass) AppLoggerService > error > should log error with metadata [0.24ms]
(pass) AppLoggerService > warn > should log warning message without throwing [0.27ms]
(pass) AppLoggerService > warn > should log warning with context and metadata [0.18ms]
(pass) AppLoggerService > debug > should log debug message without throwing [0.19ms]
(pass) AppLoggerService > debug > should log debug with context and metadata [0.31ms]
(pass) AppLoggerService > verbose > should log verbose message without throwing [0.25ms]
(pass) AppLoggerService > verbose > should use default context when set [0.18ms]
(pass) AppLoggerService > setContext > should set context for subsequent logs [0.46ms]
2026-01-07 19:05:12 [ErrorService] [31merror[39m: Error occurred {"errorCode":"E500"}
(pass) AppLoggerService > errorWithMeta > should log error with metadata using default context [0.41ms]

src/common/guards/roles.guard.spec.ts:
(pass) RolesGuard > canActivate > should allow access when no roles are required [0.81ms]
(pass) RolesGuard > canActivate > should allow access when user has required role [0.42ms]
(pass) RolesGuard > canActivate > should deny access when user does not have required role [0.30ms]
(pass) RolesGuard > canActivate > should deny access when user is not authenticated [0.24ms]
(pass) RolesGuard > canActivate > should allow access when user has one of multiple allowed roles [0.25ms]
(pass) RolesGuard > canActivate > should deny access when user role is not in allowed roles list [0.23ms]
(pass) RolesGuard > canActivate > should check roles from handler metadata [0.26ms]
(pass) RolesGuard > canActivate > should allow any authenticated user when roles array is empty [0.22ms]
(pass) RolesGuard > canActivate > should handle null user in request [0.25ms]
(pass) RolesGuard > role hierarchy > should not implicitly grant higher privileges to admins [0.23ms]
(pass) RolesGuard > role hierarchy > should require exact role match [0.20ms]

src/resumes/services/experience.service.bug-detection.spec.ts:
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should REJECT isCurrent=true with endDate set [0.75ms]
 97 |         isCurrent: false,
 98 |       };
 99 | 
100 |       await expect(
101 |         service.addToResume('resume-123', 'user-123', invalidDto as any),
102 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:102:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:90:71)
(fail) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should REJECT isCurrent=false with endDate=null (ambiguous) [0.54ms]
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should ACCEPT isCurrent=true with endDate=null [0.28ms]
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should ACCEPT isCurrent=false with valid endDate [0.29ms]
(pass) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should include "isCurrent" or "endDate" in error message [0.40ms]
(pass) ExperienceService - Bug Detection > Date range validation > should REJECT endDate before startDate [0.34ms]
(pass) ExperienceService - Bug Detection > Date range validation > should REJECT same startDate and endDate [0.29ms]
217 |         order: 0, // Duplicate order!
218 |       };
219 | 
220 |       await expect(
221 |         service.addToResume('resume-123', 'user-123', duplicateOrderDto as any),
222 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:222:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/experience.service.bug-detection.spec.ts:203:66)
(fail) ExperienceService - Bug Detection > Order uniqueness validation > should REJECT creating experience with duplicate order [0.38ms]
(pass) ExperienceService - Bug Detection > Order uniqueness validation > should ACCEPT experience with unique order [0.36ms]

src/resumes/services/project.service.spec.ts:
(pass) ProjectService > listForResume > should return paginated projects for resume [1.08ms]
(pass) ProjectService > getById > should return single project [0.44ms]
(pass) ProjectService > getById > should throw NotFoundException when project not found [0.36ms]
(pass) ProjectService > addToResume > should create new project [0.38ms]
(pass) ProjectService > updateById > should update existing project [0.38ms]
(pass) ProjectService > updateById > should throw NotFoundException when project not found [0.32ms]
(pass) ProjectService > deleteById > should delete project successfully [0.36ms]
(pass) ProjectService > deleteById > should throw NotFoundException when project not found [0.34ms]

src/resumes/services/bug-bounty.service.spec.ts:
(pass) BugBountyService > should be defined [0.54ms]
(pass) BugBountyService > should have correct entity name [0.26ms]
(pass) BugBountyService > should have a logger instance [0.20ms]
(pass) BugBountyService > CRUD operations > should list bug bounties for resume [0.33ms]
(pass) BugBountyService > CRUD operations > should add bug bounty to resume [0.29ms]
(pass) BugBountyService > CRUD operations > should delete bug bounty [0.26ms]

src/resumes/services/education.service.bug.spec.ts:
(pass) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REJECT isCurrent=true with endDate set [0.89ms]
(pass) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REJECT endDate before startDate [0.45ms]
118 |       };
119 | 
120 |       // BUG: Currently this might be ACCEPTED!
121 |       await expect(
122 |         service.addToResume('resume-123', 'user-123', invalidDto as any),
123 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/education.service.bug.spec.ts:123:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/education.service.bug.spec.ts:110:55)
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REQUIRE endDate when isCurrent=false [0.47ms]
144 |       };
145 | 
146 |       // BUG: Currently this is ACCEPTED!
147 |       await expect(
148 |         service.addToResume('resume-123', 'user-123', duplicateOrderDto as any),
149 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/education.service.bug.spec.ts:149:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/education.service.bug.spec.ts:132:48)
(fail) EducationService - BUG DETECTION > BUG-052: Order Not Validated > should REJECT duplicate order values [0.51ms]

src/resumes/services/certification.service.spec.ts:
(pass) CertificationService > should be defined [0.83ms]
(pass) CertificationService > should have correct entity name [0.55ms]
(pass) CertificationService > should have a logger instance [0.24ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should list certifications for resume [0.34ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should get certification by id [0.33ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should add certification to resume [0.33ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should update certification [0.28ms]
(pass) CertificationService > CRUD operations (inherited from BaseSubResourceService) > should delete certification [0.29ms]

src/resumes/services/talk.service.spec.ts:
(pass) TalkService > should be defined [0.60ms]
(pass) TalkService > should have correct entity name [0.26ms]
(pass) TalkService > should have a logger instance [0.22ms]
(pass) TalkService > CRUD operations > should list talks for resume [0.29ms]
(pass) TalkService > CRUD operations > should add talk to resume [0.29ms]
(pass) TalkService > CRUD operations > should delete talk [0.27ms]

src/resumes/services/language.service.spec.ts:
(pass) LanguageService > should be defined [0.58ms]
(pass) LanguageService > should have correct entity name [0.31ms]
(pass) LanguageService > should have a logger instance [0.24ms]
(pass) LanguageService > CRUD operations (inherited from BaseSubResourceService) > should list languages for resume [0.33ms]
(pass) LanguageService > CRUD operations (inherited from BaseSubResourceService) > should add language to resume [0.41ms]
(pass) LanguageService > CRUD operations (inherited from BaseSubResourceService) > should delete language [0.32ms]

src/resumes/services/xss-sanitization.bug.spec.ts:
80 |           summary: payload,
81 |         } as any);
82 | 
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
                                                             ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:85:57)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 1 in summary [0.82ms]
81 |         } as any);
82 | 
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
86 |         expect(capturedDto.summary.includes('onerror=')).toBe(false);
                                                              ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:86:58)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 2 in summary [0.40ms]
82 | 
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
86 |         expect(capturedDto.summary.includes('onerror=')).toBe(false);
87 |         expect(capturedDto.summary.includes('onload=')).toBe(false);
                                                             ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:87:57)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 3 in summary [0.27ms]
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
86 |         expect(capturedDto.summary.includes('onerror=')).toBe(false);
87 |         expect(capturedDto.summary.includes('onload=')).toBe(false);
88 |         expect(capturedDto.summary.includes('javascript:')).toBe(false);
                                                                 ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:88:61)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 4 in summary [0.24ms]
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
86 |         expect(capturedDto.summary.includes('onerror=')).toBe(false);
87 |         expect(capturedDto.summary.includes('onload=')).toBe(false);
88 |         expect(capturedDto.summary.includes('javascript:')).toBe(false);
                                                                 ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:88:61)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 5 in summary [0.22ms]
82 | 
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
86 |         expect(capturedDto.summary.includes('onerror=')).toBe(false);
87 |         expect(capturedDto.summary.includes('onload=')).toBe(false);
                                                             ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:87:57)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 6 in summary [0.25ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 7 in summary [0.25ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 8 in summary [0.25ms]
80 |           summary: payload,
81 |         } as any);
82 | 
83 |         // BUG: XSS payload stored as-is!
84 |         // Should be sanitized or escaped
85 |         expect(capturedDto.summary.includes('<script')).toBe(false);
                                                             ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/xss-sanitization.bug.spec.ts:85:57)
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 9 in summary [0.22ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 10 in summary [0.20ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize HTML in experience description [0.21ms]
(pass) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize HTML in project description [0.19ms]
(pass) XSS Sanitization - BUG DETECTION > URL Validation > should reject javascript: URLs in project links [0.16ms]
(pass) XSS Sanitization - BUG DETECTION > URL Validation > should reject data: URLs in image fields [0.18ms]

src/resumes/services/hackathon.service.spec.ts:
(pass) HackathonService > should be defined [0.51ms]
(pass) HackathonService > should have correct entity name [0.27ms]
(pass) HackathonService > should have a logger instance [0.22ms]
(pass) HackathonService > CRUD operations > should list hackathons for resume [0.29ms]
(pass) HackathonService > CRUD operations > should add hackathon to resume [0.27ms]
(pass) HackathonService > CRUD operations > should delete hackathon [0.25ms]

src/resumes/services/recommendation.service.spec.ts:
(pass) RecommendationService > should be defined [0.46ms]
(pass) RecommendationService > should have correct entity name [0.26ms]
(pass) RecommendationService > should have a logger instance [0.23ms]
(pass) RecommendationService > CRUD operations > should list recommendations for resume [0.32ms]
(pass) RecommendationService > CRUD operations > should add recommendation to resume [0.30ms]
(pass) RecommendationService > CRUD operations > should delete recommendation [0.26ms]

src/resumes/services/education.service.spec.ts:
(pass) EducationService > listForResume > should return paginated education entries [0.98ms]
(pass) EducationService > getById > should return single education entry [0.58ms]
(pass) EducationService > getById > should throw NotFoundException when not found [0.39ms]
(pass) EducationService > addToResume > should create new education entry [0.33ms]
(pass) EducationService > updateById > should update existing education entry [0.36ms]
(pass) EducationService > deleteById > should delete education entry successfully [0.31ms]
(pass) EducationService > reorder > should reorder education entries with custom message [0.34ms]

src/resumes/services/experience.service.spec.ts:
(pass) ExperienceService > listForResume > should return paginated experiences [0.56ms]
(pass) ExperienceService > getById > should return single experience [0.31ms]
(pass) ExperienceService > getById > should throw NotFoundException when not found [0.28ms]
(pass) ExperienceService > addToResume > should create new experience [0.29ms]
(pass) ExperienceService > updateById > should update existing experience [0.32ms]
(pass) ExperienceService > updateById > should throw NotFoundException when not found [0.27ms]
(pass) ExperienceService > deleteById > should delete experience successfully [0.26ms]
(pass) ExperienceService > deleteById > should throw NotFoundException when not found [0.24ms]

src/resumes/services/interest.service.spec.ts:
(pass) InterestService > should be defined [0.47ms]
(pass) InterestService > should have correct entity name [0.25ms]
(pass) InterestService > should have a logger instance [0.20ms]
(pass) InterestService > CRUD operations > should list interests for resume [0.27ms]
(pass) InterestService > CRUD operations > should add interest to resume [0.28ms]
(pass) InterestService > CRUD operations > should delete interest [0.26ms]

src/resumes/services/publication.service.spec.ts:
(pass) PublicationService > listForResume > should return paginated publications [0.67ms]
(pass) PublicationService > getById > should return single publication [0.36ms]
(pass) PublicationService > getById > should throw NotFoundException when not found [0.32ms]
(pass) PublicationService > addToResume > should create new publication [0.34ms]
(pass) PublicationService > updateById > should update existing publication [0.32ms]
(pass) PublicationService > deleteById > should delete publication successfully [0.31ms]

src/resumes/services/open-source.service.spec.ts:
(pass) OpenSourceService > should be defined [0.78ms]
(pass) OpenSourceService > should have correct entity name [0.36ms]
(pass) OpenSourceService > should have a logger instance [0.24ms]
(pass) OpenSourceService > CRUD operations > should list open source contributions for resume [0.34ms]
(pass) OpenSourceService > CRUD operations > should add open source contribution to resume [0.31ms]
(pass) OpenSourceService > CRUD operations > should delete open source contribution [0.26ms]

src/resumes/services/achievement.service.spec.ts:
(pass) AchievementService > findAll > should return paginated achievements for valid resume [0.55ms]
86 |       mockResumesRepository.findOne.mockResolvedValue(null);
87 | 
88 |       await expect(async () => await service.listForResume(resumeId, userId)).toThrow(
89 |         ForbiddenException,
90 |       );
91 |       expect(mockAchievementRepository.findAll.mock.calls.length).toBe(0);
                                                                       ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/achievement.service.spec.ts:91:67)
(fail) AchievementService > findAll > should throw ForbiddenException if resume not found [0.46ms]
(pass) AchievementService > findAll > should accept custom page and limit [0.26ms]
(pass) AchievementService > findOne > should return achievement for valid resume and id [0.26ms]
(pass) AchievementService > findOne > should throw NotFoundException if achievement not found [0.26ms]
166 |       mockResumesRepository.findOne.mockResolvedValue(null);
167 | 
168 |       await expect(
169 |         service.getById(resumeId, achievementId, userId),
170 |       ).rejects.toThrow(ForbiddenException);
171 |       expect(mockAchievementRepository.findOne.mock.calls.length).toBe(0);
                                                                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/achievement.service.spec.ts:171:67)
(fail) AchievementService > findOne > should throw ForbiddenException if resume not owned by user [0.36ms]
(pass) AchievementService > create > should create achievement for valid resume [0.29ms]
220 |       mockResumesRepository.findOne.mockResolvedValue(null);
221 | 
222 |       await expect(
223 |         service.addToResume(resumeId, userId, createDto),
224 |       ).rejects.toThrow(ForbiddenException);
225 |       expect(mockAchievementRepository.create.mock.calls.length).toBe(0);
                                                                       ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/achievement.service.spec.ts:225:66)
(fail) AchievementService > create > should throw ForbiddenException if resume not owned by user [0.30ms]
(pass) AchievementService > update > should update achievement for valid resume and id [0.27ms]
(pass) AchievementService > update > should throw NotFoundException if achievement not found [0.29ms]
(pass) AchievementService > remove > should delete achievement for valid resume and id [0.26ms]
(pass) AchievementService > remove > should throw NotFoundException if achievement not found [0.27ms]
(pass) AchievementService > reorder > should reorder achievements for valid resume [0.30ms]
349 |       mockResumesRepository.findOne.mockResolvedValue(null);
350 | 
351 |       await expect(
352 |         service.reorderInResume(resumeId, userId, ids),
353 |       ).rejects.toThrow(ForbiddenException);
354 |       expect(mockAchievementRepository.reorder.mock.calls.length).toBe(0);
                                                                        ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/achievement.service.spec.ts:354:67)
(fail) AchievementService > reorder > should throw ForbiddenException if resume not owned by user [0.30ms]

src/resumes/services/limits.bug.spec.ts:
(pass) Resource Limits - BUG DETECTION > BUG-061: No Skills Limit > should limit skills per resume [1.49ms]
(pass) Resource Limits - BUG DETECTION > BUG-062: No Experiences Limit > should limit experiences per resume [0.28ms]
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit education entries
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit projects
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit certifications
(pass) Resource Limits - BUG DETECTION > Other Missing Limits > should limit total resume size

src/export/services/resume-docx.service.spec.ts:
(pass) ResumeDOCXService > generate > should generate DOCX for complete resume [0.59ms]
(pass) ResumeDOCXService > generate > should throw NotFoundException when user not found [0.39ms]
(pass) ResumeDOCXService > generate > should throw NotFoundException when resume not found [0.33ms]
(pass) ResumeDOCXService > generate > should handle errors from builder service [0.27ms]

src/export/services/resume-pdf.service.spec.ts:
(pass) ResumePDFService > generate > should generate PDF for valid resume with default options [0.69ms]
(pass) ResumePDFService > generate > should use custom palette parameter [0.36ms]
(pass) ResumePDFService > generate > should use custom language parameter [0.30ms]
(pass) ResumePDFService > generate > should include bannerColor when provided [0.29ms]
(pass) ResumePDFService > generate > should include userId when provided [0.32ms]
(pass) ResumePDFService > generate > should pass through all options to generator [0.30ms]
(pass) ResumePDFService > generate > should handle errors from generator [0.35ms]

src/export/services/docx-builder.service.spec.ts:
(pass) DocxBuilderService > generate > should return DOCX buffer [22.00ms]
(pass) DocxBuilderService > generate > should throw NotFoundException when user not found [0.84ms]
(pass) DocxBuilderService > generate > should throw NotFoundException when resume not found [0.50ms]
(pass) DocxBuilderService > generate > should use sections service to create document structure [8.40ms]
(pass) DocxBuilderService > generate > should apply document styles [6.65ms]

src/export/services/browser-manager.service.spec.ts:
(pass) BrowserManagerService > getBrowser > should launch browser on first call [0.75ms]
47 |     it('should reuse existing browser on subsequent calls', async () => {
48 |       await service.getBrowser();
49 |       await service.getBrowser();
50 |       await service.getBrowser();
51 | 
52 |       expect(puppeteer.launch).toHaveBeenCalledTimes(1);
                                    ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/browser-manager.service.spec.ts:52:32)
(fail) BrowserManagerService > getBrowser > should reuse existing browser on subsequent calls [0.43ms]
(pass) BrowserManagerService > getBrowser > should handle browser launch failure [0.34ms]
(pass) BrowserManagerService > closeBrowser > should close browser and clear reference [0.33ms]
(pass) BrowserManagerService > closeBrowser > should do nothing if browser not initialized [0.27ms]
82 |     it('should allow launching new browser after close', async () => {
83 |       await service.getBrowser();
84 |       await service.closeBrowser();
85 |       await service.getBrowser();
86 | 
87 |       expect(puppeteer.launch).toHaveBeenCalledTimes(2);
                                    ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 2
Received number of calls: 6

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/browser-manager.service.spec.ts:87:32)
(fail) BrowserManagerService > closeBrowser > should allow launching new browser after close [0.30ms]
(pass) BrowserManagerService > isActive > should return false when browser not initialized [0.25ms]
(pass) BrowserManagerService > isActive > should return true when browser is active [0.24ms]
(pass) BrowserManagerService > isActive > should return false after browser is closed [0.27ms]
(pass) BrowserManagerService > concurrent access > should handle concurrent getBrowser calls safely [0.31ms]

src/export/services/banner-capture.service.spec.ts:

# Unhandled error between tests
-------------------------------
23 | 
24 |   // Silence Nest logger during tests to reduce noise
25 |   const originalConsoleError = console.error;
26 |   const originalConsoleWarn = console.warn;
27 | 
28 |   beforeAll(() => {
       ^
ReferenceError: beforeAll is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/banner-capture.service.spec.ts:28:3)
-------------------------------


src/export/services/pdf-generator.service.spec.ts:
(pass) PdfGeneratorService > generate > should return PDF buffer [0.95ms]
(pass) PdfGeneratorService > generate > should setup page before navigation [0.65ms]
(pass) PdfGeneratorService > generate > should wait for resume to be ready [0.41ms]
(pass) PdfGeneratorService > generate > should extract and apply styles [0.38ms]
(pass) PdfGeneratorService > generate > should close page after generation [0.32ms]
(pass) PdfGeneratorService > generate > should close page even on error [0.40ms]
(pass) PdfGeneratorService > generate > should pass options to URL builder [0.40ms]

src/export/services/pdf-generator.service.bug.spec.ts:
38 |     };
39 | 
40 |     mockTemplateService = {
41 |       getPageSetup: mock().mockReturnValue({
42 |         setupPage: mock(),
43 |         buildResumeUrl: jest
                             ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/pdf-generator.service.bug.spec.ts:43:25)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/pdf-generator.service.bug.spec.ts:22:14)
(fail) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should have timeout on page operations [0.24ms]
38 |     };
39 | 
40 |     mockTemplateService = {
41 |       getPageSetup: mock().mockReturnValue({
42 |         setupPage: mock(),
43 |         buildResumeUrl: jest
                             ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/pdf-generator.service.bug.spec.ts:43:25)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/pdf-generator.service.bug.spec.ts:22:14)
(fail) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should cleanup page even on timeout [0.03ms]
38 |     };
39 | 
40 |     mockTemplateService = {
41 |       getPageSetup: mock().mockReturnValue({
42 |         setupPage: mock(),
43 |         buildResumeUrl: jest
                             ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/pdf-generator.service.bug.spec.ts:43:25)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/export/services/pdf-generator.service.bug.spec.ts:22:14)
(fail) PdfGeneratorService - BUG DETECTION > BUG: Resource Exhaustion > should limit concurrent PDF generations [0.01ms]

src/admin/services/skill-admin.service.bug.spec.ts:
18 |   let mockPrisma: any;
19 | 
20 |   beforeEach(async () => {
21 |     mockPrisma = {
22 |       resume: {
23 |         findUnique: jest
                         ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:23:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:20:14)
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should use transaction for order assignment [0.13ms]
18 |   let mockPrisma: any;
19 | 
20 |   beforeEach(async () => {
21 |     mockPrisma = {
22 |       resume: {
23 |         findUnique: jest
                         ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:23:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:20:14)
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should handle concurrent skill additions without duplicate orders [0.02ms]
18 |   let mockPrisma: any;
19 | 
20 |   beforeEach(async () => {
21 |     mockPrisma = {
22 |       resume: {
23 |         findUnique: jest
                         ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:23:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:20:14)
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when adding skill [0.01ms]
18 |   let mockPrisma: any;
19 | 
20 |   beforeEach(async () => {
21 |     mockPrisma = {
22 |       resume: {
23 |         findUnique: jest
                         ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:23:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:20:14)
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when deleting skill [0.01ms]
18 |   let mockPrisma: any;
19 | 
20 |   beforeEach(async () => {
21 |     mockPrisma = {
22 |       resume: {
23 |         findUnique: jest
                         ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:23:21)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/skill-admin.service.bug.spec.ts:20:14)
(fail) SkillAdminService - BUG DETECTION > BUG-044: No Authorization Check on Delete > should check admin authorization before delete

src/admin/services/user-admin-mutation.service.spec.ts:
(pass) UserAdminMutationService > create > should create user successfully [0.75ms]
(pass) UserAdminMutationService > create > should hash password before saving [0.35ms]
92 |         service.create({
93 |           email: 'user@example.com',
94 |           password: 'Password123!',
95 |           name: 'New User',
96 |         }),
97 |       ).rejects.toThrow(ConflictException);
                     ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:97:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:88:60)
(fail) UserAdminMutationService > create > should throw ConflictException when email exists [0.38ms]
(pass) UserAdminMutationService > create > should use default role USER if not specified [0.31ms]
(pass) UserAdminMutationService > update > should update user successfully [0.51ms]
(pass) UserAdminMutationService > update > should throw NotFoundException when user not found [0.35ms]
144 |         .mockResolvedValueOnce(mockUser) // findUserOrThrow
145 |         .mockResolvedValueOnce({ id: 'other-user' }); // email check
146 | 
147 |       await expect(
148 |         service.update('user-1', { email: 'taken@example.com' }),
149 |       ).rejects.toThrow(ConflictException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:149:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.spec.ts:142:68)
(fail) UserAdminMutationService > update > should throw ConflictException when email already in use [0.34ms]
(pass) UserAdminMutationService > delete > should delete user successfully [0.40ms]
(pass) UserAdminMutationService > delete > should throw NotFoundException when user not found [0.41ms]
(pass) UserAdminMutationService > delete > should prevent deleting last admin [0.70ms]
(pass) UserAdminMutationService > delete > should allow deleting admin if more than one exists [0.50ms]
(pass) UserAdminMutationService > resetPassword > should reset password successfully [0.60ms]
(pass) UserAdminMutationService > resetPassword > should throw NotFoundException when user not found [0.59ms]

src/admin/services/admin-stats.service.spec.ts:
(pass) AdminStatsService > getStats > should return correct statistics [1.24ms]
(pass) AdminStatsService > getStats > should filter admins correctly [0.60ms]

src/admin/services/user-admin-query.service.spec.ts:
(pass) UserAdminQueryService > getAll > should return paginated users list [0.71ms]
(pass) UserAdminQueryService > getAll > should filter by search term [0.42ms]
(pass) UserAdminQueryService > getAll > should filter by role [0.33ms]
(pass) UserAdminQueryService > getAll > should calculate correct pagination [0.28ms]
(pass) UserAdminQueryService > getById > should return user without password [0.35ms]
(pass) UserAdminQueryService > getById > should include resumes and preferences [0.25ms]
(pass) UserAdminQueryService > getById > should throw NotFoundException when user not found [0.32ms]

src/admin/services/csrf.bug.spec.ts:
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should require CSRF token for DELETE user
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should require CSRF token for password change
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should require CSRF token for email change
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should validate CSRF token origin
(pass) CSRF Protection - BUG DETECTION > BUG-045: Missing CSRF Protection > should use SameSite=Strict for session cookies

src/admin/services/race-condition.spec.ts:
82 |       });
83 | 
84 |       await service.create(createDto);
85 | 
86 |       // BUG: The operation is NOT using a transaction!
87 |       expect(mockPrisma.$transaction).toHaveBeenCalled();
                                           ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:87:39)
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should use transaction to prevent race condition [1.15ms]
102 |         code: 'P2002', // Prisma unique constraint violation
103 |         meta: { target: ['email'] },
104 |       });
105 | 
106 |       // BUG: Should catch P2002 and throw ConflictException
107 |       await expect(async () => await service.create(createDto)).toThrow(
                                                                      ^
error: expect(received).toThrow(expected)

Expected constructor: ConflictException
Received constructor: Object

Received value: {
  code: "P2002",
  meta: {
    target: [ "email" ],
  },
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:107:65)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:90:64)
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should handle unique constraint violation gracefully [0.84ms]
(pass) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should NOT use separate check and create operations [0.70ms]
156 |         code: 'P2002',
157 |         meta: { target: ['email'] },
158 |       });
159 | 
160 |       // And convert P2002 to ConflictException
161 |       await expect(async () => await service.create(createDto)).toThrow(
                                                                      ^
error: expect(received).toThrow(expected)

Expected constructor: ConflictException
Received constructor: Object

Received value: {
  code: "P2002",
  meta: {
    target: [ "email" ],
  },
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:161:65)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:144:57)
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 1: Try create, catch unique violation [0.55ms]
170 |         return callback(mockPrisma);
171 |       });
172 | 
173 |       // The transaction should be called with SERIALIZABLE isolation
174 |       const calls = mockPrisma.$transaction.mock.calls;
175 |       expect(calls.length).toBeGreaterThan(0);
                                 ^
error: expect(received).toBeGreaterThan(expected)

Expected: > 0
Received: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:175:28)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/race-condition.spec.ts:166:62)
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 2: Transaction with serializable isolation [0.43ms]

src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should REJECT updating last admin role to USER [0.71ms]
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should REJECT updating last admin role to APPROVER [0.34ms]
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should ALLOW updating admin role if there are multiple admins [0.30ms]
(pass) UserAdminMutationService - Bug Detection > BUG: Last admin role removal via UPDATE > should include "last admin" in error message [0.37ms]
(pass) UserAdminMutationService - Bug Detection > Self-demotion protection > should REJECT last admin demoting themselves [0.32ms]
(pass) UserAdminMutationService - Bug Detection > Self-demotion protection > should REJECT last admin setting their role to null [0.29ms]
153 |       mockPrisma.auditLog = { create: mock() };
154 | 
155 |       await service.update('user-456', { role: UserRole.ADMIN });
156 | 
157 |       // Check that audit log was created
158 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /ROLE_CHANGE|PROMOTION|ADMIN_GRANTED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:158:42)
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when promoting user to admin [0.45ms]
175 |       });
176 |       mockPrisma.auditLog = { create: mock() };
177 | 
178 |       await service.update('admin-123', { role: UserRole.USER });
179 | 
180 |       expect(mockPrisma.auditLog.create).toHaveBeenCalled();
                                               ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:180:42)
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when demoting admin to user [0.34ms]
188 |     it('should REJECT weak passwords', async () => {
189 |       mockPrisma.user.findUnique.mockResolvedValue(regularUser);
190 | 
191 |       await expect(
192 |         service.resetPassword('user-456', { newPassword: '123' }), // Too weak
193 |       ).rejects.toThrow(BadRequestException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:193:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:188:40)
(fail) UserAdminMutationService - Bug Detection > Password reset > should REJECT weak passwords [0.31ms]
197 |       mockPrisma.user.findUnique.mockResolvedValue(regularUser);
198 |       mockPrisma.auditLog = { create: mock() };
199 | 
200 |       await service.resetPassword('user-456', { newPassword: 'StrongP@ss1!' });
201 | 
202 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /PASSWORD_RESET|ADMIN_RESET/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/admin/services/user-admin-mutation.service.bug-detection.spec.ts:202:42)
(fail) UserAdminMutationService - Bug Detection > Password reset > should create audit log for password reset [0.36ms]

src/mec-sync/parsers/entity.normalizer.spec.ts:
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should normalize a complete institution row [0.22ms]
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should uppercase UF [0.08ms]
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should handle missing optional fields [0.03ms]
(pass) Entity Normalizer > normalizeInstitution > Valid Input > should normalize text with extra whitespace [0.02ms]
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when CO_IES is not a number [0.01ms]
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when CO_IES is empty
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when NO_IES is empty
(pass) Entity Normalizer > normalizeInstitution > Invalid Input > should return null when SG_UF_IES is empty
(pass) Entity Normalizer > normalizeInstitution > Organization and Category Mapping > should map organization type [0.02ms]
(pass) Entity Normalizer > normalizeInstitution > Organization and Category Mapping > should map category type [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should normalize a complete course row [0.10ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should handle missing optional fields [0.03ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should map degree type [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should map modality type [0.01ms]
(pass) Entity Normalizer > normalizeCourse > Valid Input > should map course status [0.01ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when CO_CURSO is not a number [0.01ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when CO_CURSO is empty [0.01ms]
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when CO_IES is not a number
(pass) Entity Normalizer > normalizeCourse > Invalid Input > should return null when NO_CURSO is empty
(pass) Entity Normalizer > normalizeCourse > Edge Cases > should handle zero as valid course code [0.03ms]
(pass) Entity Normalizer > normalizeCourse > Edge Cases > should handle floating point numbers (truncates) [0.02ms]
(pass) Entity Normalizer > normalizeCourse > Edge Cases > should normalize course name with special characters [0.04ms]

src/mec-sync/parsers/mec-row.mapper.spec.ts:
(pass) MEC Row Mapper > mapToMecRow > Standard Column Names > should map values with standard MEC column names [0.23ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CODIGO_IES as alternative to CO_IES [0.06ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle NOME_IES as alternative to NO_IES [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle ORGANIZACAO_ACADEMICA as alternative [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle TP_ORGANIZACAO_ACADEMICA as alternative [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CATEGORIA_ADMINISTRATIVA as alternative [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CODIGO_MUNICIPIO as alternative [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle MUNICIPIO as alternative to NO_MUNICIPIO_IES [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle UF as alternative to SG_UF_IES [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CODIGO_CURSO as alternative to CO_CURSO [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle NOME_CURSO as alternative to NO_CURSO [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle GRAU as alternative to TP_GRAU [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle MODALIDADE as alternative to TP_MODALIDADE [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle AREA_OCDE_CINE as alternative [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle CARGA_HORARIA as alternative [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Alternative Column Names > should handle SITUACAO_CURSO as alternative [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should return empty strings for missing columns [0.03ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should handle partial column maps [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should handle values with special characters [0.02ms]
(pass) MEC Row Mapper > mapToMecRow > Edge Cases > should prefer first alternative when multiple exist [0.01ms]
(pass) MEC Row Mapper > mapToMecRow > Real-world MEC Data > should parse a typical federal university row [0.05ms]
(pass) MEC Row Mapper > mapToMecRow > Real-world MEC Data > should parse a private EaD institution row [0.03ms]

src/mec-sync/parsers/csv-line.parser.spec.ts:
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should parse a simple CSV line [0.14ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should handle empty values [0.03ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should handle trailing comma [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should handle leading comma [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Basic Parsing > should trim whitespace from values [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle quoted values [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle commas inside quotes [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle escaped quotes (double quotes) [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle multiple quoted fields [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Quoted Fields > should handle empty quoted value [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle empty string
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle single value [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle only commas [0.01ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle newlines inside quotes [0.02ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle unicode characters [0.04ms]
(pass) CSV Line Parser > parseCsvLine > Edge Cases > should handle special characters [0.02ms]
(pass) CSV Line Parser > parseCsvLine > MEC CSV Specific Cases > should handle typical MEC institution row [0.04ms]
(pass) CSV Line Parser > parseCsvLine > MEC CSV Specific Cases > should handle quoted institution names with commas [0.02ms]
(pass) CSV Line Parser > buildColumnMap > should build a map from header array [0.10ms]
(pass) CSV Line Parser > buildColumnMap > should normalize column names to uppercase [0.02ms]
(pass) CSV Line Parser > buildColumnMap > should trim whitespace from column names [0.02ms]
(pass) CSV Line Parser > buildColumnMap > should remove BOM from first column [0.02ms]
(pass) CSV Line Parser > buildColumnMap > should handle empty header array [0.01ms]
(pass) CSV Line Parser > buildColumnMap > should handle MEC-style headers [0.02ms]
(pass) CSV Line Parser > getColumnValue > should get value by first key match [0.04ms]
(pass) CSV Line Parser > getColumnValue > should try fallback keys in order [0.01ms]
(pass) CSV Line Parser > getColumnValue > should return empty string when no key matches
(pass) CSV Line Parser > getColumnValue > should return empty string when index is out of bounds [0.03ms]
(pass) CSV Line Parser > getColumnValue > should handle empty values array [0.01ms]
(pass) CSV Line Parser > getColumnValue > should handle multiple fallback keys [0.01ms]
(pass) CSV Line Parser > getColumnValue > should prefer first matching key

src/mec-sync/services/course-query.service.spec.ts:

# Unhandled error between tests
-------------------------------
40 |       return Promise.resolve(
41 |         mockCourses.find((c) => c.codigoCurso === code) ?? null,
42 |       );
43 |     }),
44 |     search: mock().mockResolvedValue([mockCourses[0]]),
45 |     getDistinctAreas: jest
                           ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/course-query.service.spec.ts:45:23)
-------------------------------


src/mec-sync/services/mec-stats.service.spec.ts:
(pass) MecStatsService > getStats > should return comprehensive statistics [0.88ms]
(pass) MecStatsService > getStats > should include all course degree types [0.35ms]
(pass) MecStatsService > getStats > should include institutions by state [0.28ms]
(pass) MecStatsService > getStats > should handle null degree gracefully [0.27ms]
(pass) MecStatsService > getStats > should fetch all data in parallel [0.28ms]

src/mec-sync/services/institution-query.service.spec.ts:
(pass) InstitutionQueryService > listAll > should return all institutions [0.68ms]
89 | 
90 |     it('should cache results', async () => {
91 |       await service.listAll();
92 |       await service.listAll();
93 | 
94 |       expect(stubRepository.findAll).toHaveBeenCalledTimes(1);
                                          ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/institution-query.service.spec.ts:94:38)
(fail) InstitutionQueryService > listAll > should cache results [0.48ms]
(pass) InstitutionQueryService > listByState > should return institutions filtered by state [0.58ms]
(pass) InstitutionQueryService > listByState > should normalize state to uppercase [0.52ms]
111 | 
112 |     it('should cache results per state', async () => {
113 |       await service.listByState('SP');
114 |       await service.listByState('SP');
115 | 
116 |       expect(stubRepository.findByUf).toHaveBeenCalledTimes(1);
                                            ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 3

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/institution-query.service.spec.ts:116:39)
(fail) InstitutionQueryService > listByState > should cache results per state [0.68ms]
(pass) InstitutionQueryService > getByCode > should return institution with courses when found [0.55ms]
(pass) InstitutionQueryService > getByCode > should return null when institution not found [0.46ms]
(pass) InstitutionQueryService > search > should return matching institutions [0.36ms]
(pass) InstitutionQueryService > search > should return empty array for short queries [0.31ms]
(pass) InstitutionQueryService > search > should normalize query to lowercase [0.37ms]
(pass) InstitutionQueryService > getStateList > should return list of distinct UFs [0.35ms]

src/mec-sync/services/mec-data-injection.bug.spec.ts:
36 | 
37 |         const result = mockRowProcessor.processRow(maliciousRow);
38 | 
39 |         // BUG: Malicious content stored as-is!
40 |         // Should sanitize or reject
41 |         expect(result.nome.includes('<script')).toBe(false);
                                                     ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/mec-data-injection.bug.spec.ts:41:49)
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 1 [1.79ms]
37 |         const result = mockRowProcessor.processRow(maliciousRow);
38 | 
39 |         // BUG: Malicious content stored as-is!
40 |         // Should sanitize or reject
41 |         expect(result.nome.includes('<script')).toBe(false);
42 |         expect(result.nome.includes('DROP TABLE')).toBe(false);
                                                        ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/mec-data-injection.bug.spec.ts:42:52)
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 2 [0.03ms]
38 | 
39 |         // BUG: Malicious content stored as-is!
40 |         // Should sanitize or reject
41 |         expect(result.nome.includes('<script')).toBe(false);
42 |         expect(result.nome.includes('DROP TABLE')).toBe(false);
43 |         expect(result.nome.includes('process.env')).toBe(false);
                                                         ^
error: expect(received).toBe(expected)

Expected: false
Received: true

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/services/mec-data-injection.bug.spec.ts:43:53)
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 3 [0.01ms]
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 4
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 5
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should validate course code is numeric [0.02ms]
(pass) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should limit field lengths [0.08ms]

src/mec-sync/controllers/mec-course.controller.bug.spec.ts:
35 |     // BUG-035 FIX: Validate parseInt result
36 |     let parsedLimit = APP_CONSTANTS.DEFAULT_PAGE_SIZE;
37 |     if (limit) {
38 |       parsedLimit = parseInt(limit, 10);
39 |       if (isNaN(parsedLimit) || parsedLimit <= 0) {
40 |         throw new BadRequestException(
                   ^
BadRequestException: Invalid limit parameter. Must be a positive number.
 response: {
  message: "Invalid limit parameter. Must be a positive number.",
  error: "Bad Request",
  statusCode: 400,
},
   status: 400,
  options: {},

      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:40:15)
      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:32:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:40:24)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:38:51)
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should validate limit is a valid number [2.11ms]
35 |     // BUG-035 FIX: Validate parseInt result
36 |     let parsedLimit = APP_CONSTANTS.DEFAULT_PAGE_SIZE;
37 |     if (limit) {
38 |       parsedLimit = parseInt(limit, 10);
39 |       if (isNaN(parsedLimit) || parsedLimit <= 0) {
40 |         throw new BadRequestException(
                   ^
BadRequestException: Invalid limit parameter. Must be a positive number.
 response: {
  message: "Invalid limit parameter. Must be a positive number.",
  error: "Bad Request",
  statusCode: 400,
},
   status: 400,
  options: {},

      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:40:15)
      at searchCourses (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.ts:32:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:51:24)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:50:41)
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject negative limits [0.56ms]
64 |       const lastCall = mockCourseQuery.search.mock.calls[0];
65 |       const passedLimit = lastCall[1];
66 | 
67 |       // BUG: Huge limit was passed!
68 |       // Should cap at reasonable maximum (e.g., 100)
69 |       expect(passedLimit).toBeLessThanOrEqual(100);
                               ^
error: expect(received).toBeLessThanOrEqual(expected)

Expected: <= 100
Received: 999999999

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/mec-sync/controllers/mec-course.controller.bug.spec.ts:69:27)
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject extremely large limits [0.44ms]
(pass) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should handle float strings [0.37ms]
(pass) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should handle empty string limit [0.34ms]

src/users/services/username.service.spec.ts:
(pass) UsernameService > updateUsername > User validation > should throw NotFoundException when user does not exist [1.15ms]
(pass) UsernameService > updateUsername > User validation > should return success when username is unchanged [0.62ms]
(pass) UsernameService > updateUsername > Username format validation > should reject uppercase letters [0.43ms]
(pass) UsernameService > updateUsername > Username format validation > should reject usernames starting with number [0.30ms]
(pass) UsernameService > updateUsername > Username format validation > should reject special characters [0.27ms]
(pass) UsernameService > updateUsername > Username format validation > should reject consecutive underscores [0.38ms]
(pass) UsernameService > updateUsername > Username format validation > should reject trailing underscore [0.33ms]
(pass) UsernameService > updateUsername > Username format validation > should accept valid lowercase username [0.66ms]
(pass) UsernameService > updateUsername > Username format validation > should accept username with numbers [0.37ms]
(pass) UsernameService > updateUsername > Username format validation > should accept username with single underscores [0.25ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "admin" [0.27ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "api" [0.28ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "www" [0.28ms]
(pass) UsernameService > updateUsername > Reserved username validation > should reject "support" [0.28ms]
(pass) UsernameService > updateUsername > Cooldown validation > should allow when never changed before (null) [0.32ms]
(pass) UsernameService > updateUsername > Cooldown validation > should reject within 30 days of last change [0.30ms]
(pass) UsernameService > updateUsername > Cooldown validation > should allow after 30 days [0.31ms]
(pass) UsernameService > updateUsername > Cooldown validation > should show remaining days in error message [0.36ms]
(pass) UsernameService > updateUsername > Username availability > should reject already taken username [0.38ms]
(pass) UsernameService > updateUsername > Username availability > should accept available username [0.29ms]
(pass) UsernameService > updateUsername > Successful update > should call repository with correct parameters [0.26ms]
(pass) UsernameService > updateUsername > Successful update > should return updated username [0.28ms]
(pass) UsernameService > checkUsernameAvailability > should return available=true when not taken [0.33ms]
(pass) UsernameService > checkUsernameAvailability > should return available=false when taken [0.29ms]
(pass) UsernameService > checkUsernameAvailability > should normalize username to lowercase [0.26ms]

src/users/services/username.service.bug-detection.spec.ts:
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should REJECT username containing uppercase letters [0.69ms]
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should REJECT username with mixed case [0.34ms]
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should REJECT username with single uppercase letter [0.31ms]
(pass) UsernameService - Bug Detection > BUG #1: Uppercase usernames must be REJECTED > should ACCEPT only lowercase username [0.28ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "admin" [0.25ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "api" [0.21ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "www" [0.19ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "support" [0.18ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "help" [0.22ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "root" [0.21ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "system" [0.18ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "null" [0.18ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should REJECT reserved username: "undefined" [0.22ms]
(pass) UsernameService - Bug Detection > BUG #2: Reserved usernames must be REJECTED > should include "reserved" in error message [0.77ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username starting with number [0.86ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username with special characters [0.68ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username with spaces [0.49ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username with consecutive underscores [0.36ms]
(pass) UsernameService - Bug Detection > BUG #3: Username format validation > should REJECT username ending with underscore [0.33ms]
(pass) UsernameService - Bug Detection > Cooldown edge cases > should REJECT at exactly 29 days (boundary test) [0.31ms]
(pass) UsernameService - Bug Detection > Cooldown edge cases > should ACCEPT at exactly 30 days (boundary test) [0.33ms]
(pass) UsernameService - Bug Detection > Cooldown edge cases > should show correct remaining days in error message [0.30ms]

src/users/services/user-preferences.service.spec.ts:
(pass) UserPreferencesService > getPreferences > should return user preferences when they exist [0.67ms]
(pass) UserPreferencesService > getPreferences > should throw NotFoundException when preferences do not exist [0.37ms]
(pass) UserPreferencesService > getPreferences > should return empty preferences object when user exists but has no preferences [0.28ms]
(pass) UserPreferencesService > updatePreferences > should update user preferences successfully [0.32ms]
(pass) UserPreferencesService > updatePreferences > should throw NotFoundException when user does not exist [0.30ms]
(pass) UserPreferencesService > updatePreferences > should handle partial preference updates [0.26ms]
(pass) UserPreferencesService > updatePreferences > should handle all preference fields in update [0.27ms]
(pass) UserPreferencesService > getFullPreferences > should return full user preferences when they exist [0.29ms]
(pass) UserPreferencesService > getFullPreferences > should return empty object when full preferences do not exist [0.23ms]
(pass) UserPreferencesService > getFullPreferences > should return empty object when full preferences are undefined [0.22ms]
(pass) UserPreferencesService > updateFullPreferences > should update full user preferences successfully [0.29ms]
(pass) UserPreferencesService > updateFullPreferences > should throw NotFoundException when user does not exist [0.28ms]
(pass) UserPreferencesService > updateFullPreferences > should handle creation of new full preferences (upsert behavior) [0.24ms]
(pass) UserPreferencesService > updateFullPreferences > should handle complete preference set in update [0.23ms]

src/users/services/user-profile.service.spec.ts:
(pass) UserProfileService > getPublicProfileByUsername > should return public profile when user exists and profile is public [0.69ms]
(pass) UserProfileService > getPublicProfileByUsername > should throw NotFoundException when user does not exist [0.34ms]
(pass) UserProfileService > getPublicProfileByUsername > should throw NotFoundException when profile visibility is private [0.31ms]
(pass) UserProfileService > getPublicProfileByUsername > should throw NotFoundException when profile visibility is undefined [0.31ms]
(pass) UserProfileService > getPublicProfileByUsername > should return profile with null resume when user has no resume [0.27ms]
(pass) UserProfileService > getProfile > should return user profile for valid userId [0.31ms]
(pass) UserProfileService > getProfile > should throw NotFoundException when profile does not exist [0.31ms]
(pass) UserProfileService > updateProfile > should update user profile successfully [0.43ms]
(pass) UserProfileService > updateProfile > should throw NotFoundException when user does not exist [0.71ms]
(pass) UserProfileService > updateProfile > should handle partial profile updates [0.70ms]
(pass) UserProfileService > updateProfile > should handle all profile fields in update [0.54ms]

src/ats/parsers/cv-section.parser.redos.spec.ts:
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should not hang on repeated section headers [1.43ms]
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should not hang on nested special characters [0.54ms]
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should not hang on overlapping patterns [0.41ms]
(pass) CVSectionParser - ReDoS BUG DETECTION > BUG-064: ReDoS Vulnerability > should limit input size [3.33ms]

src/ats/parsers/cv-section.parser.spec.ts:
(pass) CVSectionParser > parseCV > Basic Parsing > should parse a CV with all standard sections [0.64ms]
(pass) CVSectionParser > parseCV > Basic Parsing > should preserve section order in the order field [0.26ms]
(pass) CVSectionParser > parseCV > Basic Parsing > should capture multi-line content within sections [0.19ms]
(pass) CVSectionParser > parseCV > Basic Parsing > should track line numbers for sections [0.17ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle empty input [0.10ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle whitespace-only input [0.08ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle text with no detectable sections [0.18ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle very short lines (under 3 chars) as non-headers [0.19ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle lines with too many words as non-headers [0.17ms]
(pass) CVSectionParser > parseCV > Edge Cases > should handle section with no content after it [0.14ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Work Experience" as EXPERIENCE [0.09ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Professional Experience" as EXPERIENCE [0.09ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Contact Information" as PERSONAL_INFO [0.06ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Career Objective" as SUMMARY [0.08ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Technical Skills" as SKILLS [0.08ms]
(pass) CVSectionParser > parseCV > Section Alias Detection > should detect "Educational Background" as EDUCATION [0.08ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "ExperiÃªncia" as EXPERIENCE [0.08ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "FormaÃ§Ã£o AcadÃªmica" as EDUCATION [0.07ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "Habilidades" as SKILLS [0.06ms]
(pass) CVSectionParser > parseCV > Portuguese Section Detection > should detect "Idiomas" as LANGUAGES [0.11ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Personal Info" as personal_info [0.11ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Summary" as summary [0.10ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Experience" as experience [0.05ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Education" as education [0.10ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Skills" as skills [0.04ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Certifications" as certifications [0.04ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Projects" as projects [0.03ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Awards" as awards [0.03ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Publications" as publications [0.04ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Languages" as languages [0.04ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "Interests" as interests [0.04ms]
(pass) CVSectionParser > parseCV > All Section Types > should detect "References" as references [0.04ms]
(pass) CVSectionParser > parseCV > Unicode and Special Characters > should handle accented characters in section headers [0.17ms]
(pass) CVSectionParser > parseCV > Unicode and Special Characters > should handle special characters in content [0.24ms]
(pass) CVSectionParser > parseCV > Unicode and Special Characters > should handle emoji in content [0.30ms]
(pass) CVSectionParser > validateSections > Passing Validation > should pass when all mandatory sections are present with enough content [8.93ms]
(pass) CVSectionParser > validateSections > Passing Validation > should report detected sections correctly [0.13ms]
(pass) CVSectionParser > validateSections > Missing Sections > should fail when EXPERIENCE is missing [0.14ms]
(pass) CVSectionParser > validateSections > Missing Sections > should fail when EDUCATION is missing [0.07ms]
(pass) CVSectionParser > validateSections > Missing Sections > should fail when SKILLS is missing [0.06ms]
(pass) CVSectionParser > validateSections > Missing Sections > should report all missing mandatory sections [0.04ms]
(pass) CVSectionParser > validateSections > Empty Sections > should warn about sections with less than 10 characters [0.11ms]
(pass) CVSectionParser > validateSections > Duplicate Sections > should warn about duplicate sections [0.17ms]
(pass) CVSectionParser > validateSections > Duplicate Sections > should allow duplicates but warn (not fail) [0.10ms]
(pass) CVSectionParser > validateSections > No Sections Detected > should fail when no sections are detected [0.05ms]
(pass) CVSectionParser > validateSections > No Sections Detected > should provide helpful suggestion when no sections detected [0.03ms]
(pass) CVSectionParser > validateSections > Metadata > should report total and unique section counts [0.08ms]

src/ats/validators/layout-safety.validator.spec.ts:
(pass) LayoutSafetyValidator > validate > should pass validation for clean, ATS-friendly text [0.53ms]
(pass) LayoutSafetyValidator > validate > should detect unsafe bullet characters [0.34ms]
(pass) LayoutSafetyValidator > validate > should provide appropriate suggestion for unsafe bullets [0.11ms]
(pass) LayoutSafetyValidator > validate > should detect text inside shapes [0.18ms]
(pass) LayoutSafetyValidator > validate > should detect text inside double-box shapes [0.12ms]
(pass) LayoutSafetyValidator > validate > should detect text inside ASCII box shapes [0.09ms]
(pass) LayoutSafetyValidator > validate > should detect multi-column layout [0.13ms]
(pass) LayoutSafetyValidator > validate > should not detect multi-column for regular spacing [0.19ms]
(pass) LayoutSafetyValidator > validate > should detect excessive line breaks [0.18ms]
(pass) LayoutSafetyValidator > validate > should allow moderate blank lines (1-2) [0.10ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with dashes [0.08ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with equals signs [0.05ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with underscores [0.11ms]
(pass) LayoutSafetyValidator > validate > should detect horizontal lines with Unicode characters [0.04ms]
(pass) LayoutSafetyValidator > validate > should not detect short dash sequences as horizontal lines [0.03ms]
(pass) LayoutSafetyValidator > validate > should detect multiple ATS layout issues simultaneously [0.14ms]
(pass) LayoutSafetyValidator > validate > should never fail with ERROR severity (all issues are WARNING/INFO) [0.08ms]
(pass) LayoutSafetyValidator > validate > should provide metadata summary [0.18ms]
(pass) LayoutSafetyValidator > validate > should handle empty text gracefully [0.05ms]
(pass) LayoutSafetyValidator > validate > should handle text with only whitespace [0.04ms]
(pass) LayoutSafetyValidator > validate > should detect all defined unsafe bullet types [0.11ms]

src/ats/validators/grammar.validator.spec.ts:
(pass) GrammarValidator > validate > should return passed=true for clean text with no issues [2.22ms]
(pass) GrammarValidator > validate > should return passed=false when spelling errors exist [0.69ms]
(pass) GrammarValidator > validate > should provide metadata about total issues and categories [0.41ms]
(pass) GrammarValidator > spelling validation > should detect common spelling mistakes [0.40ms]
(pass) GrammarValidator > spelling validation > should suggest correct spelling for mistakes [0.33ms]
(pass) GrammarValidator > spelling validation > should not report duplicate spelling mistakes [0.29ms]
(pass) GrammarValidator > spelling validation > should be case-insensitive for spelling checks [0.27ms]
(pass) GrammarValidator > spelling validation > should detect multiple different spelling mistakes [0.38ms]
(pass) GrammarValidator > grammar patterns > should detect article errors (a before vowel) [0.35ms]
(pass) GrammarValidator > grammar patterns > should detect multiple consecutive spaces [0.42ms]
(pass) GrammarValidator > grammar patterns > should detect sentences not starting with capital letters [0.39ms]
(pass) GrammarValidator > grammar patterns > should flag commonly confused words [0.33ms]
(pass) GrammarValidator > structure validation > should flag very long sentences [0.32ms]
(pass) GrammarValidator > structure validation > should not flag reasonably sized sentences [0.30ms]
(pass) GrammarValidator > structure validation > should warn about documents with too few sentences [0.43ms]
(pass) GrammarValidator > structure validation > should accept documents with adequate number of sentences [0.23ms]
(pass) GrammarValidator > repeated words detection > should detect consecutive repeated words [0.25ms]
(pass) GrammarValidator > repeated words detection > should not flag intentionally repeated words in different contexts [0.25ms]
(pass) GrammarValidator > repeated words detection > should count multiple instances of repeated words [0.28ms]
(pass) GrammarValidator > comprehensive validation > should handle empty text gracefully [0.22ms]
(pass) GrammarValidator > comprehensive validation > should handle text with mixed issues [0.29ms]
(pass) GrammarValidator > comprehensive validation > should categorize issues by severity correctly [0.25ms]

src/ats/services/text-extraction.service.spec.ts:

# Unhandled error between tests
-------------------------------
29 | });
     ^
error: Unexpected }
    at /home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/text-extraction.service.spec.ts:29:1
-------------------------------


src/ats/services/ats.service.spec.ts:
(pass) ATSService > validateCV > should return successful validation for valid CV [1.57ms]
174 | 
175 |       const file = createMockFile({ mimetype: 'image/png' });
176 |       const result = await service.validateCV(file);
177 | 
178 |       expect(result.results.fileIntegrity?.passed).toBe(false);
179 |       expect(mockTextExtractionService.extractText.mock.calls.length).toBe(0);
                                                                            ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:179:71)
(fail) ATSService > validateCV > should stop validation early when file integrity fails [1.22ms]
198 | 
199 |       const file = createMockFile();
200 |       const result = await service.validateCV(file);
201 | 
202 |       expect(result.results.textExtraction?.passed).toBe(false);
203 |       expect(mockEncodingNormalizer.normalizeText.mock.calls.length).toBe(0);
                                                                           ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:203:70)
(fail) ATSService > validateCV > should stop validation early when text extraction fails [1.02ms]
207 |       setupSuccessfulPipeline();
208 |       const file = createMockFile();
209 | 
210 |       await service.validateCV(file, { checkSections: false });
211 | 
212 |       expect(mockCvSectionParser.parseCV.mock.calls.length).toBe(0);
                                                                  ^
error: expect(received).toBe(expected)

Expected: 0
Received: 1

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:212:61)
(fail) ATSService > validateCV > should skip section checks when checkSections is false [0.58ms]
217 |       setupSuccessfulPipeline();
218 |       const file = createMockFile();
219 | 
220 |       await service.validateCV(file, { checkFormat: false });
221 | 
222 |       expect(mockFormatValidator.validate.mock.calls.length).toBe(0);
                                                                   ^
error: expect(received).toBe(expected)

Expected: 0
Received: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:222:62)
(fail) ATSService > validateCV > should skip format validation when checkFormat is false [0.42ms]
226 |       setupSuccessfulPipeline();
227 |       const file = createMockFile();
228 | 
229 |       await service.validateCV(file, { checkLayout: false });
230 | 
231 |       expect(mockLayoutSafetyValidator.validate.mock.calls.length).toBe(0);
                                                                         ^
error: expect(received).toBe(expected)

Expected: 0
Received: 3

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:231:68)
(fail) ATSService > validateCV > should skip layout check when checkLayout is false [0.46ms]
(pass) ATSService > validateCV > should skip grammar check by default [0.40ms]
(pass) ATSService > validateCV > should include grammar check when checkGrammar is true [0.38ms]
253 |       setupSuccessfulPipeline();
254 |       const file = createMockFile();
255 | 
256 |       await service.validateCV(file, { checkOrder: false });
257 | 
258 |       expect(mockSectionOrderValidator.validate.mock.calls.length).toBe(0);
                                                                         ^
error: expect(received).toBe(expected)

Expected: 0
Received: 5

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:258:68)
(fail) ATSService > validateCV > should skip section order check when checkOrder is false [0.39ms]
(pass) ATSService > validateCV > should log validation progress [0.36ms]
(pass) ATSService > validateCV > should log warning when file integrity fails [0.48ms]
299 |       setupSuccessfulPipeline();
300 |       const file = createMockFile();
301 | 
302 |       await service.validateCV(file);
303 | 
304 |       expect(mockEncodingNormalizer.normalizeText.mock.calls.length).toBe(1);
                                                                           ^
error: expect(received).toBe(expected)

Expected: 1
Received: 9

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/ats/services/ats.service.spec.ts:304:70)
(fail) ATSService > validateCV > should normalize text encoding before validation [0.41ms]
(pass) ATSService > validateCV > should pass normalized text to section parser [0.45ms]
(pass) ATSService > validateCV > should include all enabled validation results in response [0.42ms]
(pass) ATSService > validation pipeline behavior > should aggregate issues from all validators [0.48ms]
(pass) ATSService > validation pipeline behavior > should handle file with all validation issues [0.57ms]

src/themes/utils/deep-merge.util.spec.ts:
(pass) deepMerge > basic merging > should merge flat objects [0.13ms]
(pass) deepMerge > basic merging > should not mutate original objects [0.02ms]
(pass) deepMerge > basic merging > should return base when overrides is empty [0.01ms]
(pass) deepMerge > nested objects > should merge nested objects recursively [0.03ms]
(pass) deepMerge > nested objects > should handle deeply nested objects [0.03ms]
(pass) deepMerge > null values > should handle null values correctly - override replaces [0.01ms]
(pass) deepMerge > null values > should handle null in base object [0.01ms]
(pass) deepMerge > array handling > should replace arrays instead of merging [0.03ms]
(pass) deepMerge > array handling > should not deep merge array contents [0.02ms]
(pass) deepMerge > undefined handling > should skip undefined values in overrides [0.01ms]
(pass) deepMerge > type coercion edge cases > should handle primitive override over object [0.01ms]
(pass) deepMerge > type coercion edge cases > should handle object override over primitive [0.01ms]
(pass) deepMerge > type coercion edge cases > should handle boolean values [0.03ms]
(pass) deepMerge > type coercion edge cases > should handle string values [0.01ms]
(pass) deepMerge > real-world theme config scenarios > should merge theme styleConfig correctly [0.03ms]

src/themes/utils/ordering.util.spec.ts:
(pass) sortByOrder > should sort items by order property ascending [0.08ms]
(pass) sortByOrder > should not mutate original array [0.02ms]
(pass) sortByOrder > should handle empty array [0.01ms]
(pass) sortByOrder > should handle single item [0.01ms]
(pass) sortByOrder > should handle items with same order [0.01ms]
(pass) normalizeOrders > should normalize orders to sequential values (0, 1, 2...) [0.04ms]
(pass) normalizeOrders > should not mutate original items [0.02ms]
(pass) normalizeOrders > should handle empty array
(pass) normalizeOrders > should handle already normalized orders [0.02ms]
(pass) moveItem > should attempt to move item but normalizeOrders sorts by original order [0.07ms]
(pass) moveItem > should handle moving to same position [0.02ms]
(pass) moveItem > should not mutate original array [0.03ms]
(pass) moveItem > should normalize orders after operation [0.03ms]
(pass) moveItem > should handle single item array [0.01ms]
(pass) applyItemOverrides > should add visible and order when no overrides [0.06ms]
(pass) applyItemOverrides > should add visible and order when overrides is empty array [0.02ms]
(pass) applyItemOverrides > should apply visibility overrides [0.05ms]
(pass) applyItemOverrides > should apply order overrides [0.02ms]
(pass) applyItemOverrides > should handle items without matching overrides [0.02ms]
(pass) applyItemOverrides > should preserve original item properties [0.03ms]

src/themes/services/section-visibility.service.spec.ts:
(pass) SectionVisibilityService > toggleSection > should hide a visible section [1.14ms]
(pass) SectionVisibilityService > toggleSection > should show a hidden section [0.47ms]
(pass) SectionVisibilityService > toggleSection > should not modify other sections [0.35ms]
(pass) SectionVisibilityService > toggleSection > should not modify section if id not found [0.29ms]
(pass) SectionVisibilityService > toggleItem > should hide a visible item [0.43ms]
(pass) SectionVisibilityService > toggleItem > should show a hidden item [0.34ms]
(pass) SectionVisibilityService > toggleItem > should add new item override if not exists [0.30ms]
(pass) SectionVisibilityService > toggleItem > should preserve order when toggling visibility [0.27ms]
(pass) SectionVisibilityService > toggleItem > should not modify other items in the same section [0.29ms]
(pass) SectionVisibilityService > toggleItem > should create section override array if not exists [0.30ms]

src/themes/services/theme-crud.service.bug-detection.spec.ts:
(pass) ThemeCrudService - Bug Detection > Theme limit per user > should REJECT creating 6th theme [2.36ms]
(pass) ThemeCrudService - Bug Detection > Theme limit per user > should ACCEPT creating 5th theme (at limit) [0.70ms]
(pass) ThemeCrudService - Bug Detection > Theme limit per user > should include "5" in the limit error message [0.81ms]
(pass) ThemeCrudService - Bug Detection > Theme approval flow > should have submitForApproval method [0.64ms]
140 |         status: 'PENDING',
141 |       });
142 | 
143 |       await (service as any).submitForApproval('user-123', 'theme-1');
144 | 
145 |       expect(mockPrisma.resumeTheme.update).toHaveBeenCalledWith(
                                                  ^
error: expect(received).toHaveBeenCalledWith(...expected)

  [
-   ObjectContaining {
-     "data": ObjectContaining {
-       "status": "PENDING",
+   {
+     "data": {
+       "rejectionReason": null,
+       "status": "PENDING_APPROVAL",
+     },
+     "where": {
+       "id": "theme-1",
      },
    },
  ]

- Expected  - 3
+ Received  + 7

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:145:45)
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should change status from PRIVATE to PENDING on submit [1.12ms]
155 |         status: 'PENDING',
156 |       });
157 | 
158 |       await expect(
159 |         (service as any).submitForApproval('user-123', 'theme-1'),
160 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: ForbiddenException

Received message: "Theme must be private or rejected"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:160:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:152:58)
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already PENDING theme [0.63ms]
166 |         status: ThemeStatus.PUBLISHED,
167 |       });
168 | 
169 |       await expect(
170 |         (service as any).submitForApproval('user-123', 'theme-1'),
171 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: ForbiddenException

Received message: "Theme must be private or rejected"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:171:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:163:59)
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already APPROVED theme [0.37ms]
188 |         rejectionCount: 2, // Already rejected twice
189 |       });
190 | 
191 |       await expect(
192 |         (service as any).submitForApproval('user-123', 'theme-1'),
193 |       ).rejects.toThrow(ForbiddenException);
                      ^
error: 

Expected promise that rejects
Received promise that resolved: Promise { <resolved> }

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:193:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:184:57)
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should REJECT resubmitting after 2 rejections [0.34ms]
(pass) ThemeCrudService - Bug Detection > Resubmission limit > should ACCEPT resubmitting after first rejection [0.29ms]
165 |   }
166 | 
167 |   private async assertIsAdmin(userId: string) {
168 |     const user = await this.prisma.user.findUnique({ where: { id: userId } });
169 |     if (!user || user.role !== UserRole.ADMIN) {
170 |       throw new ForbiddenException(ERROR_MESSAGES.ONLY_ADMINS_CAN_DO_THIS);
                  ^
ForbiddenException: Only administrators can perform this action
 response: {
  message: "Only administrators can perform this action",
  error: "Forbidden",
  statusCode: 403,
},
   status: 403,
  options: {},

      at assertIsAdmin (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.ts:170:13)
      at async rejectTheme (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.ts:125:16)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.bug-detection.spec.ts:222:30)
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should increment rejectionCount when theme is rejected [0.47ms]
(pass) ThemeCrudService - Bug Detection > Admin theme creation > should create theme as APPROVED when admin creates [0.41ms]
(pass) ThemeCrudService - Bug Detection > Admin theme creation > should REJECT createAsAdmin for non-admin users [0.30ms]
(pass) ThemeCrudService - Bug Detection > Theme inheritance > should NOT merge parent config, child overrides completely [0.35ms]

src/themes/services/theme-approval.service.limit.spec.ts:
69 |       mockCrud.findOrFail.mockResolvedValue(twiceRejectedTheme);
70 | 
71 |       // BUG: This should throw but doesn't!
72 |       await expect(
73 |         service.submitForApproval('user-123', 'theme-1'),
74 |       ).rejects.toThrow(BadRequestException);
                     ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: UnprocessableEntityException

Received message: "Theme has been rejected too many times. Maximum 2 resubmissions allowed."

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.limit.spec.ts:74:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.limit.spec.ts:61:61)
(fail) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should REJECT 3rd resubmission after 2 rejections [2.61ms]
(pass) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should ALLOW 1st resubmission after rejection [1.33ms]
(pass) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should ALLOW 2nd resubmission after rejection [0.86ms]
(pass) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should increment rejectionCount when theme is rejected [0.99ms]

src/themes/services/theme-application.service.spec.ts:

# Unhandled error between tests
-------------------------------
20 | }));
     ^
error: Unexpected }
    at /home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-application.service.spec.ts:20:1
-------------------------------


src/themes/services/theme-crud.service.limit.spec.ts:
(pass) ThemeCrudService - LIMIT BUG DETECTION > BUG-006: Theme Limit Enforcement > should REJECT creating 6th theme when user already has 5 [6.48ms]
(pass) ThemeCrudService - LIMIT BUG DETECTION > BUG-006: Theme Limit Enforcement > should ALLOW creating theme when user has less than 5 [1.58ms]
(pass) ThemeCrudService - LIMIT BUG DETECTION > BUG-006: Theme Limit Enforcement > should check theme count before creating [1.68ms]
130 |         ...mockThemeDto,
131 |         preApproved: true,
132 |       } as any);
133 | 
134 |       // Should be created as PUBLISHED, not PRIVATE
135 |       expect(mockPrisma.resumeTheme.create).toHaveBeenCalledWith(
                                                  ^
error: expect(received).toHaveBeenCalledWith(...expected)

  [
-   ObjectContaining {
-     "data": ObjectContaining {
-       "status": StringMatching /PUBLISHED|APPROVED/,
+   {
+     "data": {
+       "authorId": "admin-123",
+       "category": "PROFESSIONAL",
+       "description": "A new theme",
+       "name": "New Theme",
+       "parentThemeId": undefined,
+       "status": "PRIVATE",
+       "styleConfig": {
+         "colors": {
+           "primary": "#000000",
+         },
+       },
+       "tags": [],
      },
    },
  ]

- Expected  - 3
+ Received  + 14

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-crud.service.limit.spec.ts:135:45)
(fail) ThemeCrudService - LIMIT BUG DETECTION > BUG-013: Admin Pre-Approval > should allow admin to create pre-approved theme [1.47ms]

src/themes/services/theme-crud.service.spec.ts:
(pass) ThemeCrudService > create > should create theme successfully [2.62ms]
(pass) ThemeCrudService > create > should validate layout config if provided [1.24ms]
(pass) ThemeCrudService > update > should update theme owned by user [1.71ms]
(pass) ThemeCrudService > update > should reject updating theme owned by different user [2.73ms]
(pass) ThemeCrudService > update > should allow admin to update system theme [0.91ms]
(pass) ThemeCrudService > update > should reject non-admin updating system theme [0.56ms]
(pass) ThemeCrudService > update > should throw NotFoundException for non-existent theme [0.58ms]
(pass) ThemeCrudService > delete > should delete theme owned by user [0.56ms]
(pass) ThemeCrudService > delete > should reject deleting theme owned by different user [0.57ms]
(pass) ThemeCrudService > delete > should reject deleting system theme [0.63ms]
(pass) ThemeCrudService > delete > should throw NotFoundException for non-existent theme [0.61ms]
(pass) ThemeCrudService > findOrFail > should return theme when found [0.55ms]
(pass) ThemeCrudService > findOrFail > should throw NotFoundException when not found [0.55ms]

src/themes/services/theme-approval.service.bug-detection.spec.ts:
80 |         authorId: 'user-123',
81 |       });
82 | 
83 |       await expect(
84 |         service.submitForApproval('user-123', 'theme-1'),
85 |       ).rejects.toThrow(ForbiddenException);
                     ^
error: expect(received).toThrow(expected)

Expected constructor: ForbiddenException
Received constructor: UnprocessableEntityException

Received message: "Theme has been rejected too many times. Maximum 2 resubmissions allowed."

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:85:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:75:68)
(fail) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should REJECT resubmitting theme that was rejected twice [2.86ms]
(pass) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should include "maximum resubmissions" in error message [1.00ms]
(pass) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should ACCEPT resubmitting after first rejection [0.55ms]
(pass) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should ACCEPT first submission (rejectionCount = 0) [0.52ms]
(pass) ThemeApprovalService - Bug Detection > BUG: rejectionCount tracking > should INCREMENT rejectionCount when theme is rejected [0.52ms]
(pass) ThemeApprovalService - Bug Detection > BUG: rejectionCount tracking > should NOT increment rejectionCount when theme is approved [0.59ms]
(pass) ThemeApprovalService - Bug Detection > Status transitions > should only allow PRIVATE â PENDING transition [0.54ms]
(pass) ThemeApprovalService - Bug Detection > Status transitions > should only allow REJECTED â PENDING transition (resubmission) [0.49ms]
(pass) ThemeApprovalService - Bug Detection > Status transitions > should REJECT submitting from PUBLISHED status [0.52ms]
254 |         authorId: 'user-123',
255 |       });
256 | 
257 |       await service.submitForApproval('user-123', 'theme-1');
258 | 
259 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /SUBMIT|THEME_SUBMITTED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:259:42)
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is submitted [0.64ms]
275 |       await service.review('approver-1', {
276 |         themeId: 'theme-1',
277 |         approved: true,
278 |       });
279 | 
280 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /APPROVE|THEME_APPROVED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:280:42)
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is approved [0.65ms]
297 |         themeId: 'theme-1',
298 |         approved: false,
299 |         rejectionReason: 'Needs work',
300 |       });
301 | 
302 |       expect(mockPrisma.auditLog.create).toHaveBeenCalledWith(
                                               ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  ObjectContaining {
    data: ObjectContaining {
      action: StringMatching /REJECT|THEME_REJECTED/i,
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-approval.service.bug-detection.spec.ts:302:42)
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is rejected [0.93ms]

src/themes/services/theme-approval.service.spec.ts:
(pass) ThemeApprovalService > submitForApproval > should submit PRIVATE theme â PENDING_APPROVAL [0.78ms]
(pass) ThemeApprovalService > submitForApproval > should submit REJECTED theme â PENDING_APPROVAL (resubmit) [0.34ms]
(pass) ThemeApprovalService > submitForApproval > should reject submission if not theme owner [1.64ms]
(pass) ThemeApprovalService > submitForApproval > should reject submission of already published theme [0.52ms]
(pass) ThemeApprovalService > submitForApproval > should reject submission of pending theme [0.35ms]
(pass) ThemeApprovalService > review - approve > should approve: PENDING_APPROVAL â PUBLISHED [0.35ms]
(pass) ThemeApprovalService > review - approve > should allow admin to approve themes [0.29ms]
(pass) ThemeApprovalService > review - reject > should reject: PENDING_APPROVAL â REJECTED [0.30ms]
(pass) ThemeApprovalService > review - reject > should require rejection reason when rejecting [0.32ms]
(pass) ThemeApprovalService > review - access control > should reject non-admin/non-approver approval attempts [0.27ms]
(pass) ThemeApprovalService > review - access control > should reject self-approval [0.30ms]
(pass) ThemeApprovalService > review - access control > should reject approval of non-pending themes [0.31ms]
(pass) ThemeApprovalService > review - access control > should reject approval of already published themes [0.28ms]
(pass) ThemeApprovalService > getPendingApprovals > should return pending themes for approver [0.36ms]
(pass) ThemeApprovalService > getPendingApprovals > should reject non-approver access [0.30ms]
(pass) ThemeApprovalService > getPendingApprovals > should allow admin access [0.23ms]
(pass) ThemeApprovalService > workflow: full approval cycle > should complete: PRIVATE â submit â PENDING â approve â PUBLISHED [0.33ms]
(pass) ThemeApprovalService > workflow: full approval cycle > should complete: PRIVATE â submit â PENDING â reject â REJECTED â resubmit â PENDING [0.42ms]

src/themes/services/section-ordering.service.spec.ts:

# Unhandled error between tests
-------------------------------
25 |   normalizeOrders: mock((items) =>
                      ^
error: Expected ";" but found ":"
    at /home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/section-ordering.service.spec.ts:25:18

31 | }));
     ^
error: Unexpected }
    at /home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/section-ordering.service.spec.ts:31:1
-------------------------------


src/themes/services/theme-query.service.bug.spec.ts:
45 |       );
46 | 
47 |       // BUG: No limit enforced!
48 |       await (service as any).search?.('test', 10000);
49 | 
50 |       const findManyCall = mockPrisma.resumeTheme.findMany.mock.calls[0][0];
                                                                           ^
TypeError: undefined is not an object (evaluating 'mockPrisma.resumeTheme.findMany.mock.calls[0][0]')
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-query.service.bug.spec.ts:50:71)
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should enforce maximum limit on search [1.78ms]
59 |       await (service as any).search?.('test');
60 | 
61 |       const findManyCall = mockPrisma.resumeTheme.findMany.mock.calls[0]?.[0];
62 | 
63 |       // Should have a default limit
64 |       expect(findManyCall?.take).toBeDefined();
                                      ^
error: expect(received).toBeDefined()

Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/themes/services/theme-query.service.bug.spec.ts:64:34)
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should have default limit when none provided [0.75ms]
(pass) ThemeQueryService - BUG DETECTION > BUG-059: Style Config Size Not Validated > should reject excessively large styleConfig [18.84ms]
(pass) ThemeQueryService - BUG DETECTION > BUG-059: Style Config Size Not Validated > should reject deeply nested styleConfig [0.77ms]

src/onboarding/services/skills-onboarding.service.spec.ts:
(pass) SkillsOnboardingService > saveSkills > should save skills with correct order [1.51ms]
(pass) SkillsOnboardingService > saveSkills > should use empty string for missing category [1.83ms]
(pass) SkillsOnboardingService > saveSkills > should not save skills when noSkills is true [1.08ms]
(pass) SkillsOnboardingService > saveSkills > should not save skills when skills array is empty [0.49ms]
(pass) SkillsOnboardingService > saveSkills > should replace existing skills [0.57ms]
(pass) SkillsOnboardingService > saveSkills > should set level to null for all skills [0.39ms]

src/onboarding/services/education-onboarding.service.spec.ts:
(pass) EducationOnboardingService > saveEducation > should save education with all fields [1.18ms]
(pass) EducationOnboardingService > saveEducation > should save current education with null endDate [0.37ms]
(pass) EducationOnboardingService > saveEducation > should skip education with invalid startDate [0.32ms]
(pass) EducationOnboardingService > saveEducation > should skip education with endDate before startDate [0.30ms]
(pass) EducationOnboardingService > saveEducation > should not save education when noEducation is true [0.25ms]
(pass) EducationOnboardingService > saveEducation > should not save education when array is empty [0.23ms]
(pass) EducationOnboardingService > saveEducation > should allow empty field [0.24ms]
(pass) EducationOnboardingService > saveEducation > should replace existing education [0.28ms]

src/onboarding/services/experience-onboarding.service.spec.ts:
(pass) ExperienceOnboardingService > saveExperiences > should save experience with all fields [1.04ms]
(pass) ExperienceOnboardingService > saveExperiences > should save current experience with null endDate [0.41ms]
(pass) ExperienceOnboardingService > saveExperiences > should skip experience with invalid startDate [0.32ms]
(pass) ExperienceOnboardingService > saveExperiences > should skip experience with endDate before startDate [0.28ms]
(pass) ExperienceOnboardingService > saveExperiences > should not save experiences when noExperience is true [0.25ms]
(pass) ExperienceOnboardingService > saveExperiences > should not save experiences when array is empty [0.22ms]
(pass) ExperienceOnboardingService > saveExperiences > should use empty string for missing description [0.31ms]
(pass) ExperienceOnboardingService > saveExperiences > should replace existing experiences [0.27ms]

src/onboarding/services/onboarding-progress.bug-detection.spec.ts:
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should REJECT noExperience=true with non-empty experiences array [0.94ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should REJECT noEducation=true with non-empty education array [0.36ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should REJECT noSkills=true with non-empty skills array [0.28ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should include "cannot" or "forbidden" in error message [0.34ms]
(pass) OnboardingProgressService - Bug Detection > BUG #5: Flag + non-empty array validation > should ACCEPT noExperience=true with empty experiences array [0.32ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should return INITIAL progress if existing progress is older than 36 hours [0.38ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should DELETE expired progress automatically [0.26ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should KEEP progress if less than 36 hours old [0.26ms]
(pass) OnboardingProgressService - Bug Detection > BUG #6: Progress expiration after 36 hours > should check expiration at exactly 36 hours (boundary) [0.27ms]
242 |       await expect(
243 |         service.saveProgress('user-123', {
244 |           currentStep: 'skills',
245 |           completedSteps: ['welcome'], // Missing personal-info, professional-profile, etc.
246 |         }),
247 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: TypeError

Received message: "undefined is not an object (evaluating 'progress.currentStep')"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:247:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:241:57)
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT skipping from welcome to skills [0.33ms]
252 |         service.saveProgress('user-123', {
253 |           currentStep: 'education',
254 |           completedSteps: ['welcome', 'personal-info', 'professional-profile'],
255 |           // Missing 'experience' in completedSteps
256 |         }),
257 |       ).rejects.toThrow(BadRequestException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: BadRequestException
Received constructor: TypeError

Received message: "undefined is not an object (evaluating 'progress.currentStep')"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:257:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/onboarding/services/onboarding-progress.bug-detection.spec.ts:250:79)
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT going to education without completing experience step [2.27ms]
(pass) OnboardingProgressService - Bug Detection > Sequential step validation > should ACCEPT valid sequential progress [1.06ms]

src/onboarding/services/resume-onboarding.service.spec.ts:
(pass) ResumeOnboardingService > upsertResume > should create new resume with all personal info fields [1.05ms]
(pass) ResumeOnboardingService > upsertResume > should create resume with professional profile links [0.32ms]
(pass) ResumeOnboardingService > upsertResume > should set primary resume when creating first resume for user [0.31ms]
(pass) ResumeOnboardingService > upsertResume > should not change primary resume when updating existing resume [0.32ms]
(pass) ResumeOnboardingService > upsertResume > should update existing resume instead of creating new one [0.37ms]
(pass) ResumeOnboardingService > upsertResume > should handle different template selections [0.30ms]

src/onboarding/services/onboarding-progress.service.spec.ts:
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should reject noExperience=true with non-empty experiences [2.26ms]
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should reject noEducation=true with non-empty education [1.90ms]
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should reject noSkills=true with non-empty skills [1.32ms]
(pass) OnboardingProgressService > saveProgress > Flag + Array Validation > should accept noExperience=true with empty experiences [0.33ms]
(pass) OnboardingProgressService > saveProgress > Username Validation > should reject if username is taken by another user [3.72ms]
(pass) OnboardingProgressService > saveProgress > Username Validation > should accept if username belongs to same user [0.66ms]
(pass) OnboardingProgressService > saveProgress > Username Validation > should accept if username is available [0.33ms]
(pass) OnboardingProgressService > saveProgress > Successful Save > should call prisma upsert with correct data [0.30ms]
(pass) OnboardingProgressService > saveProgress > Successful Save > should return success with current step [0.27ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should return initial progress if no saved progress [0.26ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should return saved progress if fresh [0.29ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should return initial progress and delete if expired (>36h) [0.28ms]
(pass) OnboardingProgressService > getProgress > Expiration (36 hours) > should keep progress at exactly 35 hours [0.27ms]
(pass) OnboardingProgressService > deleteProgress > should delete progress for user [0.28ms]

src/onboarding/services/languages-onboarding.service.spec.ts:
(pass) LanguagesOnboardingService > saveLanguages > should save languages with correct order [1.04ms]
(pass) LanguagesOnboardingService > saveLanguages > should not save languages when array is empty [0.35ms]
(pass) LanguagesOnboardingService > saveLanguages > should replace existing languages [0.34ms]
(pass) LanguagesOnboardingService > saveLanguages > should map name field to name in storage [0.26ms]
(pass) LanguagesOnboardingService > saveLanguages > should map level field to level in storage [0.27ms]
(pass) LanguagesOnboardingService > saveLanguages > should handle single language [0.25ms]

src/tech-skills/services/tech-skills-query.service.spec.ts:
(pass) TechSkillsQueryService (Facade) > getAllAreas > should return list of tech areas [0.67ms]
(pass) TechSkillsQueryService (Facade) > getAllNiches > should return list of tech niches [0.45ms]
(pass) TechSkillsQueryService (Facade) > getNichesByArea > should return niches filtered by area [0.37ms]
(pass) TechSkillsQueryService (Facade) > getAllLanguages > should return list of programming languages [0.40ms]
(pass) TechSkillsQueryService (Facade) > searchLanguages > should return languages matching query [0.73ms]
(pass) TechSkillsQueryService (Facade) > getAllSkills > should return list of tech skills [0.47ms]
(pass) TechSkillsQueryService (Facade) > getSkillsByNiche > should return skills for specific niche [0.44ms]
(pass) TechSkillsQueryService (Facade) > getSkillsByType > should return skills of specific type [0.73ms]
(pass) TechSkillsQueryService (Facade) > searchSkills > should return skills matching query [0.51ms]
173 | 
174 |       expect(result).toMatchObject({
175 |         languages: expect.any(Array),
176 |         skills: expect.any(Array),
177 |       });
178 |       expect(result.languages).toHaveLength(1);
                                     ^
error: Received value does not have a length property: Any<Array>
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/tech-skills-query.service.spec.ts:178:32)
(fail) TechSkillsQueryService (Facade) > searchAll > should return combined results of languages and skills [0.65ms]

src/tech-skills/services/niche-query.service.spec.ts:
(pass) TechNicheQueryService > getAllNiches > should return all niches with area information [0.76ms]
79 | 
80 |     it('should cache results', async () => {
81 |       await service.getAllNiches();
82 |       await service.getAllNiches();
83 | 
84 |       expect(stubPrisma.techNiche.findMany).toHaveBeenCalledTimes(1);
                                                 ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/niche-query.service.spec.ts:84:45)
(fail) TechNicheQueryService > getAllNiches > should cache results [0.39ms]
(pass) TechNicheQueryService > getNichesByArea > should return niches filtered by area type [0.45ms]

src/tech-skills/services/language-query.service.spec.ts:
(pass) LanguageQueryService > getAllLanguages > should return all programming languages [0.84ms]
76 | 
77 |     it('should cache results', async () => {
78 |       await service.getAllLanguages();
79 |       await service.getAllLanguages();
80 | 
81 |       expect(stubPrisma.programmingLanguage.findMany).toHaveBeenCalledTimes(1);
                                                           ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/language-query.service.spec.ts:81:55)
(fail) LanguageQueryService > getAllLanguages > should cache results [0.42ms]
(pass) LanguageQueryService > searchLanguages > should return languages matching query [0.55ms]
(pass) LanguageQueryService > searchLanguages > should return empty array for empty query [0.27ms]
(pass) LanguageQueryService > searchLanguages > should respect limit parameter [0.26ms]

src/tech-skills/services/area-query.service.spec.ts:
(pass) TechAreaQueryService > getAllAreas > should return all active tech areas [0.80ms]
(pass) TechAreaQueryService > getAllAreas > should include all area fields [0.41ms]
101 |     });
102 | 
103 |     it('should return cached results on second call', async () => {
104 |       // First call - should query DB
105 |       await service.getAllAreas();
106 |       expect(stubPrisma.techArea.findMany).toHaveBeenCalledTimes(1);
                                                 ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 3

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/area-query.service.spec.ts:106:44)
(fail) TechAreaQueryService > getAllAreas > should return cached results on second call [0.38ms]
(pass) TechAreaQueryService > getAllAreas > should store results in cache after first query [0.29ms]
121 |     });
122 | 
123 |     it('should return results sorted by order', async () => {
124 |       const result = await service.getAllAreas();
125 | 
126 |       expect(result[0].order).toBeLessThan(result[1].order);
                                    ^
error: Expected and actual values must be numbers or bigints
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/area-query.service.spec.ts:126:31)
(fail) TechAreaQueryService > getAllAreas > should return results sorted by order [0.28ms]

src/tech-skills/services/skill-search.service.spec.ts:
(pass) SkillSearchService > searchSkills > should return skills matching query [1.14ms]
(pass) SkillSearchService > searchSkills > should return empty array for empty query [0.34ms]
(pass) SkillSearchService > searchSkills > should return empty array for whitespace query [0.28ms]
(pass) SkillSearchService > searchSkills > should normalize query to lowercase [0.31ms]
(pass) SkillSearchService > searchSkills > should return consistent results on multiple calls [0.27ms]
(pass) SkillSearchService > searchSkills > should respect limit parameter [0.25ms]
(pass) SkillSearchService > searchSkills > should include niche information in results [0.25ms]

src/tech-skills/services/skill-query.service.spec.ts:
(pass) SkillQueryService > getAllSkills > should return all skills with niche information [0.67ms]
79 | 
80 |     it('should cache results', async () => {
81 |       await service.getAllSkills();
82 |       await service.getAllSkills();
83 | 
84 |       expect(stubPrisma.techSkill.findMany).toHaveBeenCalledTimes(1);
                                                 ^
error: expect(received).toHaveBeenCalledTimes(expected)

Expected number of calls: 1
Received number of calls: 2

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/tech-skills/services/skill-query.service.spec.ts:84:45)
(fail) SkillQueryService > getAllSkills > should cache results [0.35ms]
(pass) SkillQueryService > getSkillsByNiche > should return skills filtered by niche slug [0.37ms]
(pass) SkillQueryService > getSkillsByType > should return skills filtered by type [0.34ms]
(pass) SkillQueryService > getSkillsByType > should respect limit parameter [0.23ms]

src/spoken-languages/services/spoken-languages.service.spec.ts:
(pass) SpokenLanguagesService > getAll > should return all active languages ordered by order field [0.78ms]
(pass) SpokenLanguagesService > getAll > should filter out inactive languages [0.33ms]
(pass) SpokenLanguagesService > getAll > should return empty array when no languages found [0.28ms]
(pass) SpokenLanguagesService > getAll > should handle null nativeName correctly [0.25ms]
(pass) SpokenLanguagesService > search > should search languages by English name case-insensitively [0.43ms]
(pass) SpokenLanguagesService > search > should search languages by Portuguese name [0.65ms]
(pass) SpokenLanguagesService > search > should search languages by Spanish name [0.62ms]
(pass) SpokenLanguagesService > search > should search languages by native name [0.53ms]
(pass) SpokenLanguagesService > search > should apply default limit when not specified [0.43ms]
(pass) SpokenLanguagesService > search > should respect custom limit parameter [0.28ms]
(pass) SpokenLanguagesService > search > should order search results by order field [0.28ms]
(pass) SpokenLanguagesService > search > should only search active languages [0.26ms]
(pass) SpokenLanguagesService > search > should return empty array when no matches found [0.23ms]
(pass) SpokenLanguagesService > getByCode > should return language by code [0.29ms]
(pass) SpokenLanguagesService > getByCode > should return null when language not found [0.23ms]
(pass) SpokenLanguagesService > getByCode > should handle language with null native name [0.32ms]
(pass) SpokenLanguagesService > getByCode > should query by exact code [0.23ms]

src/auth/strategies/jwt.strategy.spec.ts:
59 |     }
60 | 
61 |     // BUG-023/055/056/057 FIX: Enforce token revocation after security events
62 |     // passport-jwt includes standard claims like iat (seconds since epoch)
63 |     const issuedAtMs = (payload.iat ?? 0) * 1000;
64 |     const isRevoked = await this.tokenBlacklist.isTokenRevokedForUser(
                                                     ^
TypeError: this.tokenBlacklist.isTokenRevokedForUser is not a function. (In 'this.tokenBlacklist.isTokenRevokedForUser(user.id, issuedAtMs)', 'this.tokenBlacklist.isTokenRevokedForUser' is undefined)
      at validate (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.ts:64:49)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:73:37)
(fail) JwtStrategy > validate > should return user payload when user exists [1.03ms]
(pass) JwtStrategy > validate > should throw UnauthorizedException when user does not exist [0.51ms]
59 |     }
60 | 
61 |     // BUG-023/055/056/057 FIX: Enforce token revocation after security events
62 |     // passport-jwt includes standard claims like iat (seconds since epoch)
63 |     const issuedAtMs = (payload.iat ?? 0) * 1000;
64 |     const isRevoked = await this.tokenBlacklist.isTokenRevokedForUser(
                                                     ^
TypeError: this.tokenBlacklist.isTokenRevokedForUser is not a function. (In 'this.tokenBlacklist.isTokenRevokedForUser(user.id, issuedAtMs)', 'this.tokenBlacklist.isTokenRevokedForUser' is undefined)
      at validate (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.ts:64:49)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:109:37)
(fail) JwtStrategy > validate > should return correct onboarding status [0.35ms]
59 |     }
60 | 
61 |     // BUG-023/055/056/057 FIX: Enforce token revocation after security events
62 |     // passport-jwt includes standard claims like iat (seconds since epoch)
63 |     const issuedAtMs = (payload.iat ?? 0) * 1000;
64 |     const isRevoked = await this.tokenBlacklist.isTokenRevokedForUser(
                                                     ^
TypeError: this.tokenBlacklist.isTokenRevokedForUser is not a function. (In 'this.tokenBlacklist.isTokenRevokedForUser(user.id, issuedAtMs)', 'this.tokenBlacklist.isTokenRevokedForUser' is undefined)
      at validate (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.ts:64:49)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:127:37)
(fail) JwtStrategy > validate > should return admin role when user is admin [0.35ms]
142 |             JwtStrategy,
143 |             { provide: PrismaService, useValue: prisma },
144 |             { provide: ConfigService, useValue: mockConfigService },
145 |           ],
146 |         }).compile(),
147 |       ).rejects.toThrow('JWT_SECRET environment variable is required');
                      ^
error: expect(received).toThrow(expected)

Expected substring: "JWT_SECRET environment variable is required"
Received message: "Nest can't resolve dependencies of the JwtStrategy (ConfigService, PrismaService, ?). Please make sure that the argument TokenBlacklistService at index [2] is available in the RootTestModule context.\n\nPotential solutions:\n- Is RootTestModule a valid NestJS module?\n- If TokenBlacklistService is a provider, is it part of the current RootTestModule?\n- If TokenBlacklistService is exported from a separate @Module, is that module imported within RootTestModule?\n  @Module({\n    imports: [ /* the Module containing TokenBlacklistService */ ]\n  })\n\nFor more common dependency resolution issues, see: https://docs.nestjs.com/faq/common-errors"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:147:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/strategies/jwt.strategy.spec.ts:134:64)
(fail) JwtStrategy > constructor > should throw error when JWT_SECRET is not configured [0.79ms]

src/auth/strategies/jwt.strategy.bug-detection.spec.ts:
(pass) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should REJECT user with unverified email (emailVerified = null) [2.78ms]
(pass) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should ALLOW user with verified email [0.89ms]
(pass) JwtStrategy - BUG DETECTION > BUG-009: Email Verification Enforcement > should include emailVerified in query select [0.43ms]

src/auth/strategies/local.strategy.spec.ts:
(pass) LocalStrategy > validate > should return user when credentials are valid [0.66ms]
(pass) LocalStrategy > validate > should throw UnauthorizedException when credentials are invalid [0.32ms]
(pass) LocalStrategy > validate > should throw UnauthorizedException when user does not exist [0.26ms]
(pass) LocalStrategy > validate > should pass email and password to authService.validateUser [0.24ms]

src/auth/services/token-revocation.spec.ts:
89 |      * Current State: None of these exist!
90 |      */
91 | 
92 |     it('should have a method to revoke/blacklist a token', () => {
93 |       // BUG: This method doesn't exist!
94 |       expect(typeof (tokenService as any).revokeToken).toBe('function');
                                                            ^
error: expect(received).toBe(expected)

Expected: "function"
Received: "undefined"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-revocation.spec.ts:94:56)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to revoke/blacklist a token [0.75ms]
94 |       expect(typeof (tokenService as any).revokeToken).toBe('function');
95 |     });
96 | 
97 |     it('should have a method to logout all sessions', () => {
98 |       // BUG: This method doesn't exist!
99 |       expect(typeof (tokenService as any).revokeAllUserTokens).toBe('function');
                                                                    ^
error: expect(received).toBe(expected)

Expected: "function"
Received: "undefined"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-revocation.spec.ts:99:64)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to logout all sessions [0.38ms]
113 |         email: 'test@example.com',
114 |       });
115 | 
116 |       // BUG: Currently verifyToken only checks JWT signature,
117 |       // not if token is blacklisted!
118 |       expect(() => tokenService.verifyToken(revokedToken)).toThrow(
                                                                 ^
error: expect(received).toThrow(expected)

Expected constructor: UnauthorizedException

Received function did not throw
Received value: {
  sub: "user-123",
  email: "test@example.com",
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-revocation.spec.ts:118:60)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-revocation.spec.ts:102:58)
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should check token blacklist during validation [0.40ms]
(pass) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should track active sessions for logout all functionality [0.26ms]
(pass) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > revoked token should be rejected on refresh [0.51ms]
(pass) Token Revocation - BUG DETECTION > Session Management > should store session when logging in [0.71ms]
(pass) Token Revocation - BUG DETECTION > Session Management > should enforce session limit of 5 [0.44ms]

src/auth/services/account-management.service.spec.ts:
58 |       }
59 |       throw error;
60 |     }
61 | 
62 |     // BUG-057 FIX: Revoke all existing tokens after email change
63 |     await this.tokenBlacklist.revokeAllUserTokens(userId);
                                   ^
TypeError: this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)
      at changeEmail (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.ts:63:31)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:89:36)
(fail) AccountManagementService > changeEmail > should change email successfully when all validations pass [1.05ms]
(pass) AccountManagementService > changeEmail > should throw UnauthorizedException when user has no password [0.48ms]
(pass) AccountManagementService > changeEmail > should throw UnauthorizedException when password is incorrect [0.41ms]
172 |       passwordService.compare.mockResolvedValue(true);
173 |       mockFindUnique.mockResolvedValueOnce({
174 |         id: 'other-user',
175 |       } as any);
176 | 
177 |       await expect(async () => await service.changeEmail(userId, dto)).toThrow(
                                                                             ^
error: expect(received).toThrow(expected)

Expected message: "Email already in use"
Received message: "this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)"

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:177:72)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:156:74)
(fail) AccountManagementService > changeEmail > should throw ConflictException when new email is already taken [0.46ms]
58 |       }
59 |       throw error;
60 |     }
61 | 
62 |     // BUG-057 FIX: Revoke all existing tokens after email change
63 |     await this.tokenBlacklist.revokeAllUserTokens(userId);
                                   ^
TypeError: this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)
      at changeEmail (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.ts:63:31)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:204:21)
(fail) AccountManagementService > changeEmail > should reset emailVerified to null when changing email [0.37ms]
78 |     await this.validatePassword(user, password);
79 |     await this.preventLastAdminDeletion(user.role);
80 | 
81 |     // BUG-055 FIX: Revoke all tokens BEFORE deleting account
82 |     // This ensures any existing tokens become invalid immediately
83 |     await this.tokenBlacklist.revokeAllUserTokens(userId);
                                   ^
TypeError: this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)
      at deleteAccount (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.ts:83:31)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:233:36)
(fail) AccountManagementService > deleteAccount > should delete account successfully for non-admin user [0.46ms]
78 |     await this.validatePassword(user, password);
79 |     await this.preventLastAdminDeletion(user.role);
80 | 
81 |     // BUG-055 FIX: Revoke all tokens BEFORE deleting account
82 |     // This ensures any existing tokens become invalid immediately
83 |     await this.tokenBlacklist.revokeAllUserTokens(userId);
                                   ^
TypeError: this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)
      at deleteAccount (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.ts:83:31)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:269:36)
(fail) AccountManagementService > deleteAccount > should delete admin account when there are multiple admins [0.40ms]
(pass) AccountManagementService > deleteAccount > should throw BadRequestException when deleting last admin [0.40ms]
(pass) AccountManagementService > deleteAccount > should throw UnauthorizedException when user has no password [0.34ms]
(pass) AccountManagementService > deleteAccount > should throw UnauthorizedException when password is incorrect [0.34ms]
78 |     await this.validatePassword(user, password);
79 |     await this.preventLastAdminDeletion(user.role);
80 | 
81 |     // BUG-055 FIX: Revoke all tokens BEFORE deleting account
82 |     // This ensures any existing tokens become invalid immediately
83 |     await this.tokenBlacklist.revokeAllUserTokens(userId);
                                   ^
TypeError: this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)
      at deleteAccount (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.ts:83:31)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.spec.ts:358:21)
(fail) AccountManagementService > deleteAccount > should not check admin count for non-admin users [0.36ms]
(pass) AccountManagementService > error handling > should handle user not found in changeEmail [0.32ms]
(pass) AccountManagementService > error handling > should handle user not found in deleteAccount [0.29ms]

src/auth/services/token-refresh.service.spec.ts:
(pass) TokenRefreshService > refreshToken > should generate new tokens for valid user [0.75ms]
(pass) TokenRefreshService > refreshToken > should throw UnauthorizedException when user not found [0.40ms]
(pass) TokenRefreshService > refreshToken > should throw UnauthorizedException when user email is null [0.33ms]
(pass) TokenRefreshService > refreshToken > should generate tokens with correct payload [0.29ms]
53 | 
54 |       const user = await this.findUserById(decoded.sub);
55 |       return this.generateTokensForUser(user);
56 |     } catch {
57 |       this.logger.warn(`Invalid refresh token`, this.context);
58 |       throw new UnauthorizedException(ERROR_MESSAGES.UNAUTHORIZED);
                 ^
UnauthorizedException: Unauthorized access
 response: {
  message: "Unauthorized access",
  error: "Unauthorized",
  statusCode: 401,
},
   status: 401,
  options: {},

      at refreshWithToken (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-refresh.service.ts:58:13)
      at refreshWithToken (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-refresh.service.ts:38:26)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-refresh.service.spec.ts:172:36)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/token-refresh.service.spec.ts:147:59)
(fail) TokenRefreshService > refreshWithToken > should refresh tokens using valid refresh token [0.43ms]
(pass) TokenRefreshService > refreshWithToken > should throw UnauthorizedException for invalid refresh token [0.38ms]
(pass) TokenRefreshService > refreshWithToken > should throw UnauthorizedException when decoded user not found [0.33ms]
(pass) TokenRefreshService > refreshWithToken > should handle token verification errors gracefully [0.32ms]
(pass) TokenRefreshService > getCurrentUser > should return current user data [0.43ms]
(pass) TokenRefreshService > getCurrentUser > should throw UnauthorizedException when user not found [0.91ms]
(pass) TokenRefreshService > getCurrentUser > should return user with null fields correctly [0.85ms]
(pass) TokenRefreshService > getCurrentUser > should return admin user data correctly [0.84ms]

src/auth/services/account-management.service.bug.spec.ts:
91 |         newEmail: 'new@example.com',
92 |         currentPassword: 'password',
93 |       });
94 | 
95 |       // BUG: Should use transaction!
96 |       expect(mockPrisma.$transaction).toHaveBeenCalled();
                                           ^
error: expect(received).toHaveBeenCalled()

Expected number of calls: >= 1
Received number of calls: 0

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.bug.spec.ts:96:39)
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should use transaction to prevent race condition [0.81ms]
111 |       await expect(
112 |         service.changeEmail('user-123', {
113 |           newEmail: 'new@example.com',
114 |           currentPassword: 'password',
115 |         }),
116 |       ).rejects.toThrow(ConflictException);
                      ^
error: expect(received).toThrow(expected)

Expected constructor: ConflictException
Received constructor: Object

Received value: {
  code: "P2002",
  meta: {
    target: [ "email" ],
  },
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.bug.spec.ts:116:17)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.bug.spec.ts:99:69)
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should handle unique constraint violation on email change [0.47ms]
130 |       mockPrisma.user.delete.mockResolvedValue(mockUser);
131 | 
132 |       await service.deleteAccount('user-123', { password: 'password' });
133 | 
134 |       // BUG: Sessions/tokens should be invalidated!
135 |       expect(mockPrisma.session.deleteMany).toHaveBeenCalledWith({
                                                  ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  {
    where: {
      userId: "user-123",
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.bug.spec.ts:135:45)
(fail) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should revoke all tokens when account is deleted [0.39ms]
(pass) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should add current token to blacklist on deletion [0.27ms]
168 |         newEmail: 'new@example.com',
169 |         currentPassword: 'password',
170 |       });
171 | 
172 |       // BUG: Sessions should be invalidated after email change!
173 |       expect(mockPrisma.session.deleteMany).toHaveBeenCalledWith({
                                                  ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  {
    where: {
      userId: "user-123",
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/account-management.service.bug.spec.ts:173:45)
(fail) AccountManagementService - BUG DETECTION > BUG-057: Email Change Session Invalidation > should invalidate all sessions when email changes [0.38ms]

src/auth/services/auth-core.service.spec.ts:
(pass) AuthCoreService > signup > should create new user and return auth response [0.90ms]
(pass) AuthCoreService > signup > should use email prefix as name when name not provided [0.38ms]
(pass) AuthCoreService > signup > should throw ConflictException when email already exists [0.51ms]
(pass) AuthCoreService > signup > should throw when user email is null after creation [0.36ms]
(pass) AuthCoreService > signup > should log successful signup [0.31ms]
(pass) AuthCoreService > validateUser > should return user without password when credentials valid [0.38ms]
(pass) AuthCoreService > validateUser > should return null when user not found [0.26ms]
(pass) AuthCoreService > validateUser > should return null when user has no password [0.31ms]
(pass) AuthCoreService > validateUser > should return null when password invalid [0.26ms]
(pass) AuthCoreService > login > should return auth response when credentials valid [0.36ms]
(pass) AuthCoreService > login > should throw UnauthorizedException when user not found [0.34ms]
(pass) AuthCoreService > login > should throw UnauthorizedException when password invalid [0.37ms]
(pass) AuthCoreService > login > should throw when validated user has null email [0.32ms]
(pass) AuthCoreService > login > should log successful login [0.33ms]
(pass) AuthCoreService > login > should generate correct token payload [0.47ms]
(pass) AuthCoreService > login > should include all user fields in response [0.84ms]

src/auth/services/email-verification.service.spec.ts:
(pass) EmailVerificationService > requestVerification > should create token and send email when user exists and is not verified [1.01ms]
(pass) EmailVerificationService > requestVerification > should return success without sending email when user does not exist [0.43ms]
(pass) EmailVerificationService > requestVerification > should return success when email is already verified [0.37ms]
135 |       emailService.sendVerificationEmail.mockRejectedValue(
136 |         new Error('SMTP error'),
137 |       );
138 | 
139 |       // Should not throw despite email failure
140 |       await expect(service.requestVerification(dto)).resolves.not.toThrow();
                                                                        ^
error: expect(received).not.toThrow()

Thrown value: {
  success: true,
  message: "Verification email sent",
  token: "verification-token-123",
}

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/email-verification.service.spec.ts:140:67)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/email-verification.service.spec.ts:122:55)
(fail) EmailVerificationService > requestVerification > should handle email send failure gracefully [0.51ms]
(pass) EmailVerificationService > requestVerification > should include token in non-production mode [0.36ms]
(pass) EmailVerificationService > requestVerification > should use default name when user name is null [0.31ms]
(pass) EmailVerificationService > verifyEmail > should verify email and send welcome email successfully [0.49ms]
(pass) EmailVerificationService > verifyEmail > should handle welcome email send failure gracefully [0.40ms]
(pass) EmailVerificationService > verifyEmail > should handle missing user during welcome email gracefully [0.30ms]
(pass) EmailVerificationService > verifyEmail > should use default name for welcome email when user name is null [0.30ms]

src/auth/services/session.service.spec.ts:
(pass) TokenService > Token Generation > should generate token with correct payload [0.67ms]
(pass) TokenService > Token Generation > should throw error if email is missing [0.37ms]
(pass) TokenService > Token Verification > should verify valid token [0.30ms]
(pass) TokenService > Token Verification > should throw on invalid token [0.26ms]
(pass) TokenService > Token Decode > should decode token without verification [0.24ms]
(pass) Session Management (Business Rules) > should allow creating session when under limit [0.10ms]
(pass) Session Management (Business Rules) > should remove oldest session when at limit [0.08ms]
(pass) Session Management (Business Rules) > should maintain exactly 5 sessions after cleanup [0.07ms]
(pass) Rate Limiting (Login) > should allow login after 4 failed attempts [0.09ms]
(pass) Rate Limiting (Login) > should block IP after 5 failed attempts [0.02ms]
(pass) Rate Limiting (Login) > should NOT block different IP for same email (IP-based, not email-based) [0.02ms]
(pass) Rate Limiting (Login) > should clear attempts on successful login [0.04ms]
(pass) Rate Limiting (Login) > should track attempt count correctly [0.02ms]

src/auth/services/verification-token.service.spec.ts:
(pass) VerificationTokenService > createEmailVerificationToken > should create email verification token [2.09ms]
(pass) VerificationTokenService > createEmailVerificationToken > should set expiry time correctly for email verification [0.50ms]
(pass) VerificationTokenService > createEmailVerificationToken > should upsert token to handle existing tokens [0.35ms]
(pass) VerificationTokenService > createPasswordResetToken > should create password reset token with prefix [0.38ms]
(pass) VerificationTokenService > createPasswordResetToken > should set shorter expiry for password reset tokens [0.31ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should validate and delete valid email verification token [0.42ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should throw BadRequestException for non-existent token [0.29ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should throw BadRequestException for expired token [0.35ms]
(pass) VerificationTokenService > validateEmailVerificationToken > should handle cleanup failure for expired tokens gracefully [0.38ms]
(pass) VerificationTokenService > validatePasswordResetToken > should validate and return email from reset token [0.37ms]
(pass) VerificationTokenService > validatePasswordResetToken > should throw BadRequestException for email verification token [0.34ms]
(pass) VerificationTokenService > validatePasswordResetToken > should throw BadRequestException for null token [0.42ms]
(pass) VerificationTokenService > validatePasswordResetToken > should throw BadRequestException for expired reset token [0.36ms]
(pass) VerificationTokenService > validatePasswordResetToken > should extract email correctly from prefixed identifier [0.33ms]
(pass) VerificationTokenService > token generation > should generate different tokens on subsequent calls [0.33ms]
(pass) VerificationTokenService > token generation > should generate hex string tokens [0.31ms]

src/auth/services/password-change.bug.spec.ts:
49 |         password: 'newHashedPassword',
50 |       });
51 | 
52 |       // After password change, sessions should be cleared
53 |       // BUG: This is NOT being called!
54 |       expect(mockPrisma.session.deleteMany).toHaveBeenCalledWith({
                                                 ^
error: expect(received).toHaveBeenCalledWith(...expected)

Expected: [
  {
    where: {
      userId: "user-123",
    },
  }
]
But it was not called.
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/password-change.bug.spec.ts:54:45)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/password-change.bug.spec.ts:43:64)
(fail) Password Change - BUG DETECTION > BUG-056: Sessions Not Invalidated After Password Change > should invalidate all sessions when password changes [0.23ms]
(pass) Password Change - BUG DETECTION > BUG-056: Sessions Not Invalidated After Password Change > should blacklist all active tokens when password changes [0.03ms]

src/auth/services/password.service.spec.ts:
(pass) PasswordService > hash > should hash a password [73.22ms]
(pass) PasswordService > hash > should generate different hashes for the same password [123.74ms]
(pass) PasswordService > compare > should return true for matching password and hash [126.39ms]
(pass) PasswordService > compare > should return false for non-matching password [126.66ms]

src/auth/services/password-reset.service.spec.ts:
(pass) PasswordResetService > forgotPassword > should create token and send email when user exists [1.55ms]
(pass) PasswordResetService > forgotPassword > should return success without sending email when user does not exist [0.68ms]
(pass) PasswordResetService > forgotPassword > should handle email send failure gracefully [0.72ms]
(pass) PasswordResetService > forgotPassword > should include token in non-production mode when email sent [0.49ms]
(pass) PasswordResetService > forgotPassword > should include token in non-production mode when email fails [0.36ms]
(pass) PasswordResetService > resetPassword > should reset password successfully with valid token [0.45ms]
(pass) PasswordResetService > resetPassword > should throw error when token is invalid [0.35ms]
120 | 
121 |     await this.updatePasswordById(userId, hashedPassword);
122 | 
123 |     // BUG-056 FIX: Revoke all existing tokens after password change
124 |     // This ensures old sessions with the compromised password are invalidated
125 |     await this.tokenBlacklist.revokeAllUserTokens(userId);
                                    ^
TypeError: this.tokenBlacklist.revokeAllUserTokens is not a function. (In 'this.tokenBlacklist.revokeAllUserTokens(userId)', 'this.tokenBlacklist.revokeAllUserTokens' is undefined)
      at changePassword (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/password-reset.service.ts:125:31)
      at async <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/auth/services/password-reset.service.spec.ts:243:36)
(fail) PasswordResetService > changePassword > should change password successfully when current password is correct [0.52ms]
(pass) PasswordResetService > changePassword > should throw NotFoundException when user does not exist [0.37ms]
(pass) PasswordResetService > changePassword > should throw NotFoundException when user has no password [0.33ms]
(pass) PasswordResetService > changePassword > should throw UnauthorizedException when current password is incorrect [0.34ms]

src/auth/services/token.service.spec.ts:
(pass) TokenService > generateToken > should generate a JWT token with correct payload [0.50ms]
(pass) TokenService > generateToken > should include hasCompletedOnboarding false when user has not completed [0.26ms]
(pass) TokenService > verifyToken > should verify and return decoded token [0.21ms]
(pass) TokenService > verifyToken > should throw when token is invalid [0.22ms]
(pass) TokenService > decodeToken > should decode token without verification [0.19ms]
(pass) TokenService > decodeToken > should return null for invalid token [0.18ms]

src/dsl/migrators/dsl-migration.service.spec.ts:
(pass) DslMigrationService > registerMigrators > should register migrators [0.48ms]
(pass) DslMigrationService > migrate > should return same DSL if already at target version [0.28ms]
(pass) DslMigrationService > migrate > should migrate to next version [0.20ms]
(pass) DslMigrationService > migrate > should throw if no migrator found [0.21ms]
(pass) DslMigrationService > migrate > should apply migration chain [0.19ms]
(pass) DslMigrationService > migrate > should detect circular migration [0.21ms]
(pass) DslMigrationService > migrate > should throw if migration result has wrong version [0.24ms]
(pass) DslMigrationService > canMigrate > should return true for same version [0.20ms]
(pass) DslMigrationService > canMigrate > should return true if migration path exists [0.19ms]
(pass) DslMigrationService > canMigrate > should return false if no migration path exists [0.18ms]
(pass) DslMigrationService > getMigrationPath > should return single version for same version [0.20ms]
(pass) DslMigrationService > getMigrationPath > should return migration path [0.17ms]
(pass) DslMigrationService > getMigrationPath > should throw if no path exists [0.17ms]

src/integrations/github/github.service.spec.ts:
(pass) GitHubService > should be defined [0.87ms]
(pass) GitHubService > getUserProfile > should delegate to GitHubApiService [0.59ms]
(pass) GitHubService > getUserProfile > should propagate errors from GitHubApiService [0.63ms]
(pass) GitHubService > syncUserGitHub > should delegate to syncService [0.58ms]

src/translation/services/translation-core.service.spec.ts:
(pass) TranslationCoreService > Fallback Behavior > should return original text when service is unavailable [0.76ms]
[31m[Nest] 332658  - [39m01/07/2026, 7:05:14 PM [31m  ERROR[39m [38;5;3m[TranslationCoreService] [39m[31mTranslation failed: Connection refused[39m
(pass) TranslationCoreService > Fallback Behavior > should return original text on HTTP error [1.79ms]
[31m[Nest] 332658  - [39m01/07/2026, 7:05:14 PM [31m  ERROR[39m [38;5;3m[TranslationCoreService] [39m[31mTranslation failed: Timeout[39m
(pass) TranslationCoreService > Fallback Behavior > should return original text on timeout [0.45ms]
[31m[Nest] 332658  - [39m01/07/2026, 7:05:14 PM [31m  ERROR[39m [38;5;3m[TranslationCoreService] [39m[31mTranslation failed: Service error[39m
(pass) TranslationCoreService > Fallback Behavior > should continue main flow on translation failure [0.38ms]
(pass) TranslationCoreService > Successful Translation > should translate PT to EN [0.52ms]
(pass) TranslationCoreService > Successful Translation > should translate EN to PT [0.31ms]
(pass) TranslationCoreService > Supported Languages (PT-BR and EN only) > should support pt as source language [0.31ms]
(pass) TranslationCoreService > Supported Languages (PT-BR and EN only) > should support en as source language [0.32ms]
(pass) TranslationCoreService > Empty/Null Text Handling > should return empty string for empty input [0.24ms]
(pass) TranslationCoreService > Empty/Null Text Handling > should return whitespace string as-is [0.23ms]
(pass) TranslationCoreService > Service Availability > should check service health on init [0.37ms]
(pass) TranslationCoreService > Service Availability > should mark service unavailable on health check failure [0.41ms]
(pass) TranslationCoreService > Service Availability > should report availability status [0.27ms]

src/common/cache/services/cache-core.service.spec.ts:
(pass) CacheCoreService > get > should return parsed value on success [0.74ms]
(pass) CacheCoreService > get > should return null on cache miss [0.33ms]
(pass) CacheCoreService > get > should return null and log error on Redis failure [0.34ms]
(pass) CacheCoreService > get > should return null when cache is disabled [0.25ms]
(pass) CacheCoreService > get > should return null when client is null [0.23ms]
(pass) CacheCoreService > set > should set value without TTL [0.23ms]
(pass) CacheCoreService > set > should set value with TTL [0.23ms]
(pass) CacheCoreService > set > should log error on Redis failure [0.24ms]
(pass) CacheCoreService > set > should do nothing when cache is disabled [0.24ms]
(pass) CacheCoreService > delete > should delete key [0.27ms]
(pass) CacheCoreService > delete > should log error on Redis failure [0.26ms]
(pass) CacheCoreService > delete > should do nothing when cache is disabled [0.23ms]
(pass) CacheCoreService > deletePattern > should delete all matching keys [0.34ms]
(pass) CacheCoreService > deletePattern > should not call del when no keys match [0.23ms]
(pass) CacheCoreService > deletePattern > should log error on Redis failure [0.26ms]
(pass) CacheCoreService > deletePattern > should do nothing when cache is disabled [0.23ms]
(pass) CacheCoreService > flush > should flush database and log success [0.30ms]
(pass) CacheCoreService > flush > should log error on Redis failure [0.28ms]
(pass) CacheCoreService > flush > should do nothing when cache is disabled [0.28ms]
(pass) CacheCoreService > isEnabled > should return true when Redis is enabled and client exists [0.24ms]
(pass) CacheCoreService > isEnabled > should return false when Redis is disabled [0.21ms]
(pass) CacheCoreService > isEnabled > should return false when client is null [0.24ms]

src/resumes/services/base/base-sub-resource.service.spec.ts:
92 |       mockResumesRepository.findOne.mockResolvedValue(mockResume as any);
93 | 
94 |       // Access private method through public methods
95 |       await expect(
96 |         service.listForResume(mockResumeId, mockUserId),
97 |       ).resolves.not.toThrow();
                          ^
error: expect(received).not.toThrow()

Thrown value: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/base/base-sub-resource.service.spec.ts:97:22)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/resumes/services/base/base-sub-resource.service.spec.ts:91:60)
(fail) BaseSubResourceService > validateResumeOwnership > should pass validation when user owns the resume [0.67ms]
(pass) BaseSubResourceService > validateResumeOwnership > should throw ForbiddenException when resume not found [0.32ms]
(pass) BaseSubResourceService > validateResumeOwnership > should throw ForbiddenException when user does not own resume [0.27ms]
(pass) BaseSubResourceService > listForResume > should return paginated results for valid owner [0.25ms]
(pass) BaseSubResourceService > listForResume > should pass custom pagination parameters [0.22ms]
(pass) BaseSubResourceService > listForResume > should use default pagination when not provided [0.22ms]
(pass) BaseSubResourceService > findOne > should return entity when found [0.24ms]
(pass) BaseSubResourceService > findOne > should throw NotFoundException when entity not found [0.27ms]
(pass) BaseSubResourceService > findOne > should validate resume ownership before finding entity [0.23ms]
(pass) BaseSubResourceService > create > should create entity for valid owner [0.24ms]
(pass) BaseSubResourceService > create > should validate resume ownership before creating [0.24ms]
(pass) BaseSubResourceService > update > should update entity for valid owner [0.22ms]
(pass) BaseSubResourceService > update > should throw NotFoundException when entity not found [0.22ms]
(pass) BaseSubResourceService > update > should validate resume ownership before updating [0.21ms]
(pass) BaseSubResourceService > remove > should delete entity for valid owner [0.26ms]
(pass) BaseSubResourceService > remove > should throw NotFoundException when entity not found [0.30ms]
(pass) BaseSubResourceService > remove > should validate resume ownership before deleting [0.35ms]
(pass) BaseSubResourceService > reorder > should reorder entities for valid owner [0.31ms]
(pass) BaseSubResourceService > reorder > should validate resume ownership before reordering [0.28ms]

src/integrations/github/services/github-sync.service.limit.spec.ts:
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should REJECT sync when daily limit reached [0.22ms]
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should ALLOW sync when under daily limit [0.03ms]
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should check sync count before processing [0.01ms]
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should record sync after successful completion [0.02ms]
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should return remaining syncs in response [0.01ms]
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-018: GitHub Account Uniqueness > should REJECT sync if GitHub account linked to another user [0.01ms]
54 |     mockAchievementService = {
55 |       generateAchievements: mock().mockReturnValue([]),
56 |     };
57 | 
58 |     mockDatabaseService = {
59 |       verifyResumeOwnership: jest
                                  ^
ReferenceError: jest is not defined
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:59:30)
      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-sync.service.limit.spec.ts:44:14)
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-018: GitHub Account Uniqueness > should check GitHub account uniqueness before sync [0.02ms]

src/integrations/github/services/github-api.service.spec.ts:
(pass) GitHubApiService > fetchGitHub > should fetch data successfully with authorization header [0.81ms]
(pass) GitHubApiService > fetchGitHub > should work without token [0.57ms]
(pass) GitHubApiService > Error Handling > should throw NOT_FOUND for 404 response [0.40ms]
(pass) GitHubApiService > Error Handling > should throw FORBIDDEN for 403 (rate limit) response [0.29ms]
(pass) GitHubApiService > Error Handling > should throw BAD_GATEWAY for other errors [0.29ms]
(pass) GitHubApiService > getUserProfile > should return user profile [0.27ms]
(pass) GitHubApiService > getUserRepos > should return user repos with default options [0.29ms]
(pass) GitHubApiService > getUserRepos > should accept custom options [0.26ms]
(pass) GitHubApiService > getRepoCommitCount > should return commit count [0.29ms]
(pass) GitHubApiService > getRepoCommitCount > should return 0 on error (graceful degradation) [0.25ms]
(pass) GitHubApiService > getRepoCommitCount > should return 0 for non-array response [0.23ms]
(pass) GitHubApiService > getRepoPullRequests > should return PR count [0.30ms]
(pass) GitHubApiService > getRepoPullRequests > should return 0 on error (graceful degradation) [0.25ms]
(pass) GitHubApiService > getRepoIssues > should return issue count [0.29ms]
(pass) GitHubApiService > getRepoIssues > should return 0 on error (graceful degradation) [0.26ms]

src/integrations/github/services/github-api.service.bug.spec.ts:
35 |      * Fails with various URL formats.
36 |      */
37 |     it('should extract username from standard URL', () => {
38 |       const url = 'https://github.com/octocat';
39 |       const username = (service as any).extractUsername?.(url);
40 |       expect(username).toBe('octocat');
                            ^
error: expect(received).toBe(expected)

Expected: "octocat"
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:40:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should extract username from standard URL [0.84ms]
42 | 
43 |     it('should handle URL with trailing slash', () => {
44 |       const url = 'https://github.com/octocat/';
45 |       const username = (service as any).extractUsername?.(url);
46 |       // BUG: Might return empty string!
47 |       expect(username).toBe('octocat');
                            ^
error: expect(received).toBe(expected)

Expected: "octocat"
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:47:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with trailing slash [0.51ms]
49 | 
50 |     it('should handle URL with query string', () => {
51 |       const url = 'https://github.com/octocat?tab=repositories';
52 |       const username = (service as any).extractUsername?.(url);
53 |       // BUG: Might include query string!
54 |       expect(username).toBe('octocat');
                            ^
error: expect(received).toBe(expected)

Expected: "octocat"
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:54:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with query string [0.52ms]
56 | 
57 |     it('should handle URL with fragment', () => {
58 |       const url = 'https://github.com/octocat#readme';
59 |       const username = (service as any).extractUsername?.(url);
60 |       // BUG: Might include fragment!
61 |       expect(username).toBe('octocat');
                            ^
error: expect(received).toBe(expected)

Expected: "octocat"
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:61:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with fragment [0.48ms]
63 | 
64 |     it('should handle URL with repo path', () => {
65 |       const url = 'https://github.com/octocat/my-repo';
66 |       const username = (service as any).extractUsername?.(url);
67 |       // Should extract only username, not repo
68 |       expect(username).toBe('octocat');
                            ^
error: expect(received).toBe(expected)

Expected: "octocat"
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:68:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with repo path [0.67ms]
70 | 
71 |     it('should handle www subdomain', () => {
72 |       const url = 'https://www.github.com/octocat';
73 |       const username = (service as any).extractUsername?.(url);
74 |       // BUG: Might fail with www!
75 |       expect(username).toBe('octocat');
                            ^
error: expect(received).toBe(expected)

Expected: "octocat"
Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:75:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle www subdomain [0.65ms]
77 | 
78 |     it('should reject non-GitHub URLs', () => {
79 |       const url = 'https://gitlab.com/octocat';
80 |       const username = (service as any).extractUsername?.(url);
81 |       // BUG: Might accept any URL!
82 |       expect(username).toBeNull();
                            ^
error: expect(received).toBeNull()

Received: undefined

      at <anonymous> (/home/ilelo/Documents/Projects/profile/profile-services/src/integrations/github/services/github-api.service.bug.spec.ts:82:24)
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should reject non-GitHub URLs [0.78ms]
(pass) GitHubApiService - BUG DETECTION > BUG-048: Token Exposed in Logs > should redact token in error logs [0.49ms]
(pass) GitHubApiService - BUG DETECTION > BUG-048: Token Exposed in Logs > should not include token in request retry logs [0.38ms]

127 tests failed:
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should REJECT file with spoofed MIME type [0.80ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate JPEG magic bytes (FFD8FF) [0.72ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-025: Magic Bytes Validation > should validate PNG magic bytes (89504E47) [0.62ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT double extension attack (image.jpg.php) [0.59ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT null byte attack (image.php%00.jpg) [0.61ms]
(fail) UploadService - SECURITY BUG DETECTION > BUG-026: Extension Sanitization > should REJECT directory traversal in filename [0.68ms]
(fail) OnboardingService > completeOnboarding > should successfully complete onboarding [4.69ms]
(fail) Rate Limiting - BUG DETECTION > BUG-010: Login Failed Attempts Not Tracked > should block IP after 5 failed login attempts [0.28ms]
(fail) DslCompilerService - BUG DETECTION > BUG-017: Version Migration Not Implemented > should migrate DSL from v1 to v2 [1.33ms]
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should NOT silently return true when Redis is disabled [1.26ms]
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should log warning when operating without Redis [0.37ms]
(fail) CacheLockService - BUG DETECTION > BUG-004: Lock Behavior When Redis Disabled > should fail-safe for critical operations [0.33ms]
(fail) CacheLockService - BUG DETECTION > Alternative: In-Memory Fallback > should use in-memory fallback when Redis unavailable [0.42ms]
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should report when cache set fails [1.35ms]
(fail) Redis Cache - BUG DETECTION > BUG-054: Cache Set Without Error Handling > should retry on transient failures [0.53ms]
(fail) ParseCuidPipe - BUG DETECTION > BUG-036: Invalid IDs Pass Through > should ACCEPT valid CUID format [0.16ms]
(fail) ParseCuidPipe - BUG DETECTION > Current Buggy Behavior (documenting) > currently allows invalid IDs through (THIS IS A BUG) [0.04ms]
(fail) ExperienceService - Bug Detection > BUG #4: isCurrent and endDate validation > should REJECT isCurrent=false with endDate=null (ambiguous) [0.54ms]
(fail) ExperienceService - Bug Detection > Order uniqueness validation > should REJECT creating experience with duplicate order [0.38ms]
(fail) EducationService - BUG DETECTION > BUG-019: Missing Date Validation > should REQUIRE endDate when isCurrent=false [0.47ms]
(fail) EducationService - BUG DETECTION > BUG-052: Order Not Validated > should REJECT duplicate order values [0.51ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 1 in summary [0.82ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 2 in summary [0.40ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 3 in summary [0.27ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 4 in summary [0.24ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 5 in summary [0.22ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 6 in summary [0.25ms]
(fail) XSS Sanitization - BUG DETECTION > BUG-060: No XSS Sanitization > should sanitize XSS payload 9 in summary [0.22ms]
(fail) AchievementService > findAll > should throw ForbiddenException if resume not found [0.46ms]
(fail) AchievementService > findOne > should throw ForbiddenException if resume not owned by user [0.36ms]
(fail) AchievementService > create > should throw ForbiddenException if resume not owned by user [0.30ms]
(fail) AchievementService > reorder > should throw ForbiddenException if resume not owned by user [0.30ms]
(fail) BrowserManagerService > getBrowser > should reuse existing browser on subsequent calls [0.43ms]
(fail) BrowserManagerService > closeBrowser > should allow launching new browser after close [0.30ms]
(fail) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should have timeout on page operations [0.24ms]
(fail) PdfGeneratorService - BUG DETECTION > BUG-037: No Timeout Protection > should cleanup page even on timeout [0.03ms]
(fail) PdfGeneratorService - BUG DETECTION > BUG: Resource Exhaustion > should limit concurrent PDF generations [0.01ms]
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should use transaction for order assignment [0.13ms]
(fail) SkillAdminService - BUG DETECTION > BUG-034: Order Assignment Race Condition > should handle concurrent skill additions without duplicate orders [0.02ms]
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when adding skill [0.01ms]
(fail) SkillAdminService - BUG DETECTION > BUG-041: No Audit Log > should create audit log when deleting skill [0.01ms]
(fail) SkillAdminService - BUG DETECTION > BUG-044: No Authorization Check on Delete > should check admin authorization before delete
(fail) UserAdminMutationService > create > should throw ConflictException when email exists [0.38ms]
(fail) UserAdminMutationService > update > should throw ConflictException when email already in use [0.34ms]
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should use transaction to prevent race condition [1.15ms]
(fail) Race Condition Bug Detection > BUG-001: Email Uniqueness Race Condition > should handle unique constraint violation gracefully [0.84ms]
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 1: Try create, catch unique violation [0.55ms]
(fail) Race Condition Bug Detection > Atomic Operations Pattern > Pattern 2: Transaction with serializable isolation [0.43ms]
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when promoting user to admin [0.45ms]
(fail) UserAdminMutationService - Bug Detection > Audit trail > should create audit log when demoting admin to user [0.34ms]
(fail) UserAdminMutationService - Bug Detection > Password reset > should REJECT weak passwords [0.31ms]
(fail) UserAdminMutationService - Bug Detection > Password reset > should create audit log for password reset [0.36ms]
(fail) InstitutionQueryService > listAll > should cache results [0.48ms]
(fail) InstitutionQueryService > listByState > should cache results per state [0.68ms]
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 1 [1.79ms]
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 2 [0.03ms]
(fail) MEC Data Injection - BUG DETECTION > BUG-063: No Content Sanitization > should sanitize malicious value 3 [0.01ms]
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should validate limit is a valid number [2.11ms]
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject negative limits [0.56ms]
(fail) MecCourseController - BUG DETECTION > BUG-035: parseInt NaN Not Validated > should reject extremely large limits [0.44ms]
(fail) ATSService > validateCV > should stop validation early when file integrity fails [1.22ms]
(fail) ATSService > validateCV > should stop validation early when text extraction fails [1.02ms]
(fail) ATSService > validateCV > should skip section checks when checkSections is false [0.58ms]
(fail) ATSService > validateCV > should skip format validation when checkFormat is false [0.42ms]
(fail) ATSService > validateCV > should skip layout check when checkLayout is false [0.46ms]
(fail) ATSService > validateCV > should skip section order check when checkOrder is false [0.39ms]
(fail) ATSService > validateCV > should normalize text encoding before validation [0.41ms]
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should change status from PRIVATE to PENDING on submit [1.12ms]
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already PENDING theme [0.63ms]
(fail) ThemeCrudService - Bug Detection > Theme approval flow > should REJECT submitting already APPROVED theme [0.37ms]
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should REJECT resubmitting after 2 rejections [0.34ms]
(fail) ThemeCrudService - Bug Detection > Resubmission limit > should increment rejectionCount when theme is rejected [0.47ms]
(fail) ThemeApprovalService - RESUBMISSION LIMIT BUG DETECTION > BUG-007: Resubmission Limit (max 2) > should REJECT 3rd resubmission after 2 rejections [2.61ms]
(fail) ThemeCrudService - LIMIT BUG DETECTION > BUG-013: Admin Pre-Approval > should allow admin to create pre-approved theme [1.47ms]
(fail) ThemeApprovalService - Bug Detection > BUG: Resubmission limit (max 2) > should REJECT resubmitting theme that was rejected twice [2.86ms]
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is submitted [0.64ms]
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is approved [0.65ms]
(fail) ThemeApprovalService - Bug Detection > Audit trail > should create audit log when theme is rejected [0.93ms]
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should enforce maximum limit on search [1.78ms]
(fail) ThemeQueryService - BUG DETECTION > BUG-051: No Pagination Limit > should have default limit when none provided [0.75ms]
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT skipping from welcome to skills [0.33ms]
(fail) OnboardingProgressService - Bug Detection > Sequential step validation > should REJECT going to education without completing experience step [2.27ms]
(fail) TechSkillsQueryService (Facade) > searchAll > should return combined results of languages and skills [0.65ms]
(fail) TechNicheQueryService > getAllNiches > should cache results [0.39ms]
(fail) LanguageQueryService > getAllLanguages > should cache results [0.42ms]
(fail) TechAreaQueryService > getAllAreas > should return cached results on second call [0.38ms]
(fail) TechAreaQueryService > getAllAreas > should return results sorted by order [0.28ms]
(fail) SkillQueryService > getAllSkills > should cache results [0.35ms]
(fail) JwtStrategy > validate > should return user payload when user exists [1.03ms]
(fail) JwtStrategy > validate > should return correct onboarding status [0.35ms]
(fail) JwtStrategy > validate > should return admin role when user is admin [0.35ms]
(fail) JwtStrategy > constructor > should throw error when JWT_SECRET is not configured [0.79ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to revoke/blacklist a token [0.75ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should have a method to logout all sessions [0.38ms]
(fail) Token Revocation - BUG DETECTION > BUG-023: Token Revocation > should check token blacklist during validation [0.40ms]
(fail) AccountManagementService > changeEmail > should change email successfully when all validations pass [1.05ms]
(fail) AccountManagementService > changeEmail > should throw ConflictException when new email is already taken [0.46ms]
(fail) AccountManagementService > changeEmail > should reset emailVerified to null when changing email [0.37ms]
(fail) AccountManagementService > deleteAccount > should delete account successfully for non-admin user [0.46ms]
(fail) AccountManagementService > deleteAccount > should delete admin account when there are multiple admins [0.40ms]
(fail) AccountManagementService > deleteAccount > should not check admin count for non-admin users [0.36ms]
(fail) TokenRefreshService > refreshWithToken > should refresh tokens using valid refresh token [0.43ms]
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should use transaction to prevent race condition [0.81ms]
(fail) AccountManagementService - BUG DETECTION > BUG-033: Email Change Race Condition (TOCTOU) > should handle unique constraint violation on email change [0.47ms]
(fail) AccountManagementService - BUG DETECTION > BUG-055: Account Deletion Token Revocation > should revoke all tokens when account is deleted [0.39ms]
(fail) AccountManagementService - BUG DETECTION > BUG-057: Email Change Session Invalidation > should invalidate all sessions when email changes [0.38ms]
(fail) EmailVerificationService > requestVerification > should handle email send failure gracefully [0.51ms]
(fail) Password Change - BUG DETECTION > BUG-056: Sessions Not Invalidated After Password Change > should invalidate all sessions when password changes [0.23ms]
(fail) PasswordResetService > changePassword > should change password successfully when current password is correct [0.52ms]
(fail) BaseSubResourceService > validateResumeOwnership > should pass validation when user owns the resume [0.67ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should REJECT sync when daily limit reached [0.22ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should ALLOW sync when under daily limit [0.03ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should check sync count before processing [0.01ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should record sync after successful completion [0.02ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-008: Daily Sync Limit (10 per day) > should return remaining syncs in response [0.01ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-018: GitHub Account Uniqueness > should REJECT sync if GitHub account linked to another user [0.01ms]
(fail) GitHubSyncService - RATE LIMIT BUG DETECTION > BUG-018: GitHub Account Uniqueness > should check GitHub account uniqueness before sync [0.02ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should extract username from standard URL [0.84ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with trailing slash [0.51ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with query string [0.52ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with fragment [0.48ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle URL with repo path [0.67ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should handle www subdomain [0.65ms]
(fail) GitHubApiService - BUG DETECTION > BUG-031: URL Extraction Not Robust > should reject non-GitHub URLs [0.78ms]

 1060 pass
 127 fail
 5 errors
 1751 expect() calls
Ran 1187 tests across 122 files. [2.66s]
